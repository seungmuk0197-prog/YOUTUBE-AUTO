<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Auto - ì˜ìƒ ìë™ ìƒì„± ì‹œìŠ¤í…œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        h1 {
            color: #333;
            font-size: 32px;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 16px;
        }

        .status-bar {
            margin-top: 20px;
            padding: 15px;
            background: #f0f0f0;
            border-radius: 8px;
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .badge-success {
            background: #4CAF50;
            color: white;
        }

        .badge-error {
            background: #f44336;
            color: white;
        }

        .badge-pending {
            background: #ff9800;
            color: white;
        }

        main {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            font-size: 18px;
            font-weight: bold;
        }

        .card-content {
            padding: 20px;
        }

        .btn {
            display: inline-block;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
            margin-top: 10px;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 12px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }

        input[type="text"],
        input[type="file"],
        textarea,
        select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        input[type="range"] {
            width: 100%;
        }

        .projects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .project-card {
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .project-card:hover {
            border-color: #667eea;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
            transform: translateY(-5px);
        }

        .project-card h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .project-card p {
            color: #666;
            font-size: 12px;
            margin-bottom: 8px;
        }

        .project-status {
            display: flex;
            gap: 8px;
            margin: 10px 0;
            flex-wrap: wrap;
        }

        .status-tag {
            display: inline-block;
            padding: 4px 8px;
            background: #f0f0f0;
            border-radius: 4px;
            font-size: 11px;
            color: #666;
        }

        .status-tag.done {
            background: #4CAF50;
            color: white;
        }

        .status-tag.pending {
            background: #ff9800;
            color: white;
        }

        .editor-section {
            display: none;
        }

        .editor-section.active {
            display: block;
        }

        .tabs {
            display: flex;
            gap: 0;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 20px;
            pointer-events: none;
        }

        .tab-btn {
            padding: 15px 20px;
            background: none;
            border: none;
            cursor: default;
            color: #999;
            font-weight: 600;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            pointer-events: none;
        }

        .tab-btn:hover {
            color: #999;
        }

        .tab-btn.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #f0f0f0;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .success-message {
            background: #4CAF50;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .error-message {
            background: #f44336;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .range-value {
            color: #667eea;
            font-weight: bold;
            margin-left: 10px;
        }

        .steps {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            position: relative;
            z-index: 10;
            pointer-events: auto;
        }

        .step {
            flex: 1;
            text-align: center;
            padding: 15px;
            background: #f0f0f0;
            border-radius: 8px;
            position: relative;
            cursor: pointer;
            pointer-events: auto;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .step:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .step.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .step.completed {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }

        .step-number {
            display: inline-block;
            width: 30px;
            height: 30px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 50%;
            line-height: 30px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .step.active .step-number {
            background: white;
            color: #667eea;
        }

        .step.completed .step-number {
            background: white;
            color: #4CAF50;
        }

        .step-name {
            font-size: 12px;
            font-weight: 600;
        }

        @media (max-width: 1024px) {
            main {
                grid-template-columns: 1fr;
            }
        }

        .info-text {
            color: #999;
            font-size: 12px;
            margin-top: 8px;
        }

        .file-input-wrapper {
            position: relative;
        }

        .file-input-label {
            display: block;
            padding: 12px;
            background: #f0f0f0;
            border: 2px dashed #ddd;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-input-label:hover {
            border-color: #667eea;
            background: #f9f9ff;
        }

        input[type="file"] {
            display: none;
        }

        /* Text viewer modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        .modal-box {
            background: white;
            width: 90%;
            max-width: 1000px;
            max-height: 80vh;
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .modal-header {
            padding: 12px 16px;
            background: #f6f8fb;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .modal-title { font-weight: 700; }
        .modal-actions { display:flex; gap:8px; }
        .modal-content { padding: 12px; overflow: auto; background: #111; color: #eee; }
        .modal-content pre { white-space: pre-wrap; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, 'Roboto Mono', 'Courier New', monospace; font-size: 13px; }

        /* Loading Modal (Issue #4) */
        .loading-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .loading-modal.open {
            display: flex;
        }

        .loading-modal-content {
            background: white;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            min-width: 300px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .loading-modal-spinner {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 5px solid #f0f0f0;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        .loading-modal-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin: 15px 0;
        }

        .loading-modal-message {
            font-size: 14px;
            color: #666;
        }

        /* Fix z-index issues (Issue #2) */
        .steps {
            position: relative;
            z-index: 20;
            pointer-events: auto;
        }

        .step {
            pointer-events: auto;
            position: relative;
            z-index: 20;
        }

        .tab-btn {
            pointer-events: auto;
            position: relative;
            z-index: 20;
        }

        /* Audio error handling (Issue #1) */
        .audio-error {
            color: #f44336;
            font-size: 12px;
            margin-top: 8px;
            padding: 8px;
            background: #ffebee;
            border-radius: 4px;
        }

        /* Speed control (Issue #3) */
        .speed-control-wrapper {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .speed-control-wrapper label {
            margin-bottom: 0;
            font-weight: 600;
            white-space: nowrap;
        }

        .speed-control-wrapper select {
            margin-bottom: 0;
            flex: 1;
        }

        .speed-value {
            color: #667eea;
            font-weight: bold;
            min-width: 50px;
            text-align: right;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¬ YouTube Auto Studio</h1>
            <p class="subtitle">AI ê¸°ë°˜ ìë™ ì˜ìƒ ìƒì„± ë° í¸ì§‘ ì‹œìŠ¤í…œ</p>
            <div class="status-bar">
                <div class="status-item">
                    <span>Backend ìƒíƒœ:</span>
                    <span class="status-badge badge-success" id="backend-status">ğŸŸ¢ ì—°ê²°ë¨</span>
                </div>
                <div class="status-item">
                    <span>Frontend ìƒíƒœ:</span>
                    <span class="status-badge badge-success">ğŸŸ¢ ì‹¤í–‰ì¤‘</span>
                </div>
                <div class="status-item">
                    <span>í”„ë¡œì íŠ¸:</span>
                    <span id="project-count" style="font-weight: bold; color: #667eea;">0ê°œ</span>
                </div>
            </div>
        </header>

        <main>
            <!-- ì™¼ìª½: ì‚¬ì´ë“œë°” -->
            <div class="sidebar">
                <!-- ìƒˆ í”„ë¡œì íŠ¸ ìƒì„± -->
                <div class="card">
                    <div class="card-header">+ ìƒˆ í”„ë¡œì íŠ¸</div>
                    <div class="card-content">
                        <div class="form-group">
                            <label for="project-name">í”„ë¡œì íŠ¸ ì´ë¦„</label>
                            <input type="text" id="project-name" placeholder="ì˜ˆ: ì£¼ì‹ ì„¤ëª… ì˜ìƒ">
                        </div>
                        <div class="form-group">
                            <label for="project-type">ìœ í˜•</label>
                            <select id="project-type">
                                <option value="general">ì¼ë°˜</option>
                                <option value="educational">êµìœ¡</option>
                                <option value="entertainment">ì—”í„°í…Œì¸ë¨¼íŠ¸</option>
                                <option value="tutorial">íŠœí† ë¦¬ì–¼</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" onclick="createProject()">í”„ë¡œì íŠ¸ ìƒì„±</button>
                    </div>
                </div>

                <!-- ë¹ ë¥¸ ì‘ì—… -->
                <div class="card">
                    <div class="card-header">âš¡ ë¹ ë¥¸ ì‘ì—…</div>
                    <div class="card-content">
                        <button class="btn btn-secondary" onclick="showSection('projects')">ëª¨ë“  í”„ë¡œì íŠ¸</button>
                        <button class="btn btn-secondary" onclick="refreshProjects()">í”„ë¡œì íŠ¸ ìƒˆë¡œê³ ì¹¨</button>
                    </div>
                </div>
            </div>

            <!-- ì˜¤ë¥¸ìª½: ë©”ì¸ ì»¨í…ì¸  -->
            <div>
                <!-- ë©”ì‹œì§€ í‘œì‹œ ì˜ì—­ -->
                <div id="message-area"></div>

                <!-- í”„ë¡œì íŠ¸ ëª©ë¡ ì„¹ì…˜ -->
                <div id="projects-section" class="editor-section active">
                    <div class="card">
                        <div class="card-header">ğŸ“ í”„ë¡œì íŠ¸ ëª©ë¡</div>
                        <div class="card-content">
                            <div id="projects-loading" class="loading">
                                <div class="spinner"></div>
                                <p>í”„ë¡œì íŠ¸ ë¡œë”©ì¤‘...</p>
                            </div>
                            <div id="projects-grid" class="projects-grid" style="display: none;"></div>
                        </div>
                    </div>
                </div>

                <!-- í”„ë¡œì íŠ¸ í¸ì§‘ ì„¹ì…˜ -->
                <div id="editor-section" class="editor-section">
                    <div class="card">
                        <div class="card-header">
                            <span id="editor-title">í”„ë¡œì íŠ¸ í¸ì§‘</span>
                            <span style="float: right; cursor: pointer; font-size: 20px;" onclick="showSection('projects')">âœ•</span>
                        </div>
                        <div class="card-content">
                            <!-- ì§„í–‰ ìƒí™© -->
                            <div class="steps" id="progress-steps">
                                <div class="step"><div class="step-number">1</div><div class="step-name">ëŒ€ë³¸</div></div>
                                <div class="step"><div class="step-number">2</div><div class="step-name">TTS</div></div>
                                <div class="step"><div class="step-number">3</div><div class="step-name">ìë§‰</div></div>
                                <div class="step"><div class="step-number">4</div><div class="step-name">ì¸ë„¤ì¼</div></div>
                                <div class="step"><div class="step-number">5</div><div class="step-name">BGM</div></div>
                                <div class="step"><div class="step-number">6</div><div class="step-name">ë Œë”ë§</div></div>
                            </div>

                            <!-- íƒ­ -->
                            <div class="tabs" id="step-tabs">
                                <button class="tab-btn active" data-step="0">ğŸ“ ëŒ€ë³¸</button>
                                <button class="tab-btn" data-step="1">ğŸ”Š TTS</button>
                                <button class="tab-btn" data-step="2">ğŸ“ ìë§‰</button>
                                <button class="tab-btn" data-step="3">ğŸ“¸ ì¸ë„¤ì¼</button>
                                <button class="tab-btn" data-step="4">ğŸµ BGM</button>
                                <button class="tab-btn" data-step="5">ğŸ¬ ë Œë”ë§</button>
                            </div>

                            <!-- ëŒ€ë³¸ íƒ­ -->
                            <div id="script-tab" class="tab-content">
                                <div class="form-group">
                                    <label for="script-text">ì˜ìƒ ëŒ€ë³¸</label>
                                    <textarea id="script-text" placeholder="ì˜ìƒì˜ ë‚˜ë ˆì´ì…˜ ëŒ€ë³¸ì„ ì…ë ¥í•˜ì„¸ìš”...">ì•ˆë…•í•˜ì„¸ìš”. ì´ ì˜ìƒì€ AIê°€ ìë™ìœ¼ë¡œ ìƒì„±í–ˆìŠµë‹ˆë‹¤.</textarea>
                                    <div class="info-text">ğŸ’¡ í•œêµ­ì–´ ë˜ëŠ” ì˜ì–´ë¡œ ì…ë ¥í•˜ì„¸ìš”. ìë™ìœ¼ë¡œ TTS ìŒì„±ìœ¼ë¡œ ë³€í™˜ë©ë‹ˆë‹¤.</div>
                                </div>
                                <button class="btn btn-primary" onclick="updateScript()">ëŒ€ë³¸ ì €ì¥</button>
                                <div class="card" style="margin-top:12px;">
                                    <div class="card-header">Result</div>
                                    <div class="card-content" id="result-script">í˜„ì¬ ìƒíƒœ: ëŒ€ê¸°</div>
                                </div>
                            </div>

                            <!-- TTS íƒ­ -->
                            <div id="tts-tab" class="tab-content" style="display: none;">
                                <div class="form-group">
                                    <label for="voice-select">ìŒì„± ì„ íƒ</label>
                                    <select id="voice-select">
                                        <option value="ko-KR-SunHiNeural">í•œêµ­ì–´ - ì—¬ì„± (Sun Hi)</option>
                                        <option value="ko-KR-InJoonNeural">í•œêµ­ì–´ - ë‚¨ì„± (In Joon)</option>
                                        <option value="en-US-AriaNeural">English - Female (Aria)</option>
                                        <option value="en-US-GuyNeural">English - Male (Guy)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>âœ“ ìŒì„± ì„¤ì •</label>
                                    <div class="info-text">í˜„ì¬ ì„ íƒëœ ìŒì„±: ko-KR-SunHiNeural</div>
                                </div>
                                <!-- Speed Control (Issue #3) -->
                                <div class="form-group">
                                    <label for="tts-speed-select">ì¬ìƒ ì†ë„ (ë°°ì†)</label>
                                    <select id="tts-speed-select">
                                        <option value="0.8">0.8ë°° (ëŠë¦¼)</option>
                                        <option value="0.9">0.9ë°°</option>
                                        <option value="1.0" selected>1.0ë°° (ê¸°ë³¸)</option>
                                        <option value="1.1">1.1ë°°</option>
                                        <option value="1.2">1.2ë°° (ë¹ ë¦„)</option>
                                    </select>
                                    <div class="info-text">ì„ íƒí•œ ì†ë„ë¡œ TTSë¥¼ ì¬ìƒì„±í•©ë‹ˆë‹¤.</div>
                                </div>
                                <button class="btn btn-primary" onclick="generateTTS()">TTS ìƒì„±</button>
                                <div class="card" style="margin-top:12px;">
                                    <div class="card-header">Result</div>
                                    <div class="card-content" id="result-tts">í˜„ì¬ ìƒíƒœ: ëŒ€ê¸°</div>
                                </div>
                            </div>

                            <!-- ìë§‰ íƒ­ -->
                            <div id="subtitles-tab" class="tab-content" style="display: none;">
                                <div class="form-group">
                                    <label>ìë§‰ ìƒì„±</label>
                                    <div class="info-text">ì”¬ ê¸°ë°˜ ìë™ ìë§‰ì„ ìƒì„±í•©ë‹ˆë‹¤.</div>
                                </div>
                                <button class="btn btn-primary" onclick="generateSubtitles()">ìë§‰ ìƒì„±</button>
                                <div class="card" style="margin-top:12px;">
                                    <div class="card-header">Result</div>
                                    <div class="card-content" id="result-subtitles">í˜„ì¬ ìƒíƒœ: ëŒ€ê¸°</div>
                                </div>
                            </div>

                            <!-- ì¸ë„¤ì¼ íƒ­ -->
                            <div id="thumbnail-tab" class="tab-content" style="display: none;">
                                <div class="form-group">
                                    <label for="thumbnail-title">ì¸ë„¤ì¼ ì œëª©</label>
                                    <input type="text" id="thumbnail-title" placeholder="ì˜ˆ: ìƒˆë¡œìš´ ê¸°ìˆ  ì„¤ëª…">
                                </div>
                                <div class="form-group">
                                    <label for="thumbnail-color">ë°°ê²½ìƒ‰</label>
                                    <input type="text" id="thumbnail-color" placeholder="#667eea" value="#667eea">
                                    <div class="info-text">ìƒ‰ìƒ ì½”ë“œ í˜•ì‹: #RRGGBB</div>
                                </div>
                                <div class="form-group">
                                    <label for="thumbnail-image">ì»¤ìŠ¤í…€ ì´ë¯¸ì§€ (ì„ íƒ)</label>
                                    <div class="file-input-wrapper">
                                        <label class="file-input-label">
                                            ğŸ“¤ ì´ë¯¸ì§€ ì—…ë¡œë“œ
                                            <input type="file" id="thumbnail-image" accept="image/*">
                                        </label>
                                    </div>
                                </div>
                                <button class="btn btn-primary" onclick="generateThumbnail()">ì¸ë„¤ì¼ ìƒì„±</button>
                                    <div class="card" style="margin-top:12px;">
                                        <div class="card-header">Result</div>
                                        <div class="card-content" id="result-thumbnail">í˜„ì¬ ìƒíƒœ: ëŒ€ê¸°</div>
                                    </div>
                            </div>

                            <!-- BGM íƒ­ -->
                            <div id="bgm-tab" class="tab-content" style="display: none;">
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" id="bgm-enabled" onchange="toggleBGM()"> BGM ì‚¬ìš© ì—¬ë¶€
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label for="bgm-volume">BGM ë³¼ë¥¨: <span class="range-value" id="volume-display">50%</span></label>
                                    <input type="range" id="bgm-volume" min="0" max="100" value="50" onchange="updateBGMVolume()">
                                </div>
                                <div class="form-group">
                                    <label for="bgm-file">BGM íŒŒì¼ ì„ íƒ</label>
                                    <div class="file-input-wrapper">
                                        <label class="file-input-label">
                                            ğŸµ ì˜¤ë””ì˜¤ íŒŒì¼ ì—…ë¡œë“œ (.mp3, .wav, .aac, .ogg, .flac)
                                            <input type="file" id="bgm-file" accept="audio/*">
                                        </label>
                                    </div>
                                </div>
                                <button class="btn btn-primary" onclick="uploadBGM()">BGM ì ìš©</button>
                                    <div class="card" style="margin-top:12px;">
                                        <div class="card-header">Result</div>
                                        <div class="card-content" id="result-bgm">í˜„ì¬ ìƒíƒœ: ëŒ€ê¸°</div>
                                    </div>
                            </div>

                            <!-- ë Œë”ë§ íƒ­ -->
                            <div id="render-tab" class="tab-content" style="display: none;">
                                <div class="form-group">
                                    <label for="output-format">ì¶œë ¥ í¬ë§·</label>
                                    <select id="output-format">
                                        <option value="1080p">Full HD (1920x1080)</option>
                                        <option value="720p">HD (1280x720)</option>
                                        <option value="4k">4K (3840x2160)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="video-duration">ì˜ˆìƒ ì˜ìƒ ì‹œê°„</label>
                                    <input type="text" id="video-duration" placeholder="ê³„ì‚°ì¤‘..." disabled>
                                </div>
                                <div id="render-progress" style="display: none;">
                                    <div class="loading">
                                        <div class="spinner"></div>
                                        <p>ë Œë”ë§ ì¤‘... ì ì‹œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</p>
                                    </div>
                                </div>
                                <button class="btn btn-primary" id="render-btn" onclick="startRender()">ìµœì¢… ë Œë”ë§ ì‹œì‘</button>
                                    <div class="card" style="margin-top:12px;">
                                        <div class="card-header">Result</div>
                                        <div class="card-content" id="result-render">í˜„ì¬ ìƒíƒœ: ëŒ€ê¸°</div>
                                    </div>
                            </div>

                            <button class="btn btn-secondary" onclick="showSection('projects')">ëŒì•„ê°€ê¸°</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000/api';
        let currentProjectId = null;
        let isLoading = false; // Global loading state (Issue #4)
        let ttsSpeed = 1.0; // Global TTS speed state (Issue #3)

        // ============================================================================
        // LOADING MODAL FUNCTIONS (Issue #4)
        // ============================================================================
        function showLoadingModal(title = 'ìƒì„± ì¤‘ì…ë‹ˆë‹¤...', message = 'ì™„ë£Œë  ë•Œê¹Œì§€ ì ì‹œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.') {
            document.getElementById('loading-modal-title').textContent = title;
            document.getElementById('loading-modal-message').textContent = message;
            document.getElementById('loading-modal').classList.add('open');
            isLoading = true;
        }

        function hideLoadingModal() {
            document.getElementById('loading-modal').classList.remove('open');
            isLoading = false;
        }

        // ============================================================================
        // UNIFIED STEP NAVIGATION SYSTEM
        // ============================================================================
        
        // Single source of truth: step definitions
        const STEPS = [
            { key: "script", label: "ëŒ€ë³¸", num: 1, tabId: "script-tab" },
            { key: "tts", label: "TTS", num: 2, tabId: "tts-tab" },
            { key: "subtitles", label: "ìë§‰", num: 3, tabId: "subtitles-tab" },
            { key: "thumbnail", label: "ì¸ë„¤ì¼", num: 4, tabId: "thumbnail-tab" },
            { key: "bgm", label: "BGM", num: 5, tabId: "bgm-tab" },
            { key: "render", label: "ë Œë”ë§", num: 6, tabId: "render-tab" }
        ];

        // Current step state - SINGLE SOURCE OF TRUTH
        let currentStep = 0; // 0-5 index
        
        function setCurrentStep(stepIndex) {
            if (stepIndex < 0 || stepIndex >= STEPS.length) {
                console.warn("[NAV] Invalid step index:", stepIndex);
                return;
            }

            currentStep = stepIndex;
            console.log("[NAV] switched to step", STEPS[stepIndex].key, "index:", stepIndex);
            
            // Update top step buttons: activate only the current step
            document.querySelectorAll('.step').forEach((el, idx) => {
                el.classList.toggle('active', idx === stepIndex);
            });

            // Update bottom tab indicators (read-only sync)
            document.querySelectorAll('.tab-btn').forEach((el, idx) => {
                el.classList.toggle('active', idx === stepIndex);
            });

            // Show only the step's content tab
            document.querySelectorAll('.tab-content').forEach((el, idx) => {
                el.style.display = (idx === stepIndex) ? 'block' : 'none';
            });
        }

        function getCurrentStep() {
            return currentStep;
        }

        // ============================================================================
        // ë°±ì—”ë“œ ìƒíƒœ í™•ì¸
        async function checkBackend() {
            try {
                const response = await fetch(`${API_BASE}/health`);
                if (response.ok) {
                    document.getElementById('backend-status').textContent = 'ğŸŸ¢ ì—°ê²°ë¨';
                }
            } catch (error) {
                document.getElementById('backend-status').textContent = 'ğŸ”´ ì—°ê²° ëŠê¹€';
                showMessage('backend ì—°ê²° ì‹¤íŒ¨. í¬íŠ¸ 5000ì„ í™•ì¸í•˜ì„¸ìš”.', 'error');
            }
        }

        // ë©”ì‹œì§€ í‘œì‹œ
        function showMessage(text, type = 'success') {
            const area = document.getElementById('message-area');
            const div = document.createElement('div');
            div.className = `${type}-message`;
            div.textContent = text;
            area.appendChild(div);
            setTimeout(() => div.remove(), 3000);
        }

        // ì„¹ì…˜ ì „í™˜
        function showSection(sectionId) {
            document.querySelectorAll('.editor-section').forEach(el => el.classList.remove('active'));
            document.getElementById(`${sectionId}-section`).classList.add('active');
        }

        // í”„ë¡œì íŠ¸ ëª©ë¡ ë¡œë“œ
        async function refreshProjects() {
            try {
                const response = await fetch(`${API_BASE}/projects`);
                const data = await response.json();
                
                if (!data.ok || !data.projects) {
                    document.getElementById('projects-grid').innerHTML = '<p>í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                    return;
                }

                document.getElementById('project-count').textContent = data.projects.length + 'ê°œ';
                const grid = document.getElementById('projects-grid');
                grid.innerHTML = '';

                if (data.projects.length === 0) {
                    grid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #999;">í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.</p>';
                } else {
                    data.projects.forEach(project => {
                        const card = createProjectCard(project);
                        grid.appendChild(card);
                    });
                }

                document.getElementById('projects-loading').style.display = 'none';
                document.getElementById('projects-grid').style.display = 'grid';
            } catch (error) {
                console.error('í”„ë¡œì íŠ¸ ë¡œë“œ ì‹¤íŒ¨:', error);
                showMessage('í”„ë¡œì íŠ¸ ë¡œë“œ ì‹¤íŒ¨', 'error');
            }
        }

        // í”„ë¡œì íŠ¸ ì¹´ë“œ ìƒì„±
        function createProjectCard(project) {
            const card = document.createElement('div');
            card.className = 'project-card';
            
            const completionSteps = [
                project.scenes?.length > 0 ? 'script' : null,
                project.settings?.tts?.audio_paths?.length > 0 ? 'tts' : null,
                project.settings?.subtitles?.enabled ? 'srt' : null,
                project.settings?.thumbnail?.path ? 'thumbnail' : null,
                project.settings?.bgm?.enabled ? 'bgm' : null,
                project.rendered ? 'render' : null
            ].filter(Boolean);

            card.innerHTML = `
                <h3>${project.name || 'Untitled Project'}</h3>
                <p>ID: ${project.id}</p>
                <p>ìƒì„±ì¼: ${new Date(project.created_at).toLocaleDateString('ko-KR')}</p>
                <div class="project-status">
                    ${completionSteps.includes('script') ? '<span class="status-tag done">âœ“ ëŒ€ë³¸</span>' : ''}
                    ${completionSteps.includes('tts') ? '<span class="status-tag done">âœ“ TTS</span>' : ''}
                    ${completionSteps.includes('srt') ? '<span class="status-tag done">âœ“ ìë§‰</span>' : ''}
                    ${completionSteps.includes('thumbnail') ? '<span class="status-tag done">âœ“ ì¸ë„¤ì¼</span>' : ''}
                    ${completionSteps.includes('bgm') ? '<span class="status-tag done">âœ“ BGM</span>' : ''}
                    ${completionSteps.includes('render') ? '<span class="status-tag done">âœ“ ë Œë”ë§</span>' : ''}
                </div>
                <button class="btn btn-small btn-primary" onclick="window.location.href = '/project.html?id=${project.id}#script'" style="margin-top: 10px;">í¸ì§‘</button>
            `;
            return card;
        }

        // í”„ë¡œì íŠ¸ ìƒì„±
        async function createProject() {
            const name = document.getElementById('project-name').value;
            const type = document.getElementById('project-type').value;

            if (!name) {
                showMessage('í”„ë¡œì íŠ¸ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/projects`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, type })
                });
                
                const data = await response.json();
                if (data.ok) {
                    showMessage(`"${name}" í”„ë¡œì íŠ¸ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                    document.getElementById('project-name').value = '';
                    // Refresh list and open the newly created project for editing
                    refreshProjects();
                    if (data.projectId) {
                        window.location.href = `/project.html?id=${data.projectId}#script`;
                    }
                }
            } catch (error) {
                console.error('í”„ë¡œì íŠ¸ ìƒì„± ì‹¤íŒ¨:', error);
                showMessage('í”„ë¡œì íŠ¸ ìƒì„± ì‹¤íŒ¨', 'error');
            }
        }

        // í”„ë¡œì íŠ¸ ì—´ê¸°
        async function openProject(projectId) {
            currentProjectId = projectId;
            showSection('editor');
            document.getElementById('editor-title').textContent = `í”„ë¡œì íŠ¸ í¸ì§‘: ${projectId}`;
            
            // í”„ë¡œì íŠ¸ ë°ì´í„° ë¡œë“œ
            try {
                const response = await fetch(`${API_BASE}/projects/${projectId}`);
                const data = await response.json();
                if (data.ok) {
                    // keep project data handy for gating UI
                    window.currentProjectData = data.project;
                    // set header to project name if available
                    const displayName = data.project.name || data.project.topic || projectId;
                    document.getElementById('editor-title').textContent = `í”„ë¡œì íŠ¸ í¸ì§‘: ${displayName}`;
                    populateEditor(data.project);
                }
            } catch (error) {
                console.error('í”„ë¡œì íŠ¸ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // í¸ì§‘ê¸° ì±„ìš°ê¸°
        function populateEditor(project) {
            // ëŒ€ë³¸
            if (project.scenes?.[0]) {
                document.getElementById('script-text').value = project.scenes[0].text || '';
            }

            // ìŒì„± ì„ íƒ
            if (project.settings?.tts?.voice) {
                document.getElementById('voice-select').value = project.settings.tts.voice;
            }

            // ì¸ë„¤ì¼
            if (project.settings?.thumbnail) {
                document.getElementById('thumbnail-title').value = project.settings.thumbnail.title || '';
                document.getElementById('thumbnail-color').value = project.settings.thumbnail.bg_color || '#667eea';
            }

            // BGM
            if (project.settings?.bgm) {
                document.getElementById('bgm-enabled').checked = project.settings.bgm.enabled || false;
                document.getElementById('bgm-volume').value = (project.settings.bgm.volume * 100) || 50;
                updateBGMVolume();
            }

            // ì§„í–‰ ìƒí™© í‘œì‹œ
            updateProgress(project);
        }

        // ì§„í–‰ ìƒí™© í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateProgress(project) {
            // Mark completed steps with visual indicator
            const steps = document.querySelectorAll('.step');
            steps.forEach((step, index) => {
                step.classList.remove('completed');
                if (index === 0 && project.scenes?.length > 0) step.classList.add('completed');
                if (index === 1 && project.settings?.tts?.audio_paths?.length > 0) step.classList.add('completed');
                if (index === 2 && project.settings?.subtitles?.enabled) step.classList.add('completed');
                if (index === 3 && project.settings?.thumbnail?.path) step.classList.add('completed');
                if (index === 4 && project.settings?.bgm?.enabled) step.classList.add('completed');
                if (index === 5 && project.rendered) step.classList.add('completed');
            });
            
            // Attach click handlers - ALWAYS clickable for navigation
            attachStepClickHandlers(project);
        }

        function attachStepClickHandlers(project) {
            const steps = document.querySelectorAll('.step');
            steps.forEach((step, stepIndex) => {
                // Remove old listeners by cloning
                if (step.onclick) step.onclick = null;
                
                step.addEventListener('click', (e) => {
                    e.stopPropagation();
                    console.log("[NAV] step click", STEPS[stepIndex].key, "index:", stepIndex);
                    
                    // NAVIGATION ALWAYS WORKS - no prerequisites blocking
                    setCurrentStep(stepIndex);
                }, { once: false });
            });
        }

        // ëŒ€ë³¸ ì €ì¥
        async function updateScript() {
            const text = document.getElementById('script-text').value;
            if (!text) {
                showMessage('ëŒ€ë³¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            try {
                console.log('[TTS-GEN] Saving script for', currentProjectId, text.slice(0,120));
                const response = await fetch(`${API_BASE}/projects/${currentProjectId}/scenes`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text })
                });
                const respText = await response.text();
                let data = null;
                try { data = JSON.parse(respText); } catch (e) { /* not json */ }
                if (response.ok && data && data.ok) {
                    showMessage('ëŒ€ë³¸ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    console.log('[TTS-GEN] Script saved successfully');
                    // refresh local project data and update UI
                    if (data.projectId) {
                        const projResp = await fetch(`${API_BASE}/projects/${data.projectId}`);
                        const projData = await projResp.json();
                        if (projData.ok) {
                            window.currentProjectData = projData.project;
                            populateEditor(projData.project);
                            refreshProjects();
                        }
                    }
                } else {
                    const errMsg = (data && data.error) ? data.error : respText || 'Unknown error';
                    console.error('[TTS-GEN] Failed:', response.status, errMsg);
                    showMessage(`ëŒ€ë³¸ ì €ì¥ ì‹¤íŒ¨: ${response.status} ${errMsg}`, 'error');
                }
            } catch (error) {
                console.error('[TTS-GEN] Exception:', error);
                showMessage('ëŒ€ë³¸ ì €ì¥ ì‹¤íŒ¨', 'error');
            }
        }

        // TTS ç”Ÿæˆ (Issue #1, #3, #4 fixes)
        async function generateTTS() {
            if (!currentProjectId) return showMessage('í”„ë¡œì íŠ¸ë¥¼ ë¨¼ì € ì—´ì–´ì£¼ì„¸ìš”.', 'error');

            // Check prerequisites but allow user to stay in the step to see the issue
            const hasScript = window.currentProjectData?.scenes?.length > 0 && 
                             (window.currentProjectData.scenes[0].text || window.currentProjectData.scenes[0].narration_ko);
            if (!hasScript) {
                showMessage('âš ï¸ ëŒ€ë³¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¨¼ì € "ëŒ€ë³¸" ë‹¨ê³„ì—ì„œ ëŒ€ë³¸ì„ ì €ì¥í•´ì£¼ì„¸ìš”.', 'error');
                const resultEl = document.getElementById('result-tts');
                if (resultEl) {
                    resultEl.innerHTML = '<span style="color: #f44336;">ëŒ€ë³¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</span> <button class="btn btn-small btn-secondary" onclick="setCurrentStep(0)" style="margin-top:8px;">ëŒ€ë³¸ìœ¼ë¡œ ì´ë™</button>';
                }
                return;
            }

            try {
                showLoadingModal('TTS ìƒì„± ì¤‘...', 'AI ìŒì„±ì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤. ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.');
                console.log('[TTS-GEN] TTS button clicked for', currentProjectId);
                
                const voice = document.getElementById('voice-select').value;
                ttsSpeed = parseFloat(document.getElementById('tts-speed-select').value);
                const sceneId = window.currentProjectData?.scenes?.[0]?.id;
                
                if (!sceneId) {
                    showMessage('ëŒ€ë³¸ì„ ì €ì¥í•œ í›„ TTSë¥¼ ìƒì„±í•˜ì„¸ìš”.', 'error');
                    hideLoadingModal();
                    return;
                }

                // Include speed in request body (Issue #3)
                const response = await fetch(`${API_BASE}/projects/${currentProjectId}/generate/tts`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ voice, sceneId, speed: ttsSpeed })
                });

                const respText = await response.text();
                let data = null;
                try { data = JSON.parse(respText); } catch (e) { /* ignore */ }

                const resultEl = document.getElementById('result-tts');
                if (response.ok && data && data.ok) {
                    showMessage('TTS ìƒì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    console.log('[TTS-GEN] TTS success', data);
                    refreshProjects();

                    // clear and show detailed result
                    resultEl.innerHTML = '';
                    const info = document.createElement('div');
                    info.textContent = `ì˜¤ë””ì˜¤ ìƒì„±: ${data.audioPath} (ê¸¸ì´: ${Math.round((data.durationSec||0)*1000)/1000}s, ë°°ì†: ${ttsSpeed}ë°°)`;
                    resultEl.appendChild(info);

                    if (data.audioPath) {
                        // Use preview endpoint with cache buster (Issue #1 - fix A)
                        const previewUrl = `${API_BASE}/projects/${currentProjectId}/preview?path=${encodeURIComponent(data.audioPath)}&v=${Date.now()}`;
                        
                        const audio = document.createElement('audio');
                        audio.controls = true;
                        audio.src = previewUrl;
                        audio.style.display = 'block';
                        audio.style.marginTop = '8px';
                        
                        // Error handling (Issue #1 - fix C)
                        audio.onerror = (e) => {
                            console.error('[TTS-GEN] Audio playback error:', e);
                            const errorDiv = document.createElement('div');
                            errorDiv.className = 'audio-error';
                            errorDiv.textContent = `âŒ ì˜¤ë””ì˜¤ ì¬ìƒ ì‹¤íŒ¨ (ìƒíƒœ: ${audio.error?.code || 'unknown'})`;
                            resultEl.appendChild(errorDiv);
                            
                            // Offer download as fallback
                            const fallbackBtn = document.createElement('a');
                            fallbackBtn.className = 'btn btn-small btn-secondary';
                            fallbackBtn.href = `${API_BASE}/projects/${currentProjectId}/download?path=${encodeURIComponent(data.audioPath)}`;
                            fallbackBtn.textContent = 'ëŒ€ì‹  ë‹¤ìš´ë¡œë“œí•˜ê¸°';
                            fallbackBtn.style.display = 'inline-block';
                            fallbackBtn.style.marginTop = '8px';
                            resultEl.appendChild(fallbackBtn);
                        };
                        
                        resultEl.appendChild(audio);

                        // Download link
                        const dl = document.createElement('a');
                        dl.href = `${API_BASE}/projects/${currentProjectId}/download?path=${encodeURIComponent(data.audioPath)}`;
                        dl.textContent = 'ì˜¤ë””ì˜¤ ë‹¤ìš´ë¡œë“œ';
                        dl.style.display = 'inline-block';
                        dl.style.marginTop = '8px';
                        dl.style.marginLeft = '10px';
                        resultEl.appendChild(dl);
                    }
                } else {
                    const errMsg = (data && data.error) ? data.error : respText || 'Unknown error';
                    console.error('[TTS-GEN] TTS failed:', response.status, errMsg);
                    showMessage(`TTS ì‹¤íŒ¨: ${response.status} ${errMsg}`, 'error');
                    if (resultEl) resultEl.textContent = `ì‹¤íŒ¨: ${errMsg}`;
                }
            } catch (error) {
                console.error('[TTS-GEN] Exception:', error);
                showMessage('TTS ìƒì„± ì‹¤íŒ¨', 'error');
                const resultEl = document.getElementById('result-tts');
                if (resultEl) resultEl.textContent = 'TTS ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
            } finally {
                hideLoadingModal();
            }
        }

            // ìë§‰ ìƒì„± (Issue #4 - add loading modal)
            async function generateSubtitles() {
                if (!currentProjectId) return showMessage('í”„ë¡œì íŠ¸ë¥¼ ë¨¼ì € ì—´ì–´ì£¼ì„¸ìš”.', 'error');
                
                // Check prerequisite: TTS audio exists
                const hasTTS = window.currentProjectData?.settings?.tts?.audio_paths?.length > 0;
                if (!hasTTS) {
                    showMessage('âš ï¸ TTS ì˜¤ë””ì˜¤ê°€ í•„ìš”í•©ë‹ˆë‹¤. ë¨¼ì € "TTS" ë‹¨ê³„ë¥¼ ì™„ë£Œí•´ì£¼ì„¸ìš”.', 'error');
                    const resultEl = document.getElementById('result-subtitles');
                    if (resultEl) {
                        resultEl.innerHTML = '<span style="color: #f44336;">TTS ì˜¤ë””ì˜¤ê°€ í•„ìš”í•©ë‹ˆë‹¤.</span> <button class="btn btn-small btn-secondary" onclick="setCurrentStep(1)" style="margin-top:8px;">TTSë¡œ ì´ë™</button>';
                    }
                    return;
                }
                
                try {
                    showLoadingModal('ìë§‰ ìƒì„± ì¤‘...', 'AIê°€ ìë§‰ì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤.');
                    console.log('[SUBTITLE] Generating subtitles for', currentProjectId);
                    const response = await fetch(`${API_BASE}/projects/${currentProjectId}/generate/srt`, {
                        method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({})
                    });
                    const data = await response.json();
                    const resultEl = document.getElementById('result-subtitles');
                    if (data.ok) {
                        showMessage('ìë§‰ ìƒì„± ì™„ë£Œ');
                        console.log('[SUBTITLE] Success');
                        resultEl.innerHTML = '';
                        const info = document.createElement('div');
                        info.textContent = `SRT ìƒì„±: ${data.srtPath || data.srtPath}`;
                        resultEl.appendChild(info);

                        const viewBtn = document.createElement('button');
                        viewBtn.className = 'btn btn-small btn-secondary';
                        viewBtn.textContent = 'View';
                        viewBtn.onclick = () => fetchTextAndOpen(data.srtPath, 'Subtitles');
                        resultEl.appendChild(viewBtn);

                        const dl = document.createElement('a');
                        dl.href = `${API_BASE}/projects/${currentProjectId}/download?path=${encodeURIComponent(data.srtPath)}`;
                        dl.textContent = 'Download';
                        dl.className = 'btn btn-small';
                        dl.style.marginLeft = '8px';
                        resultEl.appendChild(dl);

                        refreshProjects();
                    } else {
                        console.error('[SUBTITLE] Failed', data);
                        showMessage('ìë§‰ ìƒì„± ì‹¤íŒ¨: ' + (data.error || 'Unknown'), 'error');
                    }
                } catch (e) {
                    console.error('[SUBTITLE] Exception', e);
                    showMessage('ìë§‰ ìƒì„± ì‹¤íŒ¨', 'error');
                } finally {
                    hideLoadingModal();
                }
            }

            // Fetch text file and open modal
            async function fetchTextAndOpen(relpath, title) {
                if (!currentProjectId) return showMessage('í”„ë¡œì íŠ¸ë¥¼ ë¨¼ì € ì—´ì–´ì£¼ì„¸ìš”.', 'error');
                try {
                    const resp = await fetch(`${API_BASE}/projects/${currentProjectId}/text?path=${encodeURIComponent(relpath)}`);
                    const data = await resp.json();
                    if (resp.ok && data.ok) {
                        let content = data.content || '';
                        const ext = (data.path || '').split('.').pop();
                        if (ext === 'json') {
                            try { content = JSON.stringify(JSON.parse(content), null, 2); } catch (e) { /* ignore */ }
                        }
                        openTextViewer(title || data.path, content, ext);
                    } else {
                        const err = data && data.error ? data.error : (await resp.text());
                        showMessage('íŒŒì¼ ì½ê¸° ì‹¤íŒ¨: ' + err, 'error');
                    }
                } catch (e) {
                    console.error('íŒŒì¼ ì½ê¸° ì‹¤íŒ¨', e);
                    showMessage('íŒŒì¼ ì½ê¸° ì‹¤íŒ¨', 'error');
                }
            }

            function openTextViewer(title, content, languageHint) {
                const overlay = document.getElementById('textviewer-modal');
                document.getElementById('textviewer-title').textContent = title || '';
                const pre = document.getElementById('textviewer-pre');
                pre.textContent = content || '';
                overlay.style.display = 'flex';
            }

            function closeTextViewer() {
                document.getElementById('textviewer-modal').style.display = 'none';
            }

            function copyTextViewer() {
                const pre = document.getElementById('textviewer-pre');
                navigator.clipboard.writeText(pre.textContent).then(() => showMessage('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.'))
                .catch(err => showMessage('ë³µì‚¬ ì‹¤íŒ¨', 'error'));
            }

        // ì¸ë„¤ì¼ ìƒì„± (Issue #4 - add loading modal)
        async function generateThumbnail() {
            if (!currentProjectId) return;

            try {
                showLoadingModal('ì¸ë„¤ì¼ ìƒì„± ì¤‘...', 'AIê°€ ì¸ë„¤ì¼ì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤.');
                const title = document.getElementById('thumbnail-title').value;
                const bg_color = document.getElementById('thumbnail-color').value;
                
                const response = await fetch(`${API_BASE}/projects/${currentProjectId}/generate/thumbnail`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title, bg_color })
                });
                
                const data = await response.json();
                if (data.ok) {
                    showMessage('ì¸ë„¤ì¼ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    refreshProjects();
                } else {
                    showMessage('ì¸ë„¤ì¼ ìƒì„± ì‹¤íŒ¨: ' + (data.error || 'Unknown'), 'error');
                }
            } catch (error) {
                console.error('ì¸ë„¤ì¼ ìƒì„± ì‹¤íŒ¨:', error);
                showMessage('ì¸ë„¤ì¼ ìƒì„± ì‹¤íŒ¨', 'error');
            } finally {
                hideLoadingModal();
            }
        }

        // BGM í† ê¸€
        function toggleBGM() {
            const enabled = document.getElementById('bgm-enabled').checked;
            updateBGMSettings({ enabled });
        }

        // BGM ë³¼ë¥¨ ì—…ë°ì´íŠ¸
        function updateBGMVolume() {
            const volume = document.getElementById('bgm-volume').value;
            document.getElementById('volume-display').textContent = volume + '%';
            updateBGMSettings({ volume: volume / 100 });
        }

        // BGM ì„¤ì • ì—…ë°ì´íŠ¸
        async function updateBGMSettings(settings) {
            if (!currentProjectId) return;

            try {
                const response = await fetch(`${API_BASE}/projects/${currentProjectId}/settings/bgm`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(settings)
                });
                
                const data = await response.json();
                if (!data.ok) {
                    showMessage('BGM ì„¤ì • ì‹¤íŒ¨', 'error');
                }
            } catch (error) {
                console.error('BGM ì„¤ì • ì‹¤íŒ¨:', error);
            }
        }

        // BGM ì—…ë¡œë“œ
        async function uploadBGM() {
            const file = document.getElementById('bgm-file').files[0];
            if (!file) {
                showMessage('íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            try {
                const formData = new FormData();
                formData.append('file', file);

                const response = await fetch(`${API_BASE}/projects/${currentProjectId}/upload/bgm`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                if (data.ok) {
                    showMessage('BGM íŒŒì¼ì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    document.getElementById('bgm-file').value = '';
                }
            } catch (error) {
                console.error('BGM ì—…ë¡œë“œ ì‹¤íŒ¨:', error);
                showMessage('BGM ì—…ë¡œë“œ ì‹¤íŒ¨', 'error');
            }
        }

        // ë Œë”ë§ ì‹œì‘ (Issue #4 - add loading modal)
        async function startRender() {
            if (!currentProjectId) return;

            try {
                showLoadingModal('ì˜ìƒ ë Œë”ë§ ì¤‘...', 'ìµœì¢… ì˜ìƒì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                document.getElementById('render-btn').disabled = true;
                document.getElementById('render-progress').style.display = 'block';

                const response = await fetch(`${API_BASE}/projects/${currentProjectId}/render`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
                
                const data = await response.json();
                if (data.ok) {
                    showMessage('ì˜ìƒ ë Œë”ë§ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
                    refreshProjects();
                } else {
                    showMessage('ë Œë”ë§ ì‹¤íŒ¨: ' + (data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'), 'error');
                }
            } catch (error) {
                console.error('ë Œë”ë§ ì‹¤íŒ¨:', error);
                showMessage('ë Œë”ë§ ì‹¤íŒ¨', 'error');
            } finally {
                hideLoadingModal();
                document.getElementById('render-btn').disabled = false;
                document.getElementById('render-progress').style.display = 'none';
            }
        }

        // ì´ˆê¸°í™”
        window.addEventListener('load', () => {
            console.log('[UI] Application initialized');
            checkBackend();
            refreshProjects();

            // Initialize step navigation
            console.log('[NAV] Setting up step navigation system');
            setCurrentStep(0);
        });
    </script>
    <!-- Text viewer modal -->
    <div id="textviewer-modal" class="modal-overlay" onclick="if(event.target.id==='textviewer-modal') closeTextViewer()">
        <div class="modal-box" role="dialog" aria-modal="true">
            <div class="modal-header">
                <div class="modal-title" id="textviewer-title">íŒŒì¼ ë‚´ìš©</div>
                <div class="modal-actions">
                    <button class="btn btn-small btn-secondary" onclick="copyTextViewer()">Copy</button>
                    <button class="btn btn-small" onclick="closeTextViewer()">Close</button>
                </div>
            </div>
            <div class="modal-content">
                <pre id="textviewer-pre"> </pre>
            </div>
        </div>
    </div>

    <!-- Loading Modal (Issue #4) -->
    <div id="loading-modal" class="loading-modal">
        <div class="loading-modal-content">
            <div class="loading-modal-spinner"></div>
            <div class="loading-modal-title" id="loading-modal-title">ìƒì„± ì¤‘ì…ë‹ˆë‹¤...</div>
            <div class="loading-modal-message" id="loading-modal-message">ì™„ë£Œë  ë•Œê¹Œì§€ ì ì‹œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.</div>
        </div>
    </div>
</body>
</html>
