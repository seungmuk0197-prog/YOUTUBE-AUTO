<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>10. ì‡¼ì¸  ìë™ ë³€í™˜</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Malgun Gothic", sans-serif;
      background: #f5f5f5;
      color: #333;
      min-height: 100vh;
    }
    .layout { display: flex; min-height: 100vh; padding-top: 0; }
    .sidebar {
      width: 300px;
      background: linear-gradient(180deg, #fafbff 0%, #f2f4f8 100%);
      border-right: 1px solid #e8ecf4;
      padding: 20px 16px 24px;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      gap: 20px;
      height: 100vh;
      overflow-y: auto;
    }
    .sidebar-logo {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      font-weight: 700;
      font-size: 1.5rem;
      letter-spacing: 0.05em;
      color: #2d3748;
      margin-top: 8px;
      margin-bottom: 0;
      padding-left: 4px;
      text-align: left;
    }
    .sidebar-card {
      background: #fff;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.06);
      border: 1px solid rgba(0,0,0,0.04);
    }
    /* í˜„ì¬ í”„ë¡œì íŠ¸ */
    .project-label {
      font-size: 12px;
      color: #718096;
      margin-bottom: 6px;
    }
    .project-name-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 14px;
    }
    .project-name {
      font-size: 16px;
      font-weight: 700;
      color: #1a202c;
    }
    .project-name-edit {
      color: #718096;
      cursor: pointer;
      font-size: 14px;
    }
    .project-name-edit:hover {
      color: #3182ce;
    }
    /* í”„ë¡œì íŠ¸ ì•¡ì…˜ í•œ ì¤„ ë°°ì¹˜ */
    .project-actions-row {
      display: flex;
      gap: 6px;
      margin-top: 8px;
    }
    .sidebar-btn-inline {
      flex: 1;
      padding: 8px 12px;
      border: none;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }
    .sidebar-btn-inline-primary {
      background: linear-gradient(135deg, #805ad5 0%, #6b46c1 100%);
      color: #fff;
    }
    .sidebar-btn-inline-primary:hover {
      background: linear-gradient(135deg, #6b46c1 0%, #553c9a 100%);
    }
    .sidebar-btn-inline-secondary {
      background: #fff;
      color: #2d3748;
      border: 1px solid #e2e8f0;
    }
    .sidebar-btn-inline-secondary:hover {
      background: #f7fafc;
      border-color: #cbd5e0;
    }
    .workflow-title {
      font-size: 13px;
      font-weight: 700;
      color: #4a5568;
      margin-bottom: 12px;
      padding: 0 4px;
    }
    .workflow-list { list-style: none; padding-right: 4px; }
    .workflow-item {
      display: block;
      padding: 12px 14px;
      margin-bottom: 6px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 500;
      color: #4a5568;
      background: #fff;
      border: 1px solid #e2e8f0;
      text-decoration: none;
      transition: background 0.2s, color 0.2s, border-color 0.2s;
    }
    .workflow-item:hover { background: #f7fafc; border-color: #cbd5e0; color: #2d3748; }
    .workflow-item.active {
      background: linear-gradient(135deg, #e9d8fd 0%, #e2e8f0 100%);
      border-color: #b794f4;
      color: #553c9a;
      font-weight: 600;
    }

    .main {
      flex: 1;
      padding: 24px 32px 40px;
      overflow-y: auto;
    }
    .header-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 24px;
      margin-top: 0;
      padding-top: 0;
    }
    .title-area { flex: 1; }
    .title-area h1 {
      font-size: 24px;
      font-weight: 700;
      color: #222;
      margin-bottom: 4px;
      margin-top: 0;
      line-height: 1.3;
    }
    .title-area .subtitle {
      font-size: 14px;
      color: #666;
      margin: 0;
      line-height: 1.4;
    }
    .header-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 8px;
    }
    .login-inline-row {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .login-input {
      height: 32px;
      padding: 0 10px;
      border: 1px solid #cbd5e0;
      border-radius: 4px;
      font-size: 13px;
      box-sizing: border-box;
      transition: background-color 0.2s, border-color 0.2s;
      width: 140px;
    }
    .login-input::placeholder { color: #a0aec0; }
    .login-input:disabled {
      background-color: #E0E0E0;
      border-color: #999;
      color: #666;
      cursor: not-allowed;
      pointer-events: none;
    }
    .btn-admin, .btn-login {
      padding: 0 12px;
      height: 32px;
      background: #e0e0e0;
      color: #333;
      border: 1px solid #c0c0c0;
      border-radius: 4px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
    }
    .btn-admin:hover, .btn-login:hover { background: #d5d5d5; }

    /* Content Card */
    .content-card {
      background: #fff;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 20px;
    }
    .field-label {
      font-size: 15px;
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 16px;
    }
    .section-desc {
      font-size: 13px;
      color: #666;
      margin-bottom: 16px;
      line-height: 1.6;
    }

    /* Platform Selector */
    .platform-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      margin-bottom: 24px;
    }
    .platform-card {
      padding: 20px;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      background: #fff;
    }
    .platform-card:hover {
      border-color: #cbd5e0;
      background: #f7fafc;
    }
    .platform-card.selected {
      border-color: #805ad5;
      background: #f3e8ff;
    }
    .platform-icon {
      font-size: 32px;
      margin-bottom: 8px;
    }
    .platform-name {
      font-size: 15px;
      font-weight: 600;
      color: #2d3748;
      margin-bottom: 4px;
    }
    .platform-ratio {
      font-size: 12px;
      color: #666;
    }

    /* Preview Section */
    .preview-container {
      display: flex;
      gap: 24px;
      align-items: flex-start;
    }
    .preview-wrapper {
      flex: 1;
      max-width: 400px;
    }
    .phone-frame {
      width: 100%;
      aspect-ratio: 9/16;
      background: #000;
      border-radius: 24px;
      padding: 8px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
      position: relative;
    }
    .phone-screen {
      width: 100%;
      height: 100%;
      background: #000;
      border-radius: 16px;
      overflow: hidden;
      position: relative;
    }
    .video-preview {
      width: 100%;
      height: 100%;
      object-fit: cover;
      background: #1a1a1a;
      position: relative;
    }
    .video-timeline-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: rgba(255, 255, 255, 0.2);
      z-index: 15;
    }
    .timeline-hotspot {
      position: absolute;
      bottom: 0;
      width: 3px;
      height: 100%;
      background: #ff6fae;
      z-index: 16;
      pointer-events: none;
    }
    .timeline-hotspot-icon {
      position: absolute;
      bottom: 8px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 14px;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));
    }
    .platform-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
      z-index: 10;
    }
    .overlay-top {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 80px;
      background: linear-gradient(to bottom, rgba(0,0,0,0.3), transparent);
    }
    .overlay-bottom {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 120px;
      background: linear-gradient(to top, rgba(0,0,0,0.3), transparent);
    }
    .overlay-safe-area {
      position: absolute;
      top: 80px;
      left: 0;
      right: 0;
      bottom: 120px;
      border: 2px dashed rgba(255,255,255,0.3);
    }

    .preview-info {
      flex: 1;
    }
    .info-item {
      margin-bottom: 16px;
    }
    .info-label {
      font-size: 12px;
      font-weight: 600;
      color: #4a5568;
      margin-bottom: 6px;
    }
    .info-value {
      font-size: 14px;
      color: #2d3748;
      line-height: 1.6;
    }

    /* Action Buttons */
    .action-buttons {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }
    .btn-primary {
      padding: 12px 24px;
      background: #e53935;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.2s;
    }
    .btn-primary:hover { background: #c62828; }
    .btn-primary:disabled {
      background: #cbd5e0;
      cursor: not-allowed;
    }
    .btn-secondary {
      padding: 12px 24px;
      background: #fff;
      color: #4a5568;
      border: 1px solid #cbd5e0;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-secondary:hover {
      background: #f7fafc;
      border-color: #a0aec0;
    }

    /* Loading State */
    .loading-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.7);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 12px;
      border-radius: 16px;
      z-index: 20;
    }
    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(255,255,255,0.3);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .loading-text {
      color: #fff;
      font-size: 14px;
      font-weight: 600;
    }

    /* Waveform & Hotspot Visualization */
    .waveform-section {
      margin-top: 16px;
      padding: 12px;
      background: #f7fafc;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
    }
    .waveform-label {
      font-size: 12px;
      font-weight: 600;
      color: #4a5568;
      margin-bottom: 8px;
    }
    .waveform-container {
      width: 100%;
      height: 80px;
      background: #fff;
      border-radius: 6px;
      position: relative;
      overflow: hidden;
    }
    .hotspot-marker {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 3px;
      background: #ff6fae;
      z-index: 10;
      pointer-events: none;
    }
    .hotspot-icon {
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 16px;
      z-index: 11;
    }
    .hotspot-label {
      position: absolute;
      top: -40px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 10px;
      font-weight: 600;
      color: #ff6fae;
      white-space: nowrap;
    }
    .hotspot-tooltip {
      position: absolute;
      top: -60px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: #fff;
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 11px;
      white-space: nowrap;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.2s;
    }
    .hotspot-marker:hover .hotspot-tooltip {
      opacity: 1;
    }

    /* Effect Intensity Slider */
    .intensity-control {
      margin-top: 16px;
      padding: 16px;
      background: #f7fafc;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
    }
    .intensity-label {
      font-size: 13px;
      font-weight: 600;
      color: #4a5568;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .intensity-value {
      font-size: 12px;
      color: #805ad5;
      font-weight: 700;
    }
    .intensity-slider {
      width: 100%;
      height: 6px;
      border-radius: 3px;
      background: #e2e8f0;
      outline: none;
      -webkit-appearance: none;
    }
    .intensity-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #805ad5;
      cursor: pointer;
    }
    .intensity-slider::-moz-range-thumb {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #805ad5;
      cursor: pointer;
      border: none;
    }
    .intensity-steps {
      display: flex;
      justify-content: space-between;
      margin-top: 6px;
      font-size: 10px;
      color: #999;
    }

    /* ì‡¼ì¸  ì‹œë®¬ë ˆì´í„° íš¨ê³¼ ë ˆì´ì–´ */
    .effect-layer {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
      z-index: 20;
      border-radius: 16px;
      overflow: hidden;
    }

    /* ë¹„íŠ¸ ë“œë¡­ ì‹œë®¬ë ˆì´ì…˜ìš© CSS ì• ë‹ˆë©”ì´ì…˜ */
    :root {
      --effect-shake: 4px;
      --effect-saturate: 1.6;
      --effect-brightness: 1.2;
      --effect-opacity: 0.5;
    }

    @keyframes shake {
      0%, 100% { transform: translate(0, 0); }
      10% { transform: translate(calc(-1 * var(--effect-shake)), calc(-0.5 * var(--effect-shake))) rotate(-0.5deg); }
      20% { transform: translate(var(--effect-shake), calc(0.5 * var(--effect-shake))) rotate(0.5deg); }
      30% { transform: translate(calc(-0.5 * var(--effect-shake)), var(--effect-shake)) rotate(-0.3deg); }
      40% { transform: translate(calc(0.5 * var(--effect-shake)), calc(-1 * var(--effect-shake))) rotate(0.3deg); }
      50% { transform: translate(calc(-1 * var(--effect-shake)), calc(0.5 * var(--effect-shake))) rotate(-0.5deg); }
      60% { transform: translate(var(--effect-shake), calc(-0.5 * var(--effect-shake))) rotate(0.5deg); }
      70% { transform: translate(calc(-0.5 * var(--effect-shake)), calc(-1 * var(--effect-shake))) rotate(-0.3deg); }
      80% { transform: translate(calc(0.5 * var(--effect-shake)), var(--effect-shake)) rotate(0.3deg); }
      90% { transform: translate(calc(-1 * var(--effect-shake)), calc(-0.5 * var(--effect-shake))) rotate(-0.5deg); }
    }
    @keyframes glow {
      0%, 100% { opacity: 0; }
      50% { opacity: 0.6; }
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }

    .effect-shake {
      animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
    }
    .effect-saturate {
      filter: saturate(var(--effect-saturate)) contrast(1.2);
      transition: filter 0.1s;
    }
    .effect-lightleak {
      background: radial-gradient(circle, rgba(255,255,255,calc(0.8 * var(--effect-opacity))) 0%, transparent 70%);
      mix-blend-mode: overlay;
      animation: glow 0.8s ease-in-out;
    }
    .effect-brightness {
      filter: brightness(var(--effect-brightness));
      transition: filter 0.2s;
    }
    .effect-bounce {
      animation: pulse 0.3s ease-in-out;
    }

    /* í”Œë«í¼ UI ì˜¤ë²„ë ˆì´ */
    .platform-ui-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
      z-index: 15;
    }
    .platform-ui-top {
      position: absolute;
      top: 12px;
      left: 12px;
      right: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .platform-ui-profile {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #fff;
      font-size: 12px;
      font-weight: 600;
    }
    .platform-ui-profile-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: rgba(255,255,255,0.3);
      border: 2px solid rgba(255,255,255,0.5);
    }
    .platform-ui-bottom {
      position: absolute;
      bottom: 12px;
      left: 12px;
      right: 12px;
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
    }
    .platform-ui-actions {
      display: flex;
      flex-direction: column;
      gap: 16px;
      align-items: center;
    }
    .platform-ui-action-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(0,0,0,0.5);
      backdrop-filter: blur(8px);
      border: 1px solid rgba(255,255,255,0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 18px;
      cursor: pointer;
    }
    .platform-ui-title {
      flex: 1;
      color: #fff;
      font-size: 13px;
      font-weight: 600;
      margin-left: 12px;
      text-shadow: 0 1px 3px rgba(0,0,0,0.5);
    }

    /* ì‹œê°í™” íƒ€ì„ë¼ì¸ */
    .visual-timeline {
      margin-top: 16px;
      padding: 12px;
      background: #fff;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
    }
    .timeline-track {
      position: relative;
      height: 40px;
      background: #f7fafc;
      border-radius: 6px;
      margin-bottom: 8px;
      overflow: hidden;
    }
    .timeline-segment {
      position: absolute;
      top: 0;
      bottom: 0;
      height: 100%;
      opacity: 0.6;
      border-radius: 6px;
    }
    .timeline-segment.hook {
      background: linear-gradient(90deg, #ff6fae 0%, #ff8cc8 100%);
    }
    .timeline-segment.insight {
      background: linear-gradient(90deg, #805ad5 0%, #b794f4 100%);
    }
    .timeline-hotspot-marker {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 3px;
      background: #ff6fae;
      z-index: 10;
    }
    .timeline-hotspot-icon {
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 16px;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
    }
    .timeline-label {
      font-size: 11px;
      font-weight: 600;
      color: #4a5568;
      margin-bottom: 6px;
    }

    /* ë‹¤ì´ë‚´ë¯¹ ìë§‰ ìŠ¤íƒ€ì¼ */
    .subtitle-simulator {
      position: absolute;
      bottom: 140px; /* í”Œë«í¼ UI í•˜ë‹¨ ë²„íŠ¼ ìœ„ìª½ */
      left: 50%;
      transform: translateX(-50%);
      width: calc(100% - 24px);
      max-width: 90%;
      z-index: 25;
      pointer-events: none;
      text-align: center;
    }
    .subtitle-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 4px;
      padding: 12px 16px;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(8px);
      border-radius: 12px;
      min-height: 60px;
    }
    .dynamic-word {
      display: inline-block;
      font-weight: 900;
      font-size: calc(1.8rem + var(--subtitle-scale, 0) * 0.3rem);
      color: rgba(255, 255, 255, 0.4);
      text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.9),
                   -1px -1px 0 rgba(0, 0, 0, 0.8),
                   1px -1px 0 rgba(0, 0, 0, 0.8),
                   -1px 1px 0 rgba(0, 0, 0, 0.8),
                   1px 1px 0 rgba(0, 0, 0, 0.8);
      transition: all 0.2s ease-out;
      line-height: 1.4;
    }
    .dynamic-word.past {
      opacity: 0.3;
      transform: scale(0.9);
    }
    .dynamic-word.current {
      opacity: 1;
      color: #000000;
      background-color: #ffff00;
      padding: 4px 10px;
      border-radius: 6px;
      box-shadow: 0 4px 12px rgba(255, 255, 0, 0.5);
      text-shadow: none;
      font-weight: 900;
    }
    .dynamic-word.future {
      opacity: 0.4;
      transform: scale(0.95);
    }
    @keyframes word-pop {
      0% { 
        transform: scale(0.8); 
        opacity: 0; 
      }
      50% {
        transform: scale(1.15);
      }
      100% { 
        transform: scale(1); 
        opacity: 1; 
      }
    }
    .dynamic-word.pop {
      animation: word-pop calc(0.15s * var(--animation-speed, 1)) ease-out forwards;
    }
  </style>
</head>
<body>
  <div class="layout">
    <aside class="sidebar">
      <div class="sidebar-logo">HANRA STUDIO</div>

      <!-- í˜„ì¬ í”„ë¡œì íŠ¸ -->
      <div class="sidebar-card">
        <div class="project-label">í˜„ì¬ í”„ë¡œì íŠ¸</div>
        <div class="project-name-row">
          <span class="project-name">ìƒˆë¡œìš´ í”„ë¡œì íŠ¸</span>
          <span class="project-name-edit" title="ì´ë¦„ ìˆ˜ì •">âœ</span>
        </div>
        <div class="project-actions-row">
          <button type="button" class="sidebar-btn-inline sidebar-btn-inline-primary" id="btnCreateProject">
            Pìƒì„±
          </button>
          <button type="button" class="sidebar-btn-inline sidebar-btn-inline-secondary" id="btnProjectList">
            Pëª©ë¡
          </button>
        </div>
      </div>

      <div class="sidebar-card">
        <div class="workflow-title">ì§„í–‰ ë‹¨ê³„</div>
        <ul class="workflow-list">
          <li><a href="ai-automation-project.html" class="workflow-item">1. ì£¼ì œ ì¶”ì²œ</a></li>
          <li><a href="step-2.html" class="workflow-item">2. AI ëŒ€ë³¸ ìƒì„±</a></li>
          <li><a href="step-3.html" class="workflow-item">3. ëŒ€ë³¸ ì§ì ‘ ì…ë ¥</a></li>
          <li><a href="step-4-1.html" class="workflow-item">4-1. JSON ìƒì„±</a></li>
          <li><a href="step-4-2.html" class="workflow-item">4-2. ì´ë¯¸ì§€ ìƒì„±</a></li>
          <li><a href="step-6.html" class="workflow-item">5. TTS ìƒì„±</a></li>
          <li><a href="step-5-2.html" class="workflow-item">5-2. BGM ì‚½ì…</a></li>
          <li><a href="step-7.html" class="workflow-item">6. ì˜ìƒ ë Œë”ë§</a></li>
          <li><a href="step-8.html" class="workflow-item">7. ì œëª©/ì„¤ëª… ì‘ì„±</a></li>
          <li><a href="step-9.html" class="workflow-item">8. ì¸ë„¤ì¼ ìƒì„±ê¸°</a></li>
          <li><a href="step-10.html" class="workflow-item">9. ìµœì¢… ì œì‘</a></li>
          <li><a href="step-11.html" class="workflow-item active">10. ì‡¼ì¸  ìë™ ë³€í™˜</a></li>
          <li><a href="step-12.html" class="workflow-item">11. ì±„ë„ ë§¤ë‹ˆì €</a></li>
          <li><a href="step-13.html" class="workflow-item">12. ì‘ì—… ë³´ê´€í•¨</a></li>
        </ul>
      </div>
    </aside>

    <main class="main">
      <div class="header-row">
        <div class="title-area">
          <h1>10. ì‡¼ì¸  ìë™ ë³€í™˜</h1>
          <p class="subtitle">ê°€ë¡œ ì˜ìƒì„ ì„¸ë¡œ ì‡¼ì¸  í˜•ì‹ìœ¼ë¡œ ìë™ ë³€í™˜í•˜ê³  í”Œë«í¼ë³„ ìµœì í™”ë¥¼ ì ìš©í•©ë‹ˆë‹¤</p>
        </div>
        <div class="header-right">
          <div class="login-inline-row">
            <input type="text" class="login-input" id="loginId" placeholder="ID" />
            <input type="password" class="login-input" id="loginPw" placeholder="Password" />
            <button type="button" class="btn-admin" id="btnAdmin">ê´€ë¦¬</button>
            <button type="button" class="btn-login" id="btnLogin">ë¡œê·¸ì˜¨</button>
          </div>
        </div>
      </div>

      <!-- í”Œë«í¼ ì„ íƒ -->
      <div class="content-card">
        <div class="field-label">í”Œë«í¼ë³„ ê·œê²© ì„ íƒ</div>
        <p class="section-desc">ë³€í™˜í•  í”Œë«í¼ì„ ì„ íƒí•˜ì„¸ìš”. ê° í”Œë«í¼ì˜ UI ê°€ì´ë“œë¼ì¸ì´ ë¯¸ë¦¬ë³´ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
        <div class="platform-grid" id="platformGrid">
          <div class="platform-card" data-platform="youtube">
            <div class="platform-icon">ğŸ“½ï¸</div>
            <div class="platform-name">YouTube Shorts</div>
            <div class="platform-ratio">9:16</div>
          </div>
          <div class="platform-card" data-platform="tiktok">
            <div class="platform-icon">ğŸµ</div>
            <div class="platform-name">TikTok</div>
            <div class="platform-ratio">9:16</div>
          </div>
          <div class="platform-card" data-platform="instagram">
            <div class="platform-icon">ğŸ“¸</div>
            <div class="platform-name">Instagram Reels</div>
            <div class="platform-ratio">9:16</div>
          </div>
        </div>
      </div>

      <!-- ë¯¸ë¦¬ë³´ê¸° ë° ë³€í™˜ -->
      <div class="content-card">
        <div class="field-label">AI ìŠ¤ë§ˆíŠ¸ í¬ë¡­ ë° ë¯¸ë¦¬ë³´ê¸°</div>
        <p class="section-desc">í•µì‹¬ í”¼ì‚¬ì²´ë¥¼ ìë™ìœ¼ë¡œ ì¶”ì í•˜ì—¬ ì„¸ë¡œ í™”ë©´ ì¤‘ì•™ì— ë°°ì¹˜í•˜ê³ , ìë§‰ì„ ìµœì í™”í•©ë‹ˆë‹¤.</p>
        
        <div class="preview-container">
          <div class="preview-wrapper">
            <div class="phone-frame">
              <div class="phone-screen" id="shorts-preview">
                <video class="video-preview" id="videoPreview" controls style="display: none;"></video>
                <div class="video-timeline-overlay" id="videoTimelineOverlay" style="display: none;">
                  <div class="timeline-hotspot" id="timelineHotspot" style="display: none;">
                    <div class="timeline-hotspot-icon">âš¡</div>
                  </div>
                </div>
                <div id="previewPlaceholder" style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: #999; font-size: 14px;">
                  ë³€í™˜ëœ ì˜ìƒì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤
                </div>
                <!-- ê°€ìƒ ì´í™íŠ¸ ë ˆì´ì–´ -->
                <div class="effect-layer" id="effectLayer"></div>
                <!-- ë‹¤ì´ë‚´ë¯¹ ìë§‰ ì‹œë®¬ë ˆì´í„° -->
                <div class="subtitle-simulator" id="subtitleSimulator" style="display: none;">
                  <div class="subtitle-container" id="subtitleContainer"></div>
                </div>
                <!-- í”Œë«í¼ UI ì˜¤ë²„ë ˆì´ -->
                <div class="platform-ui-overlay" id="platformUIOverlay" style="display: none;">
                  <div class="platform-ui-top">
                    <div class="platform-ui-profile">
                      <div class="platform-ui-profile-avatar"></div>
                      <span>@creator</span>
                    </div>
                  </div>
                  <div class="platform-ui-bottom">
                    <div class="platform-ui-title" id="platformUITitle">ì˜ìƒ ì œëª©</div>
                    <div class="platform-ui-actions">
                      <div class="platform-ui-action-btn">â¤ï¸</div>
                      <div class="platform-ui-action-btn">ğŸ’¬</div>
                      <div class="platform-ui-action-btn">ğŸ”—</div>
                      <div class="platform-ui-action-btn">â©</div>
                    </div>
                  </div>
                </div>
                <div class="platform-overlay" id="platformOverlay" style="display: none;">
                  <div class="overlay-top"></div>
                  <div class="overlay-bottom"></div>
                  <div class="overlay-safe-area"></div>
                </div>
                <div class="loading-overlay" id="loadingOverlay" style="display: none;">
                  <div class="loading-spinner"></div>
                  <div class="loading-text">AI í•«ìŠ¤íŒŸ ì‹±í¬ ë° ì‡¼ì¸  ìƒì„± ì¤‘...</div>
                </div>
              </div>
            </div>
            <!-- Waveform & Hotspot Visualization -->
            <div class="waveform-section" id="waveformSection" style="display: none;">
              <div class="waveform-label">BGM íŒŒí˜• ë° í•«ìŠ¤íŒŸ</div>
              <div class="waveform-container" id="waveformContainer">
                <div class="hotspot-marker" id="hotspotMarker" style="display: none;">
                  <div class="hotspot-icon">âš¡</div>
                  <div class="hotspot-label">í•«ìŠ¤íŒŸ</div>
                  <div class="hotspot-tooltip">ë¹„íŠ¸ ë“œë¡­ íš¨ê³¼ ì ìš©ë¨</div>
                </div>
              </div>
            </div>

            <!-- ì‹œê°í™” íƒ€ì„ë¼ì¸ -->
            <div class="visual-timeline" id="visualTimeline" style="display: none;">
              <div class="timeline-label">ì˜ìƒ êµ¬ê°„ ë¶„ì„</div>
              <div class="timeline-track" id="timelineTrack">
                <div class="timeline-segment hook" id="hookSegment" style="display: none;"></div>
                <div class="timeline-segment insight" id="insightSegment" style="display: none;"></div>
                <div class="timeline-hotspot-marker" id="timelineHotspotMarker" style="display: none;">
                  <div class="timeline-hotspot-icon">âš¡</div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="preview-info">
            <div class="info-item">
              <div class="info-label">ì„ íƒëœ í”Œë«í¼</div>
              <div class="info-value" id="selectedPlatformText">-</div>
            </div>
            <div class="info-item">
              <div class="info-label">ì›ë³¸ ì˜ìƒ</div>
              <div class="info-value" id="originalVideoInfo">-</div>
            </div>
            <div class="info-item">
              <div class="info-label">ë³€í™˜ ìƒíƒœ</div>
              <div class="info-value" id="conversionStatus">ëŒ€ê¸° ì¤‘</div>
            </div>
            <div class="info-item">
              <div class="info-label">BGM í•«ìŠ¤íŒŸ</div>
              <div class="info-value" id="hotspotInfo">-</div>
            </div>
            <div class="info-item">
              <div class="info-label">BGM ë¶„ìœ„ê¸°</div>
              <div class="info-value" id="bgmMoodInfo">-</div>
            </div>
            <div class="info-item">
              <div class="info-label">AI ì²˜ë¦¬ ë‚´ìš©</div>
              <div class="info-value" id="aiProcessingInfo">- í•µì‹¬ í”¼ì‚¬ì²´ ìë™ ì¶”ì <br>- ìë§‰ í¬ê¸° ë° ìœ„ì¹˜ ìµœì í™”<br>- í”Œë«í¼ë³„ UI ì˜ì—­ íšŒí”¼<br>- BGM í•«ìŠ¤íŒŸ ìë™ ì‹±í¬</div>
            </div>
          </div>
        </div>

        <!-- íš¨ê³¼ ê°•ë„ ì¡°ì ˆ -->
        <div class="intensity-control">
          <div class="intensity-label">
            <span>ë¹„íŠ¸ ë“œë¡­ íš¨ê³¼ ê°•ë„</span>
            <span class="intensity-value" id="intensityValue">3ë‹¨ê³„</span>
          </div>
          <input type="range" class="intensity-slider" id="intensitySlider" min="1" max="5" value="3" step="1" />
          <div class="intensity-steps">
            <span>1 (ë¶€ë“œëŸ¬ì›€)</span>
            <span>2</span>
            <span>3 (ê¸°ë³¸)</span>
            <span>4</span>
            <span>5 (ê°•ë ¬í•¨)</span>
          </div>
        </div>

        <div class="action-buttons">
          <button class="btn-primary" id="btnConvert" type="button">AI í•«ìŠ¤íŒŸ ì‹±í¬ ë° ì‡¼ì¸  ìƒì„±</button>
          <button class="btn-secondary" id="btnDownload" type="button" disabled>ì‡¼ì¸  ë‹¤ìš´ë¡œë“œ</button>
        </div>
      </div>
    </main>
  </div>

  <script src="https://unpkg.com/wavesurfer.js@7"></script>
  <script>
    var selectedPlatform = null;
    var videoData = null;
    var bgmData = null;
    var convertedVideoUrl = null;
    var bgmHotspot = null;
    var wavesurfer = null;
    var syncParams = null;
    var effectIntensity = 3; // ê¸°ë³¸ê°’: 3ë‹¨ê³„
    var selectedMood = null;
    var bgmAudio = null;
    var isSimulating = false;
    var scriptText = '';
    var words = [];
    var wordTimings = [];
    var subtitleAnimationFrame = null;

    // ì´ˆê¸°í™”
    (function() {
      loadVideoData();
      loadBGMData();
      loadScriptText(); // ëŒ€ë³¸ í…ìŠ¤íŠ¸ ë¡œë“œ
      setupEventListeners();
      checkLoginStatus();
      updateEffectIntensity(); // ì´ˆê¸° íš¨ê³¼ ê°•ë„ ì„¤ì •
    })();

    // í”„ë¡œì íŠ¸ ë²„íŠ¼ ê¶Œí•œ ì²´í¬ ë° ì´ë²¤íŠ¸
    (function() {
      function checkAdminPermission() {
        var loginStatus = localStorage.getItem('isLoggedIn');
        var loginTime = localStorage.getItem('loginTime');
        if (loginStatus === 'true' && loginTime) {
          var loginDate = new Date(loginTime);
          var now = new Date();
          var hoursDiff = (now - loginDate) / (1000 * 60 * 60);
          if (hoursDiff < 24) {
            var currentUserId = localStorage.getItem('currentUserId');
            var users = JSON.parse(localStorage.getItem('approvedUsers') || '[]');
            var user = users.find(function(u) { return u.id === currentUserId; });
            return user && user.isAdmin === true;
          }
        }
        return false;
      }
      
      function updateProjectButtonsVisibility() {
        var hasPermission = checkAdminPermission();
        var btnCreate = document.getElementById('btnCreateProject');
        var btnList = document.getElementById('btnProjectList');
        if (btnCreate) {
          btnCreate.style.display = hasPermission ? 'block' : 'none';
          btnCreate.disabled = !hasPermission;
        }
        if (btnList) {
          btnList.style.display = hasPermission ? 'block' : 'none';
          btnList.disabled = !hasPermission;
        }
      }
      
      var btnCreate = document.getElementById('btnCreateProject');
      var btnList = document.getElementById('btnProjectList');
      
      if (btnCreate) {
        btnCreate.onclick = function() {
          if (!checkAdminPermission()) {
            alert('ê´€ë¦¬ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í›„ ê´€ë¦¬ ê¶Œí•œì„ ë°›ì•„ì£¼ì„¸ìš”.');
            return;
          }
          alert('í”„ë¡œì íŠ¸ ìƒì„± ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
        };
      }
      
      if (btnList) {
        btnList.onclick = function() {
          if (!checkAdminPermission()) {
            alert('ê´€ë¦¬ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í›„ ê´€ë¦¬ ê¶Œí•œì„ ë°›ì•„ì£¼ì„¸ìš”.');
            return;
          }
          window.location.href = '/';
        };
      }
      
      updateProjectButtonsVisibility();
      setInterval(updateProjectButtonsVisibility, 5000);
    })();

    // ì˜ìƒ ë°ì´í„° ë¡œë“œ
    function loadVideoData() {
      try {
        var videoDataRaw = localStorage.getItem('step7VideoData');
        if (videoDataRaw) {
          videoData = JSON.parse(videoDataRaw);
          updateOriginalVideoInfo();
        } else {
          document.getElementById('originalVideoInfo').textContent = 'ì˜ìƒ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. 6ë‹¨ê³„ì—ì„œ ì˜ìƒì„ ìƒì„±í•˜ì„¸ìš”.';
        }
      } catch (e) {
        console.error('ì˜ìƒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', e);
      }
    }

    // ëŒ€ë³¸ í…ìŠ¤íŠ¸ ë¡œë“œ
    function loadScriptText() {
      try {
        // step-4-1 JSONì—ì„œ ê°€ì ¸ì˜¤ê¸° (ê°€ì¥ ì •í™•í•œ ëŒ€ë³¸)
        var step42JsonDataRaw = localStorage.getItem('step42JsonData');
        if (step42JsonDataRaw) {
          var step42JsonData = JSON.parse(step42JsonDataRaw);
          if (step42JsonData.jsonData && step42JsonData.jsonData.scenes) {
            scriptText = step42JsonData.jsonData.scenes.map(function(scene) {
              return scene.script || '';
            }).join(' ');
          }
        }

        // step-4-1 JSONì—ì„œ ê°€ì ¸ì˜¤ê¸° ì‹œë„
        if (!scriptText) {
          var step4PayloadRaw = localStorage.getItem('step4JsonPayload');
          if (step4PayloadRaw) {
            var step4Payload = JSON.parse(step4PayloadRaw);
            if (step4Payload.script) {
              scriptText = step4Payload.script;
            } else if (step4Payload.jsonData && step4Payload.jsonData.scenes) {
              scriptText = step4Payload.jsonData.scenes.map(function(scene) {
                return scene.script || '';
              }).join(' ');
            }
          }
        }
        
        // step-3 blueprintì—ì„œ ê°€ì ¸ì˜¤ê¸° ì‹œë„
        if (!scriptText) {
          var step3BlueprintRaw = localStorage.getItem('step3Blueprint');
          if (step3BlueprintRaw) {
            var step3Blueprint = JSON.parse(step3BlueprintRaw);
            if (step3Blueprint.script) {
              scriptText = step3Blueprint.script;
            }
          }
        }

        // videoDataì—ì„œ ê°€ì ¸ì˜¤ê¸° ì‹œë„
        if (!scriptText && videoData && videoData.jsonData && videoData.jsonData.scenes) {
          scriptText = videoData.jsonData.scenes.map(function(scene) {
            return scene.script || '';
          }).join(' ');
        }

        if (scriptText && scriptText.trim().length > 0) {
          processScriptForSubtitles();
        }
      } catch (e) {
        console.error('ëŒ€ë³¸ ë¡œë“œ ì‹¤íŒ¨:', e);
      }
    }

    // ëŒ€ë³¸ì„ ë‹¨ì–´ ë°°ì—´ë¡œ ë¶„ë¦¬ ë° íƒ€ì´ë° ê³„ì‚°
    function processScriptForSubtitles() {
      if (!scriptText) return;

      // ê³µë°± ë‹¨ìœ„ë¡œ ë‹¨ì–´ ë¶„ë¦¬
      words = scriptText.split(/\s+/).filter(function(word) {
        return word.trim().length > 0;
      });

      if (words.length === 0) return;

      // TTS ì˜¤ë””ì˜¤ ê¸¸ì´ ê°€ì ¸ì˜¤ê¸°
      var ttsDuration = 60; // ê¸°ë³¸ê°’
      if (bgmData && bgmData.tts_data && bgmData.tts_data.scenes) {
        ttsDuration = bgmData.tts_data.scenes.reduce(function(total, scene) {
          return total + (scene.duration || 30);
        }, 0);
      }

      // ê¸°ë³¸ ë‹¨ì–´ íƒ€ì´ë° ê³„ì‚°
      var baseWordDuration = ttsDuration / words.length;
      var currentTime = 0;

      wordTimings = words.map(function(word, index) {
        var wordStart = currentTime;
        var wordEnd = currentTime + baseWordDuration;

        // í•«ìŠ¤íŒŸ êµ¬ê°„ì—ì„œëŠ” ë‹¨ì–´ê°€ ë” ë¹ ë¥´ê²Œ (ê°€ì¤‘ì¹˜ ì ìš©)
        if (bgmHotspot) {
          var hotspotStart = bgmHotspot.time - 0.5;
          var hotspotEnd = bgmHotspot.time + 0.5;
          
          if (wordStart >= hotspotStart && wordStart <= hotspotEnd) {
            // í•«ìŠ¤íŒŸ êµ¬ê°„: ë‹¨ì–´ ê°„ê²©ì„ 50%ë¡œ ì¤„ì„ (ë” ë¹ ë¥´ê²Œ)
            wordEnd = wordStart + (baseWordDuration * 0.5);
          }
        }

        currentTime = wordEnd;
        return {
          word: word,
          start: wordStart,
          end: wordEnd
        };
      });
    }

    // BGM ë°ì´í„° ë¡œë“œ
    function loadBGMData() {
      try {
        var bgmDataRaw = localStorage.getItem('step52BGMData');
        if (bgmDataRaw) {
          bgmData = JSON.parse(bgmDataRaw);
          
          // ì„ íƒëœ ë¶„ìœ„ê¸° ê°€ì ¸ì˜¤ê¸° (step-5-2.htmlì—ì„œ ì €ì¥ëœ ê°’)
          if (bgmData.mood) {
            selectedMood = bgmData.mood;
          } else if (bgmData.track && bgmData.track.mood) {
            selectedMood = bgmData.track.mood;
          } else {
            // localStorageì—ì„œ ì§ì ‘ ê°€ì ¸ì˜¤ê¸° ì‹œë„
            var moodData = localStorage.getItem('selectedMood');
            if (moodData) {
              selectedMood = moodData;
            } else {
              // ê¸°ë³¸ê°’: ì •ë³´ì „ë‹¬
              selectedMood = 'informative';
            }
          }
          
          updateBgmMoodInfo();
          analyzeBGMHotspot();
          loadBGMAudio(); // BGM ì˜¤ë””ì˜¤ ë¡œë“œ
        }
      } catch (e) {
        console.error('BGM ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', e);
      }
    }

    // BGM ë¶„ìœ„ê¸° ì •ë³´ ì—…ë°ì´íŠ¸
    function updateBgmMoodInfo() {
      if (!selectedMood) {
        document.getElementById('bgmMoodInfo').textContent = '-';
        return;
      }

      var moodLabels = {
        calm: 'ì°¨ë¶„í•œ',
        epic: 'ì›…ì¥í•œ',
        intense: 'ê¸´ë°•í•œ',
        emotional: 'ê°ì„±ì ì¸',
        informative: 'ì •ë³´ì „ë‹¬',
        cheerful: 'ìœ ì¾Œí•œ',
        mysterious: 'ì‹ ë¹„ë¡œìš´',
        lively: 'ê²½ì¾Œí•œ',
        warm: 'ë”°ëœ»í•œ',
        sophisticated: 'ì„¸ë ¨ëœ',
        solemn: 'ë¹„ì¥í•œ'
      };

      var moodLabel = moodLabels[selectedMood] || selectedMood;
      document.getElementById('bgmMoodInfo').textContent = '#' + moodLabel;
    }

    // BGM í•«ìŠ¤íŒŸ ë¶„ì„ (ì—ë„ˆì§€ê°€ ê°€ì¥ ë†’ì€ êµ¬ê°„ ì¶”ì¶œ)
    async function analyzeBGMHotspot() {
      if (!bgmData || !bgmData.track || !bgmData.track.url) {
        return;
      }

      try {
        // WaveSurfer.jsë¡œ íŒŒí˜• ë¶„ì„
        if (wavesurfer) {
          wavesurfer.destroy();
        }

        wavesurfer = WaveSurfer.create({
          container: '#waveformContainer',
          waveColor: '#cbd5e0',
          progressColor: '#805ad5',
          cursorColor: '#805ad5',
          barWidth: 2,
          barRadius: 1,
          height: 80,
          normalize: true,
          interact: false
        });

        await wavesurfer.load(bgmData.track.url);
        
        // íŒŒí˜• ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        var peaks = wavesurfer.getDecodedData();
        if (!peaks) {
          // ëŒ€ì•ˆ: ê°„ë‹¨í•œ ì—ë„ˆì§€ ë¶„ì„
          var duration = wavesurfer.getDuration();
          bgmHotspot = {
            time: duration * 0.1, // ì´ˆë°˜ 10% ì§€ì  (ì¼ë°˜ì ìœ¼ë¡œ í´ë¼ì´ë§¥ìŠ¤)
            energy: 1.0
          };
        } else {
          // ì—ë„ˆì§€ ë¶„ì„: RMS (Root Mean Square) ê³„ì‚°
          var channelData = peaks.getChannelData(0);
          var sampleRate = peaks.sampleRate;
          var windowSize = Math.floor(sampleRate * 0.1); // 0.1ì´ˆ ìœˆë„ìš°
          var maxEnergy = 0;
          var maxEnergyTime = 0;

          for (var i = 0; i < channelData.length - windowSize; i += windowSize) {
            var sum = 0;
            for (var j = 0; j < windowSize; j++) {
              sum += Math.abs(channelData[i + j]);
            }
            var energy = sum / windowSize;
            
            if (energy > maxEnergy) {
              maxEnergy = energy;
              maxEnergyTime = i / sampleRate;
            }
          }

          bgmHotspot = {
            time: maxEnergyTime,
            energy: maxEnergy
          };
        }

        // í•«ìŠ¤íŒŸ ì •ë³´ í‘œì‹œ
        updateHotspotInfo();
        renderHotspotMarker();
        
        // Waveform ì„¹ì…˜ í‘œì‹œ
        document.getElementById('waveformSection').style.display = 'block';

      } catch (e) {
        console.error('BGM í•«ìŠ¤íŒŸ ë¶„ì„ ì‹¤íŒ¨:', e);
        // ê¸°ë³¸ê°’ ì„¤ì •
        bgmHotspot = {
          time: 3.0, // ê¸°ë³¸ 3ì´ˆ
          energy: 1.0
        };
        updateHotspotInfo();
      }
    }

    // í•«ìŠ¤íŒŸ ì •ë³´ ì—…ë°ì´íŠ¸
    function updateHotspotInfo() {
      if (!bgmHotspot) {
        document.getElementById('hotspotInfo').textContent = '-';
        return;
      }

      var timeStr = bgmHotspot.time.toFixed(2) + 'ì´ˆ';
      document.getElementById('hotspotInfo').textContent = timeStr + ' (ì—ë„ˆì§€ í”¼í¬) âš¡ ë¹„íŠ¸ ë“œë¡­ íš¨ê³¼';
    }

    // í•«ìŠ¤íŒŸ ë§ˆì»¤ ë Œë”ë§
    function renderHotspotMarker() {
      if (!bgmHotspot || !wavesurfer) return;

      var marker = document.getElementById('hotspotMarker');
      if (!marker) return;

      var duration = wavesurfer.getDuration();
      if (!duration) return;

      var position = (bgmHotspot.time / duration) * 100;
      marker.style.left = position + '%';
      marker.style.display = 'block';
    }

    // ì›ë³¸ ì˜ìƒ ì •ë³´ ì—…ë°ì´íŠ¸
    function updateOriginalVideoInfo() {
      if (!videoData || !videoData.generatedVideos || videoData.generatedVideos.length === 0) {
        document.getElementById('originalVideoInfo').textContent = 'ì˜ìƒ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.';
        return;
      }

      var firstVideo = videoData.generatedVideos[0];
      var info = '16:9 ê°€ë¡œ ì˜ìƒ (' + videoData.generatedVideos.length + 'ê°œ ì”¬)';
      document.getElementById('originalVideoInfo').textContent = info;
    }

    // í”Œë«í¼ ì„ íƒ ì´ë²¤íŠ¸
    function setupEventListeners() {
      var platformCards = document.querySelectorAll('.platform-card');
      platformCards.forEach(function(card) {
        card.addEventListener('click', function() {
          // ì„ íƒ ìƒíƒœ í† ê¸€
          platformCards.forEach(function(c) {
            c.classList.remove('selected');
          });
          this.classList.add('selected');
          
          selectedPlatform = this.getAttribute('data-platform');
          updateSelectedPlatform();
          showPlatformOverlay();
        });
      });

      // ë³€í™˜ ë²„íŠ¼
      var btnConvert = document.getElementById('btnConvert');
      if (btnConvert) {
        btnConvert.addEventListener('click', function() {
          if (!selectedPlatform) {
            alert('í”Œë«í¼ì„ ì„ íƒí•˜ì„¸ìš”.');
            return;
          }
          if (!videoData) {
            alert('ì˜ìƒ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
            return;
          }
          convertToShorts();
        });
      }

      // ë‹¤ìš´ë¡œë“œ ë²„íŠ¼
      var btnDownload = document.getElementById('btnDownload');
      if (btnDownload) {
        btnDownload.addEventListener('click', function() {
          if (!convertedVideoUrl) {
            alert('ë³€í™˜ëœ ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤.');
            return;
          }
          downloadShorts();
        });
      }

      // íš¨ê³¼ ê°•ë„ ìŠ¬ë¼ì´ë”
      var intensitySlider = document.getElementById('intensitySlider');
      var intensityValue = document.getElementById('intensityValue');
      if (intensitySlider && intensityValue) {
        intensitySlider.addEventListener('input', function() {
          effectIntensity = parseInt(this.value, 10);
          var intensityLabels = {
            1: '1ë‹¨ê³„ (ë¶€ë“œëŸ¬ì›€)',
            2: '2ë‹¨ê³„',
            3: '3ë‹¨ê³„ (ê¸°ë³¸)',
            4: '4ë‹¨ê³„',
            5: '5ë‹¨ê³„ (ê°•ë ¬í•¨)'
          };
          intensityValue.textContent = intensityLabels[effectIntensity] || effectIntensity + 'ë‹¨ê³„';
          
          // CSS ë³€ìˆ˜ ì—…ë°ì´íŠ¸ (íš¨ê³¼ ê°•ë„ ë°˜ì˜)
          updateEffectIntensity();
        });
      }
    }

    // íš¨ê³¼ ê°•ë„ì— ë”°ë¥¸ CSS ë³€ìˆ˜ ì—…ë°ì´íŠ¸
    function updateEffectIntensity() {
      var root = document.documentElement;
      var intensityMap = {
        1: { shake: '2px', saturate: '1.2', brightness: '1.1', opacity: '0.3', subtitleScale: '0', animationSpeed: '1.2' },
        2: { shake: '3px', saturate: '1.4', brightness: '1.15', opacity: '0.4', subtitleScale: '0.2', animationSpeed: '1.1' },
        3: { shake: '4px', saturate: '1.6', brightness: '1.2', opacity: '0.5', subtitleScale: '0.4', animationSpeed: '1.0' },
        4: { shake: '6px', saturate: '1.8', brightness: '1.25', opacity: '0.6', subtitleScale: '0.6', animationSpeed: '0.9' },
        5: { shake: '8px', saturate: '2.0', brightness: '1.3', opacity: '0.7', subtitleScale: '0.8', animationSpeed: '0.8' }
      };

      var values = intensityMap[effectIntensity] || intensityMap[3];
      root.style.setProperty('--effect-shake', values.shake);
      root.style.setProperty('--effect-saturate', values.saturate);
      root.style.setProperty('--effect-brightness', values.brightness);
      root.style.setProperty('--effect-opacity', values.opacity);
      root.style.setProperty('--subtitle-scale', values.subtitleScale);
      root.style.setProperty('--animation-speed', values.animationSpeed);
    }

    // ì„ íƒëœ í”Œë«í¼ ì—…ë°ì´íŠ¸
    function updateSelectedPlatform() {
      var platformNames = {
        youtube: 'YouTube Shorts',
        tiktok: 'TikTok',
        instagram: 'Instagram Reels'
      };
      document.getElementById('selectedPlatformText').textContent = platformNames[selectedPlatform] || '-';
    }

    // í”Œë«í¼ ì˜¤ë²„ë ˆì´ í‘œì‹œ
    function showPlatformOverlay() {
      var overlay = document.getElementById('platformOverlay');
      var uiOverlay = document.getElementById('platformUIOverlay');
      if (overlay) {
        overlay.style.display = 'block';
      }
      if (uiOverlay) {
        uiOverlay.style.display = 'block';
        updatePlatformUI();
      }
    }

    // í”Œë«í¼ë³„ UI ì—…ë°ì´íŠ¸
    function updatePlatformUI() {
      var platformUITitle = document.getElementById('platformUITitle');
      if (!platformUITitle) return;

      var titleText = 'ì˜ìƒ ì œëª©';
      if (videoData && videoData.jsonData && videoData.jsonData.title) {
        titleText = videoData.jsonData.title;
      }

      platformUITitle.textContent = titleText;
    }

    // ë¹„íŠ¸ ë“œë¡­ íš¨ê³¼ ì‹œë®¬ë ˆì´ì…˜ íŠ¸ë¦¬ê±°
    function triggerBeatDropEffect() {
      if (!bgmHotspot || !selectedMood) return;

      var preview = document.getElementById('shorts-preview');
      var effectLayer = document.getElementById('effectLayer');
      if (!preview || !effectLayer) return;

      // ë¶„ìœ„ê¸°ë³„ íš¨ê³¼ í´ë˜ìŠ¤ ì¶”ê°€
      var effectClasses = getEffectClassesByMood(selectedMood, effectIntensity);
      
      // íš¨ê³¼ í´ë˜ìŠ¤ ì¶”ê°€
      effectClasses.forEach(function(className) {
        preview.classList.add(className);
      });
      effectLayer.className = 'effect-layer ' + effectClasses.join(' ');

      // 0.5ì´ˆ í›„ íš¨ê³¼ ì œê±°
      setTimeout(function() {
        effectClasses.forEach(function(className) {
          preview.classList.remove(className);
        });
        effectLayer.className = 'effect-layer';
      }, 500);
    }

    // ë¶„ìœ„ê¸°ë³„ íš¨ê³¼ í´ë˜ìŠ¤ ë°˜í™˜
    function getEffectClassesByMood(mood, intensity) {
      var effects = {
        solemn: ['effect-shake', 'effect-saturate'],
        epic: ['effect-shake', 'effect-saturate'],
        emotional: ['effect-lightleak', 'effect-brightness'],
        warm: ['effect-lightleak', 'effect-brightness'],
        cheerful: ['effect-bounce', 'effect-saturate'],
        lively: ['effect-bounce', 'effect-saturate'],
        mysterious: ['effect-lightleak'],
        sophisticated: ['effect-lightleak'],
        intense: ['effect-shake', 'effect-saturate'],
        calm: [],
        informative: []
      };

      var baseEffects = effects[mood] || effects.informative;
      
      // ê°•ë„ì— ë”°ë¥¸ ì¡°ì •
      if (intensity <= 2 && (mood === 'calm' || mood === 'informative' || mood === 'warm' || mood === 'emotional')) {
        return []; // ì‹œë‹ˆì–´ íƒ€ê²Ÿì€ íš¨ê³¼ ìµœì†Œí™”
      }

      return baseEffects;
    }

    // BGM ì˜¤ë””ì˜¤ ë¡œë“œ
    function loadBGMAudio() {
      if (!bgmData || !bgmData.track || !bgmData.track.url) return;

      try {
        bgmAudio = new Audio(bgmData.track.url);
        bgmAudio.volume = bgmData.bgm_volume ? (bgmData.bgm_volume / 100) : 0.2;
        bgmAudio.loop = bgmData.auto_loop || false;
      } catch (e) {
        console.error('BGM ì˜¤ë””ì˜¤ ë¡œë“œ ì‹¤íŒ¨:', e);
      }
    }

    // ì‹¤ì‹œê°„ ì‹œë®¬ë ˆì´ì…˜ ë¡œì§ (ë¹„ë””ì˜¤ ì¬ìƒ ì¤‘ í•«ìŠ¤íŒŸ ê°ì§€)
    function setupRealtimeSimulation() {
      var videoPreview = document.getElementById('videoPreview');
      if (!videoPreview || !bgmHotspot) return;

      var hotspotTime = bgmHotspot.time;
      var hasTriggered = false;

      // ë¹„ë””ì˜¤ ì¬ìƒ ì‹œ BGMë„ ë™ì‹œ ì¬ìƒ
      videoPreview.addEventListener('play', function() {
        if (bgmAudio && !isSimulating) {
          isSimulating = true;
          // BGM ì‹œì‘ì  ì¡°ì • (í•«ìŠ¤íŒŸ ì‹±í¬)
          if (syncParams && syncParams.bgm_offset) {
            bgmAudio.currentTime = syncParams.bgm_offset;
          }
          bgmAudio.play().catch(function(e) {
            console.warn('BGM ì¬ìƒ ì‹¤íŒ¨:', e);
          });
        }
      });

      // ë¹„ë””ì˜¤ ì¼ì‹œì •ì§€ ì‹œ BGMë„ ì¼ì‹œì •ì§€
      videoPreview.addEventListener('pause', function() {
        if (bgmAudio) {
          bgmAudio.pause();
        }
      });

      // ë¹„ë””ì˜¤ ì¢…ë£Œ ì‹œ BGMë„ ì •ì§€
      videoPreview.addEventListener('ended', function() {
        if (bgmAudio) {
          bgmAudio.pause();
          bgmAudio.currentTime = 0;
        }
        isSimulating = false;
        hasTriggered = false;
      });

      // ë¹„ë””ì˜¤ ì‹œê°„ ì—…ë°ì´íŠ¸ ì‹œ í•«ìŠ¤íŒŸ ê°ì§€ ë° ìë§‰ ì—…ë°ì´íŠ¸
      videoPreview.addEventListener('timeupdate', function() {
        var currentTime = this.currentTime;
        
        // BGM ë™ê¸°í™” (ë¹„ë””ì˜¤ ì‹œê°„ì— ë§ì¶° BGM ì¬ìƒ ìœ„ì¹˜ ì¡°ì •)
        if (bgmAudio && syncParams && syncParams.bgm_offset !== undefined) {
          var bgmTargetTime = syncParams.bgm_offset + currentTime;
          if (Math.abs(bgmAudio.currentTime - bgmTargetTime) > 0.1) {
            bgmAudio.currentTime = bgmTargetTime;
          }
        }
        
        // í•«ìŠ¤íŒŸ íƒ€ì„ì½”ë“œì— ë„ë‹¬í•˜ë©´ íš¨ê³¼ íŠ¸ë¦¬ê±° (í•œ ë²ˆë§Œ)
        if (!hasTriggered && Math.abs(currentTime - hotspotTime) < 0.1) {
          hasTriggered = true;
          triggerBeatDropEffect();
        }

        // ë¹„ë””ì˜¤ê°€ í•«ìŠ¤íŒŸì„ ì§€ë‚˜ë©´ í”Œë˜ê·¸ ë¦¬ì…‹ (ì¬ìƒ ì‹œ ë‹¤ì‹œ íŠ¸ë¦¬ê±° ê°€ëŠ¥)
        if (currentTime < hotspotTime - 0.2) {
          hasTriggered = false;
        }

        // ë‹¤ì´ë‚´ë¯¹ ìë§‰ ì—…ë°ì´íŠ¸
        updateDynamicSubtitles(currentTime);
      });
    }

    // ë‹¤ì´ë‚´ë¯¹ ìë§‰ ë Œë”ë§ ë° ì—…ë°ì´íŠ¸ (requestAnimationFrame ë ˆë²¨ ë™ê¸°í™”)
    var subtitleAnimationFrame = null;
    function updateDynamicSubtitles(currentTime) {
      // ì´ì „ ì• ë‹ˆë©”ì´ì…˜ í”„ë ˆì„ ì·¨ì†Œ
      if (subtitleAnimationFrame) {
        cancelAnimationFrame(subtitleAnimationFrame);
      }
      
      // requestAnimationFrameìœ¼ë¡œ ì •í™•í•œ íƒ€ì´ë° ë™ê¸°í™”
      subtitleAnimationFrame = requestAnimationFrame(function() {
        updateDynamicSubtitlesInternal(currentTime);
      });
    }
    
    function updateDynamicSubtitlesInternal(currentTime) {
      if (!wordTimings || wordTimings.length === 0) return;

      var subtitleContainer = document.getElementById('subtitleContainer');
      var subtitleSimulator = document.getElementById('subtitleSimulator');
      if (!subtitleContainer || !subtitleSimulator) return;

      // í˜„ì¬ ì‹œì ì˜ ë‹¨ì–´ ì¸ë±ìŠ¤ ì°¾ê¸°
      var currentWordIndex = -1;
      for (var i = 0; i < wordTimings.length; i++) {
        if (currentTime >= wordTimings[i].start && currentTime < wordTimings[i].end) {
          currentWordIndex = i;
          break;
        }
      }

      // ìë§‰ì´ ì—†ìœ¼ë©´ í‘œì‹œí•˜ì§€ ì•ŠìŒ
      if (currentWordIndex === -1 && currentTime > wordTimings[wordTimings.length - 1].end) {
        subtitleSimulator.style.display = 'none';
        return;
      }

      subtitleSimulator.style.display = 'block';

      // ìë§‰ ë Œë”ë§ (í˜„ì¬ ë‹¨ì–´ ì¤‘ì‹¬ìœ¼ë¡œ ì•ë’¤ ë‹¨ì–´ í‘œì‹œ)
      var visibleRange = 3; // í˜„ì¬ ë‹¨ì–´ ì•ë’¤ë¡œ í‘œì‹œí•  ë‹¨ì–´ ìˆ˜
      var startIndex = Math.max(0, currentWordIndex - visibleRange);
      var endIndex = Math.min(wordTimings.length - 1, currentWordIndex + visibleRange);

      var html = '';
      for (var i = startIndex; i <= endIndex; i++) {
        var timing = wordTimings[i];
        var wordClass = 'dynamic-word';
        
        if (i < currentWordIndex) {
          wordClass += ' past';
        } else if (i === currentWordIndex) {
          wordClass += ' current pop';
        } else {
          wordClass += ' future';
        }

        html += '<span class="' + wordClass + '" data-word-index="' + i + '">' + 
                escapeHtml(timing.word) + '</span>';
      }

      subtitleContainer.innerHTML = html;
    }

    // HTML ì´ìŠ¤ì¼€ì´í”„
    function escapeHtml(text) {
      var div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // ì‹œê°í™” íƒ€ì„ë¼ì¸ ë Œë”ë§
    function renderVisualTimeline() {
      if (!bgmHotspot || !videoData) return;

      var timelineTrack = document.getElementById('timelineTrack');
      var hookSegment = document.getElementById('hookSegment');
      var insightSegment = document.getElementById('insightSegment');
      var hotspotMarker = document.getElementById('timelineHotspotMarker');
      var visualTimeline = document.getElementById('visualTimeline');

      if (!timelineTrack || !visualTimeline) return;

      var videoPreview = document.getElementById('videoPreview');
      var duration = videoPreview ? videoPreview.duration : 60; // ê¸°ë³¸ 60ì´ˆ
      if (!duration || duration === 0) duration = 60;

      var trackWidth = timelineTrack.clientWidth;

      // ì´ˆë°˜ 3ì´ˆ í›… êµ¬ê°„ (0~3ì´ˆ)
      var hookStart = 0;
      var hookEnd = 3;
      var hookWidth = ((hookEnd - hookStart) / duration) * 100;
      hookSegment.style.left = (hookStart / duration * 100) + '%';
      hookSegment.style.width = hookWidth + '%';
      hookSegment.style.display = 'block';

      // í•µì‹¬ ì¸ì‚¬ì´íŠ¸ êµ¬ê°„ (ì¤‘ê°„ ë¶€ë¶„, ì˜ˆ: 30%~60%)
      var insightStart = duration * 0.3;
      var insightEnd = duration * 0.6;
      var insightWidth = ((insightEnd - insightStart) / duration) * 100;
      insightSegment.style.left = (insightStart / duration * 100) + '%';
      insightSegment.style.width = insightWidth + '%';
      insightSegment.style.display = 'block';

      // í•«ìŠ¤íŒŸ ë§ˆì»¤
      var hotspotPosition = (bgmHotspot.time / duration) * 100;
      hotspotMarker.style.left = hotspotPosition + '%';
      hotspotMarker.style.display = 'block';

      visualTimeline.style.display = 'block';
    }

    // AI ì‡¼ì¸  ë³€í™˜ (BGM í•«ìŠ¤íŒŸ ì‹±í¬ í¬í•¨)
    async function convertToShorts() {
      var btnConvert = document.getElementById('btnConvert');
      var btnDownload = document.getElementById('btnDownload');
      var loadingOverlay = document.getElementById('loadingOverlay');
      var previewPlaceholder = document.getElementById('previewPlaceholder');
      var videoPreview = document.getElementById('videoPreview');

      // UI ì—…ë°ì´íŠ¸
      btnConvert.disabled = true;
      btnDownload.disabled = true;
      loadingOverlay.style.display = 'flex';
      previewPlaceholder.style.display = 'none';
      document.getElementById('conversionStatus').textContent = 'í•«ìŠ¤íŒŸ ì‹±í¬ ë° ë³€í™˜ ì¤‘...';

      try {
        // í›… & í•«ìŠ¤íŒŸ ìë™ ì •ë ¬ ê³„ì‚°
        syncParams = calculateHotspotSync();
        
        // íƒ€ê²Ÿ ì¥ë©´ ì‹ë³„ ë° VEO í”„ë¡¬í”„íŠ¸ ì¸ì ì…˜
        var enhancedVideoData = injectBeatDropEffects(videoData);
        
        // API í˜¸ì¶œ
        var response = await fetch((window.__API_BASE__ || 'http://localhost:4000') + '/api/convert-to-shorts', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            video_data: enhancedVideoData,
            bgm_data: bgmData,
            platform: selectedPlatform,
            aspect_ratio: '9:16',
            smart_crop: true,
            subtitle_optimization: true,
            platform_guidelines: true,
            bgm_hotspot: bgmHotspot,
            hotspot_sync: syncParams,
            dynamic_volume: {
              enabled: true,
              initial_volume: 1.0, // ì‹œì‘ ì‹œ BGM ìµœëŒ€ ë³¼ë¥¨
              narration_volume: bgmData ? (bgmData.bgm_volume / 100) : 0.2, // TTS ë‚˜ì˜¬ ë•Œ ë³¼ë¥¨
              ducking_start: 3.0 // 3ì´ˆ í›„ ë³¼ë¥¨ ë‚®ì¶¤
            },
            beat_drop_effects: {
              enabled: true,
              hotspot_time: bgmHotspot ? bgmHotspot.time : null,
              mood: selectedMood,
              intensity: effectIntensity
            }
          })
        });

        if (!response.ok) {
          throw new Error('ë³€í™˜ ì‹¤íŒ¨: ' + response.statusText);
        }

        var result = await response.json();
        convertedVideoUrl = result.video_url;

        // ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
        videoPreview.src = convertedVideoUrl;
        videoPreview.style.display = 'block';
        previewPlaceholder.style.display = 'none';
        loadingOverlay.style.display = 'none';
        
        // ë¹„ë””ì˜¤ ë¡œë“œ í›„ íƒ€ì„ë¼ì¸ í•«ìŠ¤íŒŸ í‘œì‹œ ë° ì‹œë®¬ë ˆì´ì…˜ ì„¤ì •
        videoPreview.addEventListener('loadedmetadata', function() {
          renderTimelineHotspot();
          renderVisualTimeline();
          setupRealtimeSimulation();
          
          // ëŒ€ë³¸ì´ ìˆìœ¼ë©´ ìë§‰ ì‹œë®¬ë ˆì´í„° í™œì„±í™”
          if (wordTimings && wordTimings.length > 0) {
            var subtitleSimulator = document.getElementById('subtitleSimulator');
            if (subtitleSimulator) {
              subtitleSimulator.style.display = 'block';
            }
          }
        });

        // ìƒíƒœ ì—…ë°ì´íŠ¸
        var statusText = 'ë³€í™˜ ì™„ë£Œ';
        if (bgmHotspot) {
          statusText += ' (í•«ìŠ¤íŒŸ ì‹±í¬ ì ìš©ë¨)';
        }
        document.getElementById('conversionStatus').textContent = statusText;
        btnConvert.disabled = false;
        btnDownload.disabled = false;

        // ë³€í™˜ëœ ì˜ìƒ ë°ì´í„° ì €ì¥ (ë¹„íŠ¸ ë“œë¡­ íš¨ê³¼ ì •ë³´ í¬í•¨)
        var shortsData = {
          platform: selectedPlatform,
          video_url: convertedVideoUrl,
          original_video_data: videoData,
          beat_drop_effects: {
            enabled: true,
            hotspot_time: bgmHotspot ? bgmHotspot.time : null,
            mood: selectedMood,
            intensity: effectIntensity,
            effect_type: selectedMood ? getEffectByMood(selectedMood) : null
          },
          dynamic_captions: {
            enabled: true,
            word_timings: wordTimings || [],
            script_text: scriptText || ''
          }
        };
        if (bgmHotspot) {
          shortsData.bgm_hotspot = bgmHotspot;
        }
        if (syncParams) {
          shortsData.hotspot_sync = syncParams;
        }
        if (bgmData) {
          shortsData.bgm_data = {
            bpm: bgmData.bpm || null,
            mood: selectedMood,
            volume: bgmData.bgm_volume || 20
          };
        }
        localStorage.setItem('step11ShortsData', JSON.stringify(shortsData));

      } catch (e) {
        console.error('ë³€í™˜ ì‹¤íŒ¨:', e);
        alert('ë³€í™˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + e.message);
        
        // UI ë³µì›
        loadingOverlay.style.display = 'none';
        previewPlaceholder.style.display = 'flex';
        btnConvert.disabled = false;
        document.getElementById('conversionStatus').textContent = 'ë³€í™˜ ì‹¤íŒ¨';
      }
    }

    // í›… & í•«ìŠ¤íŒŸ ìë™ ì •ë ¬ ê³„ì‚°
    function calculateHotspotSync() {
      if (!bgmHotspot) {
        return {
          bgm_offset: 0,
          sync_point: 0
        };
      }

      // ì´ˆë°˜ 3ì´ˆì— í•«ìŠ¤íŒŸì´ ì¼ì¹˜í•˜ë„ë¡ BGM ì‹œì‘ì  ì¡°ì •
      var targetSyncTime = 0; // ì‡¼ì¸  ì‹œì‘ì  (0ì´ˆ)
      var hotspotTime = bgmHotspot.time;
      
      // BGM ì˜¤í”„ì…‹ ê³„ì‚°: í•«ìŠ¤íŒŸì´ 0ì´ˆì— ì˜¤ë„ë¡ BGMì„ ì•ìœ¼ë¡œ ë‹¹ê¹€
      var bgmOffset = hotspotTime;
      
      return {
        bgm_offset: bgmOffset,
        sync_point: targetSyncTime,
        hotspot_time: hotspotTime
      };
    }

    // ë¶„ìœ„ê¸°ë³„ íš¨ê³¼ ë§¤í•‘ í…Œì´ë¸”
    function getEffectByMood(mood) {
      var effectTable = {
        // #ë¹„ì¥í•œ / #ì›…ì¥í•œ
        solemn: {
          base: 'with strong camera impact shake, high contrast, and cinematic HDR lighting',
          intensity: {
            1: 'with subtle camera impact shake, enhanced contrast, and cinematic lighting',
            2: 'with slight camera impact shake, moderate contrast, and cinematic HDR lighting',
            3: 'with strong camera impact shake, high contrast, and cinematic HDR lighting',
            4: 'with intense camera impact shake, very high contrast, and dramatic cinematic HDR lighting',
            5: 'with extreme camera impact shake, maximum contrast, and ultra-dramatic cinematic HDR lighting'
          }
        },
        epic: {
          base: 'with strong camera impact shake, high contrast, and cinematic HDR lighting',
          intensity: {
            1: 'with subtle camera impact shake, enhanced contrast, and cinematic lighting',
            2: 'with slight camera impact shake, moderate contrast, and cinematic HDR lighting',
            3: 'with strong camera impact shake, high contrast, and cinematic HDR lighting',
            4: 'with intense camera impact shake, very high contrast, and dramatic cinematic HDR lighting',
            5: 'with extreme camera impact shake, maximum contrast, and ultra-dramatic cinematic HDR lighting'
          }
        },
        // #ê°ì„±ì ì¸ / #ë”°ëœ»í•œ
        emotional: {
          base: 'with soft warm light leak effects, gentle slow-motion zoom, and ethereal glow',
          intensity: {
            1: 'with very soft warm light leak effects, gentle slow-motion zoom, and subtle ethereal glow',
            2: 'with soft warm light leak effects, gentle slow-motion zoom, and mild ethereal glow',
            3: 'with soft warm light leak effects, gentle slow-motion zoom, and ethereal glow',
            4: 'with vibrant warm light leak effects, noticeable slow-motion zoom, and strong ethereal glow',
            5: 'with intense warm light leak effects, dramatic slow-motion zoom, and powerful ethereal glow'
          }
        },
        warm: {
          base: 'with soft warm light leak effects, gentle slow-motion zoom, and ethereal glow',
          intensity: {
            1: 'with very soft warm light leak effects, gentle slow-motion zoom, and subtle ethereal glow',
            2: 'with soft warm light leak effects, gentle slow-motion zoom, and mild ethereal glow',
            3: 'with soft warm light leak effects, gentle slow-motion zoom, and ethereal glow',
            4: 'with vibrant warm light leak effects, noticeable slow-motion zoom, and strong ethereal glow',
            5: 'with intense warm light leak effects, dramatic slow-motion zoom, and powerful ethereal glow'
          }
        },
        // #ìœ ì¾Œí•œ / #ê²½ì¾Œí•œ
        cheerful: {
          base: 'with bouncy camera movement, vibrant color popping, and playful brightness pulse',
          intensity: {
            1: 'with gentle bouncy camera movement, subtle color popping, and soft brightness pulse',
            2: 'with slight bouncy camera movement, mild color popping, and noticeable brightness pulse',
            3: 'with bouncy camera movement, vibrant color popping, and playful brightness pulse',
            4: 'with strong bouncy camera movement, intense color popping, and vibrant brightness pulse',
            5: 'with extreme bouncy camera movement, maximum color popping, and dramatic brightness pulse'
          }
        },
        lively: {
          base: 'with bouncy camera movement, vibrant color popping, and playful brightness pulse',
          intensity: {
            1: 'with gentle bouncy camera movement, subtle color popping, and soft brightness pulse',
            2: 'with slight bouncy camera movement, mild color popping, and noticeable brightness pulse',
            3: 'with bouncy camera movement, vibrant color popping, and playful brightness pulse',
            4: 'with strong bouncy camera movement, intense color popping, and vibrant brightness pulse',
            5: 'with extreme bouncy camera movement, maximum color popping, and dramatic brightness pulse'
          }
        },
        // #ì‹ ë¹„ë¡œìš´ / #ì„¸ë ¨ëœ
        mysterious: {
          base: 'with subtle digital glitch, chromatic aberration, and dreamy neon color shift',
          intensity: {
            1: 'with very subtle digital glitch, minimal chromatic aberration, and soft dreamy neon color shift',
            2: 'with subtle digital glitch, mild chromatic aberration, and gentle dreamy neon color shift',
            3: 'with subtle digital glitch, chromatic aberration, and dreamy neon color shift',
            4: 'with noticeable digital glitch, strong chromatic aberration, and vibrant dreamy neon color shift',
            5: 'with intense digital glitch, extreme chromatic aberration, and dramatic dreamy neon color shift'
          }
        },
        sophisticated: {
          base: 'with subtle digital glitch, chromatic aberration, and dreamy neon color shift',
          intensity: {
            1: 'with very subtle digital glitch, minimal chromatic aberration, and soft dreamy neon color shift',
            2: 'with subtle digital glitch, mild chromatic aberration, and gentle dreamy neon color shift',
            3: 'with subtle digital glitch, chromatic aberration, and dreamy neon color shift',
            4: 'with noticeable digital glitch, strong chromatic aberration, and vibrant dreamy neon color shift',
            5: 'with intense digital glitch, extreme chromatic aberration, and dramatic dreamy neon color shift'
          }
        },
        // #ê¸´ë°•í•œ / #ê°•ë ¬í•œ
        intense: {
          base: 'with extreme speed ramping, directional motion blur, and sudden sharp focus',
          intensity: {
            1: 'with gentle speed ramping, subtle motion blur, and gradual sharp focus',
            2: 'with moderate speed ramping, noticeable motion blur, and quick sharp focus',
            3: 'with extreme speed ramping, directional motion blur, and sudden sharp focus',
            4: 'with intense speed ramping, strong directional motion blur, and dramatic sudden sharp focus',
            5: 'with maximum speed ramping, extreme directional motion blur, and ultra-dramatic sudden sharp focus'
          }
        },
        // #ì°¨ë¶„í•œ / #ì •ë³´ì „ë‹¬
        calm: {
          base: 'with smooth slow push-in and subtle clarity enhancement for a clean look',
          intensity: {
            1: 'with very smooth slow push-in and minimal clarity enhancement for a clean look',
            2: 'with smooth slow push-in and subtle clarity enhancement for a clean look',
            3: 'with smooth slow push-in and noticeable clarity enhancement for a clean look',
            4: 'with smooth slow push-in and strong clarity enhancement for a clean look',
            5: 'with smooth slow push-in and maximum clarity enhancement for a clean look'
          }
        },
        informative: {
          base: 'with smooth slow push-in and subtle clarity enhancement for a clean look',
          intensity: {
            1: 'with very smooth slow push-in and minimal clarity enhancement for a clean look',
            2: 'with smooth slow push-in and subtle clarity enhancement for a clean look',
            3: 'with smooth slow push-in and noticeable clarity enhancement for a clean look',
            4: 'with smooth slow push-in and strong clarity enhancement for a clean look',
            5: 'with smooth slow push-in and maximum clarity enhancement for a clean look'
          }
        }
      };

      return effectTable[mood] || effectTable.informative; // ê¸°ë³¸ê°’: ì •ë³´ì „ë‹¬
    }

    // íƒ€ê²Ÿ ì¥ë©´ ì‹ë³„ ë° VEO í”„ë¡¬í”„íŠ¸ ì¸ì ì…˜ (ë¹„íŠ¸ ë“œë¡­ íš¨ê³¼)
    function injectBeatDropEffects(videoData) {
      if (!videoData || !bgmHotspot) {
        return videoData;
      }

      // ë¶„ìœ„ê¸°ë³„ íš¨ê³¼ ê°€ì ¸ì˜¤ê¸°
      var moodEffect = getEffectByMood(selectedMood);
      var effectPrompt = moodEffect.intensity && moodEffect.intensity[effectIntensity] 
        ? moodEffect.intensity[effectIntensity] 
        : moodEffect.base;

      // ì‡¼ì¸  íƒ€ì„ë¼ì¸ì—ì„œ í•«ìŠ¤íŒŸ êµ¬ê°„ ê³„ì‚°
      var hotspotTime = bgmHotspot.time;
      var hotspotStart = hotspotTime - 0.5; // 0.5ì´ˆ ì „ë¶€í„° ì‹œì‘
      var hotspotEnd = hotspotTime + 0.5; // 0.5ì´ˆ í›„ê¹Œì§€

      // ì˜ìƒ ë°ì´í„° ë³µì‚¬
      var enhancedData = JSON.parse(JSON.stringify(videoData));

      // ê° ì”¬ì˜ íƒ€ì„ë¼ì¸ ê³„ì‚° ë° í”„ë¡¬í”„íŠ¸ ì¸ì ì…˜
      if (enhancedData.generatedVideos && enhancedData.generatedVideos.length > 0) {
        var currentTime = 0;
        
        enhancedData.generatedVideos.forEach(function(scene) {
          // ì”¬ì˜ ëŒ€ëµì ì¸ ê¸¸ì´ ì¶”ì • (ê¸°ë³¸ 30ì´ˆ ë˜ëŠ” ì‹¤ì œ ê¸¸ì´)
          var sceneDuration = scene.duration || 30;
          var sceneStart = currentTime;
          var sceneEnd = currentTime + sceneDuration;

          // í•«ìŠ¤íŒŸ êµ¬ê°„ì´ ì´ ì”¬ì— í¬í•¨ë˜ëŠ”ì§€ í™•ì¸
          if (hotspotStart >= sceneStart && hotspotStart <= sceneEnd) {
            // ê¸°ë³¸ í”„ë¡¬í”„íŠ¸ ê°€ì ¸ì˜¤ê¸° (ì”¬ì˜ image_prompt ë˜ëŠ” visual_description ì‚¬ìš©)
            var basePrompt = scene.image_prompt || scene.visual_description || '';
            
            // ë¶„ìœ„ê¸°ë³„ ë¹„íŠ¸ ë“œë¡­ íš¨ê³¼ í”„ë¡¬í”„íŠ¸ ì¸ì ì…˜
            var enhancedPrompt = basePrompt + ', ' + effectPrompt + ' for dramatic effect emphasized by the music beat drop.';
            
            // í”„ë¡¬í”„íŠ¸ ì—…ë°ì´íŠ¸
            scene.image_prompt = enhancedPrompt;
            scene.visual_description = enhancedPrompt;
            scene.beat_drop_effect = true;
            scene.beat_drop_time = hotspotTime - sceneStart; // ì”¬ ë‚´ ìƒëŒ€ ì‹œê°„
            scene.beat_drop_mood = selectedMood;
            scene.beat_drop_intensity = effectIntensity;
          }

          currentTime = sceneEnd;
        });
      }

      // JSON ë°ì´í„°ì˜ scenes ë°°ì—´ë„ ì—…ë°ì´íŠ¸
      if (enhancedData.jsonData && enhancedData.jsonData.scenes) {
        var currentTime = 0;
        
        enhancedData.jsonData.scenes.forEach(function(scene) {
          var sceneDuration = 30; // ê¸°ë³¸ 30ì´ˆ ì¶”ì •
          var sceneStart = currentTime;
          var sceneEnd = currentTime + sceneDuration;

          if (hotspotStart >= sceneStart && hotspotStart <= sceneEnd) {
            var basePrompt = scene.image_prompt || scene.visual_description || '';
            var enhancedPrompt = basePrompt + ', ' + effectPrompt + ' for dramatic effect emphasized by the music beat drop.';
            
            scene.image_prompt = enhancedPrompt;
            scene.visual_description = enhancedPrompt;
            scene.beat_drop_effect = true;
            scene.beat_drop_time = hotspotTime - sceneStart;
            scene.beat_drop_mood = selectedMood;
            scene.beat_drop_intensity = effectIntensity;
          }

          currentTime = sceneEnd;
        });
      }

      return enhancedData;
    }

    // ë¹„ë””ì˜¤ íƒ€ì„ë¼ì¸ì— í•«ìŠ¤íŒŸ ë§ˆì»¤ ë Œë”ë§
    function renderTimelineHotspot() {
      if (!bgmHotspot) return;

      var videoPreview = document.getElementById('videoPreview');
      var timelineOverlay = document.getElementById('videoTimelineOverlay');
      var timelineHotspot = document.getElementById('timelineHotspot');

      if (!videoPreview || !timelineOverlay || !timelineHotspot) return;

      var duration = videoPreview.duration;
      if (!duration || duration === 0) return;

      // í•«ìŠ¤íŒŸ ìœ„ì¹˜ ê³„ì‚° (ë¹„ë””ì˜¤ íƒ€ì„ë¼ì¸ ê¸°ì¤€)
      var hotspotPosition = (bgmHotspot.time / duration) * 100;
      
      timelineHotspot.style.left = hotspotPosition + '%';
      timelineHotspot.style.display = 'block';
      timelineOverlay.style.display = 'block';
    }

    // ì‡¼ì¸  ë‹¤ìš´ë¡œë“œ
    function downloadShorts() {
      if (!convertedVideoUrl) {
        alert('ë³€í™˜ëœ ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      var a = document.createElement('a');
      a.href = convertedVideoUrl;
      a.download = 'shorts_' + selectedPlatform + '_' + Date.now() + '.mp4';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }

    // ë¡œê·¸ì˜¨ ì‹œìŠ¤í…œ
    var isLoggedIn = false;
    function checkLoginStatus() {
      var loginStatus = localStorage.getItem('isLoggedIn');
      var loginTime = localStorage.getItem('loginTime');
      if (loginStatus === 'true' && loginTime) {
        var loginDate = new Date(loginTime);
        var now = new Date();
        var hoursDiff = (now - loginDate) / (1000 * 60 * 60);
        if (hoursDiff < 24) {
          isLoggedIn = true;
          updateUIForLogin();
          return true;
        }
      }
      isLoggedIn = false;
      updateUIForLogout();
      return false;
    }
    function login() {
      var id = document.getElementById('loginId').value.trim();
      var pw = document.getElementById('loginPw').value.trim();
      if (!id || !pw) {
        alert('IDì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
        return;
      }
      var users = JSON.parse(localStorage.getItem('approvedUsers') || '[]');
      var user = users.find(function(u) {
        return u.id === id && u.password === pw;
      });
      if (user) {
        isLoggedIn = true;
        localStorage.setItem('isLoggedIn', 'true');
        localStorage.setItem('loginTime', new Date().toISOString());
        localStorage.setItem('currentUserId', id);
        updateUIForLogin();
        alert('ë¡œê·¸ì˜¨ë˜ì—ˆìŠµë‹ˆë‹¤.');
        document.getElementById('loginId').value = '';
        document.getElementById('loginPw').value = '';
      } else {
        alert('ìŠ¹ì¸ëœ IDì™€ ë¹„ë°€ë²ˆí˜¸ê°€ ì•„ë‹™ë‹ˆë‹¤.');
      }
    }
    function logout() {
      isLoggedIn = false;
      localStorage.removeItem('isLoggedIn');
      localStorage.removeItem('loginTime');
      localStorage.removeItem('currentUserId');
      updateUIForLogout();
    }
    function updateUIForLogin() {
      document.getElementById('btnLogin').textContent = 'ë¡œê·¸ì•„ì›ƒ';
      document.getElementById('btnLogin').onclick = function() {
        if (confirm('ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          logout();
          alert('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
      };
      document.getElementById('loginId').disabled = true;
      document.getElementById('loginPw').disabled = true;
    }
    function updateUIForLogout() {
      document.getElementById('btnLogin').textContent = 'ë¡œê·¸ì˜¨';
      document.getElementById('btnLogin').onclick = login;
      document.getElementById('loginId').disabled = false;
      document.getElementById('loginPw').disabled = false;
    }
    document.getElementById('btnAdmin').onclick = function() {
      alert('ê´€ë¦¬ í˜ì´ì§€ëŠ” ë©”ì¸(index.html)ì—ì„œ ì´ìš©í•˜ì„¸ìš”.');
    };
    document.getElementById('btnLogin').onclick = login;
  </script>
</body>
</html>
