<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>12. ì±„ë„ ë§¤ë‹ˆì €</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Malgun Gothic", sans-serif;
      background: #f5f5f5;
      color: #333;
      min-height: 100vh;
    }
    .layout { display: flex; min-height: 100vh; padding-top: 0; }
    .sidebar {
      width: 300px;
      background: linear-gradient(180deg, #fafbff 0%, #f2f4f8 100%);
      border-right: 1px solid #e8ecf4;
      padding: 20px 16px 24px;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      gap: 20px;
      height: 100vh;
      overflow-y: auto;
    }
    .sidebar-logo {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      font-weight: 700;
      font-size: 1.5rem;
      letter-spacing: 0.05em;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 75%, #00f2fe 100%);
      background-size: 200% 200%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: auroraGradient 8s ease infinite;
      margin-top: 8px;
      margin-bottom: 0;
      padding-left: 4px;
      text-align: left;
    }
    @keyframes auroraGradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .sidebar-card {
      background: #fff;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.06);
      border: 1px solid rgba(0,0,0,0.04);
    }
    /* í˜„ì¬ í”„ë¡œì íŠ¸ */
    .project-label {
      font-size: 12px;
      color: #718096;
      margin-bottom: 6px;
    }
    .project-name-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 14px;
    }
    .project-name {
      font-size: 16px;
      font-weight: 700;
      color: #1a202c;
    }
    .project-name-edit {
      color: #718096;
      cursor: pointer;
      font-size: 14px;
    }
    .project-name-edit:hover {
      color: #3182ce;
    }
    /* í”„ë¡œì íŠ¸ ì•¡ì…˜ í•œ ì¤„ ë°°ì¹˜ */
    .project-actions-row {
      display: flex;
      gap: 6px;
      margin-top: 8px;
    }
    .sidebar-btn-inline {
      flex: 1;
      padding: 8px 12px;
      border: none;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }
    .sidebar-btn-inline-primary {
      background: linear-gradient(135deg, #805ad5 0%, #6b46c1 100%);
      color: #fff;
    }
    .sidebar-btn-inline-primary:hover {
      background: linear-gradient(135deg, #6b46c1 0%, #553c9a 100%);
    }
    .sidebar-btn-inline-secondary {
      background: #fff;
      color: #2d3748;
      border: 1px solid #e2e8f0;
    }
    .sidebar-btn-inline-secondary:hover {
      background: #f7fafc;
      border-color: #cbd5e0;
    }
    .workflow-title {
      font-size: 13px;
      font-weight: 700;
      color: #4a5568;
      margin-bottom: 12px;
      padding: 0 4px;
    }
    .workflow-list { list-style: none; padding-right: 4px; }
    .workflow-item {
      display: block;
      padding: 12px 14px;
      margin-bottom: 6px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 500;
      color: #4a5568;
      background: #fff;
      border: 1px solid #e2e8f0;
      text-decoration: none;
      transition: background 0.2s, color 0.2s, border-color 0.2s;
    }
    .workflow-item:hover { background: #f7fafc; border-color: #cbd5e0; color: #2d3748; }
    .workflow-item.active {
      background: linear-gradient(135deg, #e9d8fd 0%, #e2e8f0 100%);
      border-color: #b794f4;
      color: #553c9a;
      font-weight: 600;
    }

    .main {
      flex: 1;
      padding: 24px 32px 40px;
      overflow-y: auto;
    }
    .header-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 24px;
      margin-top: 0;
      padding-top: 0;
    }
    .title-area { flex: 1; }
    .title-area h1 {
      font-size: 24px;
      font-weight: 700;
      color: #222;
      margin-bottom: 4px;
      margin-top: 0;
      line-height: 1.3;
    }
    .title-area .subtitle {
      font-size: 14px;
      color: #666;
      margin: 0;
      line-height: 1.4;
    }
    .header-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 8px;
    }
    .login-inline-row {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .login-input {
      height: 32px;
      padding: 0 10px;
      border: 1px solid #cbd5e0;
      border-radius: 4px;
      font-size: 13px;
      box-sizing: border-box;
      transition: background-color 0.2s, border-color 0.2s;
      width: 140px;
    }
    .login-input::placeholder { color: #a0aec0; }
    .login-input:disabled {
      background-color: #E0E0E0;
      border-color: #999;
      color: #666;
      cursor: not-allowed;
      pointer-events: none;
    }
    .btn-admin, .btn-login {
      padding: 0 12px;
      height: 32px;
      background: #e0e0e0;
      color: #333;
      border: 1px solid #c0c0c0;
      border-radius: 4px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
    }
    .btn-admin:hover, .btn-login:hover { background: #d5d5d5; }

    /* Content Cards */
    .content-card {
      background: #fff;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      border: 1px solid #e2e8f0;
    }
    .card-title {
      font-size: 18px;
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 16px;
    }
    .card-desc {
      font-size: 14px;
      color: #666;
      margin-bottom: 20px;
    }

    /* Channel Dashboard */
    .channel-overview {
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 20px;
      align-items: center;
      margin-bottom: 24px;
    }
    .channel-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 32px;
      font-weight: 700;
    }
    .channel-info {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .channel-name {
      font-size: 20px;
      font-weight: 700;
      color: #2d3748;
    }
    .channel-stats {
      display: flex;
      gap: 24px;
      font-size: 14px;
      color: #666;
    }
    .stat-item {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .stat-label {
      font-size: 12px;
      color: #999;
    }
    .stat-value {
      font-size: 18px;
      font-weight: 700;
      color: #2d3748;
    }
    .upload-status-badges {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
    }
    .status-badge.pending {
      background: #fef3c7;
      color: #92400e;
    }
    .status-badge.scheduled {
      background: #dbeafe;
      color: #1e40af;
    }
    .status-badge.published {
      background: #d1fae5;
      color: #047857;
    }
    .badge-count {
      background: rgba(0,0,0,0.1);
      padding: 2px 8px;
      border-radius: 12px;
      font-weight: 700;
    }

    /* Smart Scheduler */
    .video-selector {
      margin-bottom: 24px;
    }
    .video-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-height: 300px;
      overflow-y: auto;
      padding: 12px;
      background: #f7fafc;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
    }
    .video-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: #fff;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
      cursor: pointer;
      transition: all 0.2s;
    }
    .video-item:hover {
      border-color: #b794f4;
      box-shadow: 0 2px 8px rgba(147, 51, 234, 0.1);
    }
    .video-item.selected {
      border-color: #9333ea;
      background: #faf5ff;
    }
    .video-thumbnail {
      width: 80px;
      height: 45px;
      border-radius: 6px;
      object-fit: cover;
      background: #e2e8f0;
    }
    .video-info {
      flex: 1;
    }
    .video-title {
      font-size: 14px;
      font-weight: 600;
      color: #2d3748;
      margin-bottom: 4px;
    }
    .video-meta {
      font-size: 12px;
      color: #666;
    }
    .video-checkbox {
      width: 20px;
      height: 20px;
      cursor: pointer;
    }
    .golden-time-section {
      margin-top: 24px;
      padding: 20px;
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      border-radius: 12px;
      border: 2px solid #fbbf24;
    }
    .golden-time-label {
      font-size: 14px;
      font-weight: 600;
      color: #92400e;
      margin-bottom: 8px;
    }
    .golden-time-value {
      font-size: 24px;
      font-weight: 700;
      color: #78350f;
      margin-bottom: 12px;
    }
    .btn-apply-time {
      padding: 8px 16px;
      background: #f59e0b;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
    }
    .btn-apply-time:hover {
      background: #d97706;
    }
    .datetime-selector {
      margin-top: 20px;
    }
    .datetime-label {
      font-size: 14px;
      font-weight: 600;
      color: #2d3748;
      margin-bottom: 8px;
    }
    .datetime-input {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #cbd5e0;
      border-radius: 8px;
      font-size: 14px;
      box-sizing: border-box;
    }
    .metadata-review {
      margin-top: 24px;
      padding: 20px;
      background: #f7fafc;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
    }
    .metadata-item {
      margin-bottom: 16px;
    }
    .metadata-item:last-child {
      margin-bottom: 0;
    }
    .metadata-label {
      font-size: 12px;
      font-weight: 600;
      color: #4a5568;
      margin-bottom: 6px;
    }
    .metadata-value {
      font-size: 14px;
      color: #2d3748;
      padding: 10px;
      background: #fff;
      border-radius: 6px;
      border: 1px solid #e2e8f0;
      white-space: pre-wrap;
      word-break: break-word;
    }

    /* Performance Insight */
    .prediction-chart {
      height: 200px;
      background: #f7fafc;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
      display: flex;
      align-items: flex-end;
      justify-content: space-around;
      padding: 16px;
      margin-bottom: 20px;
    }
    .chart-bar {
      flex: 1;
      margin: 0 4px;
      background: linear-gradient(180deg, #9333ea 0%, #7c3aed 100%);
      border-radius: 4px 4px 0 0;
      min-height: 20px;
      position: relative;
      cursor: pointer;
      transition: all 0.2s;
    }
    .chart-bar:hover {
      opacity: 0.8;
      transform: scaleY(1.05);
    }
    .chart-label {
      position: absolute;
      bottom: -20px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 11px;
      color: #666;
      white-space: nowrap;
    }
    .prediction-range {
      text-align: center;
      font-size: 14px;
      color: #666;
      margin-top: 32px;
    }
    .prediction-value {
      font-size: 20px;
      font-weight: 700;
      color: #9333ea;
    }
    .platform-switch {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    .platform-checkbox {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px 16px;
      background: #f7fafc;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .platform-checkbox:hover {
      border-color: #cbd5e0;
    }
    .platform-checkbox.checked {
      background: #faf5ff;
      border-color: #9333ea;
    }
    .platform-checkbox input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }
    .platform-label {
      font-size: 14px;
      font-weight: 600;
      color: #2d3748;
    }

    /* Buttons */
    .btn-primary {
      padding: 12px 24px;
      background: #e53935;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.2s;
    }
    .btn-primary:hover {
      background: #c62828;
    }
    .btn-primary:disabled {
      background: #cbd5e0;
      cursor: not-allowed;
    }
    .action-buttons {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }

    /* A/B Test Styles */
    .ab-test-section {
      margin-top: 24px;
      padding: 24px;
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      border-radius: 12px;
      border: 2px solid #fbbf24;
    }
    .ab-test-title {
      font-size: 18px;
      font-weight: 700;
      color: #78350f;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .thumbnail-selector-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 24px;
    }
    .thumbnail-selector-card {
      background: #fff;
      border-radius: 12px;
      padding: 16px;
      border: 2px solid #e2e8f0;
      transition: all 0.2s;
    }
    .thumbnail-selector-card.selected {
      border-color: #9333ea;
      box-shadow: 0 4px 12px rgba(147, 51, 234, 0.2);
    }
    .thumbnail-selector-label {
      font-size: 14px;
      font-weight: 600;
      color: #2d3748;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .thumbnail-selector-label .badge {
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 700;
    }
    .badge.control {
      background: #dbeafe;
      color: #1e40af;
    }
    .badge.experiment {
      background: #fce7f3;
      color: #9f1239;
    }
    .thumbnail-preview-box {
      width: 100%;
      aspect-ratio: 16/9;
      background: #f7fafc;
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid #e2e8f0;
      margin-bottom: 12px;
      position: relative;
      cursor: pointer;
    }
    .thumbnail-preview-box img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .thumbnail-preview-box .placeholder {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: #999;
      font-size: 14px;
      flex-direction: column;
      gap: 8px;
    }
    .thumbnail-preview-box .select-btn {
      position: absolute;
      bottom: 8px;
      right: 8px;
      padding: 6px 12px;
      background: rgba(0, 0, 0, 0.7);
      color: #fff;
      border: none;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      backdrop-filter: blur(4px);
    }
    .test-settings-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }
    .test-setting-item {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .test-setting-label {
      font-size: 14px;
      font-weight: 600;
      color: #2d3748;
    }
    .test-setting-select {
      padding: 10px 12px;
      border: 1px solid #cbd5e0;
      border-radius: 8px;
      font-size: 14px;
      background: #fff;
      cursor: pointer;
    }
    .test-metrics {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .metric-checkbox {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px;
      background: #fff;
      border-radius: 6px;
      cursor: pointer;
    }
    .metric-checkbox input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }
    .metric-label {
      font-size: 14px;
      color: #2d3748;
    }
    .test-progress-section {
      margin-top: 24px;
      padding: 20px;
      background: #fff;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
    }
    .progress-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .progress-label {
      font-size: 14px;
      font-weight: 600;
      color: #2d3748;
    }
    .progress-value {
      font-size: 14px;
      font-weight: 700;
      color: #9333ea;
    }
    .progress-bar-container {
      width: 100%;
      height: 8px;
      background: #e2e8f0;
      border-radius: 4px;
      overflow: hidden;
    }
    .progress-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #9333ea 0%, #7c3aed 100%);
      transition: width 0.3s ease;
    }
    .preview-comparison {
      margin-top: 24px;
      padding: 20px;
      background: #fff;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
    }
    .comparison-title {
      font-size: 16px;
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 16px;
    }
    .comparison-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    .comparison-item {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .comparison-label {
      font-size: 12px;
      font-weight: 600;
      color: #666;
      text-align: center;
    }
    .comparison-preview {
      width: 100%;
      aspect-ratio: 16/9;
      background: #f7fafc;
      border-radius: 8px;
      overflow: hidden;
      border: 2px solid #e2e8f0;
      position: relative;
    }
    .comparison-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .comparison-preview .youtube-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(to bottom, rgba(0,0,0,0.3) 0%, transparent 20%, transparent 80%, rgba(0,0,0,0.3) 100%);
      pointer-events: none;
    }
    .comparison-stats {
      display: flex;
      justify-content: space-around;
      padding: 8px;
      background: #f7fafc;
      border-radius: 6px;
      font-size: 12px;
    }
    .stat-item-small {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
    }
    .stat-label-small {
      color: #666;
    }
    .stat-value-small {
      font-weight: 700;
      color: #9333ea;
    }
    .test-result-alert {
      margin-top: 20px;
      padding: 16px;
      background: #d1fae5;
      border: 2px solid #10b981;
      border-radius: 8px;
      display: none;
    }
    .test-result-alert.show {
      display: block;
    }
    .test-result-title {
      font-size: 16px;
      font-weight: 700;
      color: #047857;
      margin-bottom: 8px;
    }
    .test-result-text {
      font-size: 14px;
      color: #065f46;
    }

    /* AI ì¡°ê¸° í™•ì • ìŠ¤íƒ€ì¼ */
    .early-win-section {
      margin-top: 24px;
      padding: 20px;
      background: #fff;
      border-radius: 8px;
      border: 2px solid #e2e8f0;
    }
    .early-win-checkbox {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      margin-bottom: 16px;
    }
    .early-win-checkbox input[type="checkbox"] {
      width: 20px;
      height: 20px;
      cursor: pointer;
    }
    .early-win-label {
      font-size: 16px;
      font-weight: 700;
      color: #2d3748;
    }
    .early-win-settings {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid #e2e8f0;
    }
    .early-win-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    .early-win-item {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .early-win-label-small {
      font-size: 14px;
      font-weight: 600;
      color: #4a5568;
    }
    .early-win-input-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .early-win-input {
      flex: 1;
      padding: 10px 12px;
      border: 1px solid #cbd5e0;
      border-radius: 8px;
      font-size: 14px;
      box-sizing: border-box;
    }
    .early-win-unit {
      font-size: 14px;
      color: #666;
      white-space: nowrap;
    }
    .early-win-hint {
      font-size: 12px;
      color: #999;
      margin-top: 4px;
    }
    .early-win-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 10px;
      background: #fef3c7;
      color: #92400e;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 700;
      margin-left: 8px;
    }
    .early-win-report {
      margin-top: 16px;
      padding: 12px;
      background: #f0f9ff;
      border-left: 4px solid #0ea5e9;
      border-radius: 6px;
      font-size: 13px;
      color: #0c4a6e;
    }
    .early-win-report-title {
      font-weight: 700;
      margin-bottom: 4px;
    }

    /* ì¿¼í„° ì œí•œ ì‹œìŠ¤í…œ ìŠ¤íƒ€ì¼ */
    .quota-system-section {
      margin-top: 24px;
      padding: 20px;
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      border-radius: 12px;
      border: 2px solid #fbbf24;
    }
    .quota-system-title {
      font-size: 18px;
      font-weight: 700;
      color: #92400e;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .safe-mode-switch {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: #fff;
      border-radius: 8px;
      margin-bottom: 20px;
      border: 2px solid #fbbf24;
    }
    .safe-mode-switch input[type="checkbox"] {
      width: 24px;
      height: 24px;
      cursor: pointer;
    }
    .safe-mode-label {
      font-size: 15px;
      font-weight: 600;
      color: #92400e;
      flex: 1;
    }
    .safe-mode-hint {
      font-size: 12px;
      color: #a16207;
      margin-top: 4px;
    }
    .channel-quota-card {
      background: #fff;
      border-radius: 10px;
      padding: 16px;
      margin-bottom: 12px;
      border: 1px solid #e2e8f0;
      transition: all 0.2s;
    }
    .channel-quota-card.quota-exceeded {
      border-color: #ef4444;
      background: #fef2f2;
    }
    .channel-quota-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }
    .channel-quota-name {
      font-size: 15px;
      font-weight: 600;
      color: #2d3748;
    }
    .quota-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 700;
    }
    .quota-badge.warning {
      background: #fef3c7;
      color: #92400e;
    }
    .quota-badge.exceeded {
      background: #fee2e2;
      color: #991b1b;
    }
    .quota-slider-container {
      margin-bottom: 12px;
    }
    .quota-slider-label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      font-size: 13px;
      color: #4a5568;
    }
    .quota-slider {
      width: 100%;
      height: 6px;
      border-radius: 3px;
      background: #e2e8f0;
      outline: none;
      -webkit-appearance: none;
      appearance: none;
    }
    .quota-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #9333ea;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    .quota-slider::-moz-range-thumb {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #9333ea;
      cursor: pointer;
      border: none;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    .quota-counter {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: #4a5568;
    }
    .quota-progress-bar {
      flex: 1;
      height: 8px;
      background: #e2e8f0;
      border-radius: 4px;
      overflow: hidden;
      position: relative;
    }
    .quota-progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #10b981 0%, #059669 100%);
      transition: width 0.3s, background 0.3s;
    }
    .quota-progress-fill.warning {
      background: linear-gradient(90deg, #f59e0b 0%, #d97706 100%);
    }
    .quota-progress-fill.exceeded {
      background: linear-gradient(90deg, #ef4444 0%, #dc2626 100%);
    }
    .quota-status-text {
      font-size: 12px;
      font-weight: 600;
      min-width: 120px;
      text-align: right;
    }
    .quota-status-text.normal {
      color: #059669;
    }
    .quota-status-text.warning {
      color: #d97706;
    }
    .quota-status-text.exceeded {
      color: #dc2626;
    }
    .upload-result-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(4px);
      z-index: 10000;
      display: none;
      align-items: center;
      justify-content: center;
    }
    .upload-result-modal.show {
      display: flex;
    }
    .upload-result-content {
      background: #fff;
      border-radius: 16px;
      padding: 32px;
      max-width: 500px;
      width: 90%;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }
    .upload-result-title {
      font-size: 20px;
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 16px;
    }
    .upload-result-summary {
      margin-bottom: 20px;
      line-height: 1.6;
      color: #4a5568;
    }
    .upload-result-item {
      padding: 8px 0;
      border-bottom: 1px solid #e2e8f0;
    }
    .upload-result-item:last-child {
      border-bottom: none;
    }

    /* MCN í†µí•© ëŒ€ì‹œë³´ë“œ ìŠ¤íƒ€ì¼ */
    .mcn-stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      margin-bottom: 24px;
    }
    .mcn-stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 12px;
      padding: 20px;
      color: #fff;
      text-align: center;
    }
    .mcn-stat-label {
      font-size: 13px;
      opacity: 0.9;
      margin-bottom: 8px;
    }
    .mcn-stat-value {
      font-size: 24px;
      font-weight: 700;
    }
    .revenue-contribution-section {
      margin-top: 24px;
    }
    .revenue-chart-container {
      background: #f7fafc;
      border-radius: 8px;
      padding: 20px;
      min-height: 300px;
      border: 1px solid #e2e8f0;
    }

    /* ìˆ˜ìµ ì°½ì¶œ íŠ¸ë˜ì»¤ ìŠ¤íƒ€ì¼ */
    .growth-tracker-card {
      background: #fff;
      border-radius: 10px;
      padding: 16px;
      margin-bottom: 12px;
      border: 1px solid #e2e8f0;
    }
    .tracker-item {
      margin-bottom: 16px;
    }
    .tracker-item:last-child {
      margin-bottom: 0;
    }
    .tracker-label {
      font-size: 13px;
      color: #4a5568;
      margin-bottom: 8px;
      font-weight: 600;
    }
    .tracker-progress {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .tracker-progress .progress-bar {
      flex: 1;
      height: 10px;
      background: #e2e8f0;
      border-radius: 5px;
      overflow: hidden;
    }
    .tracker-progress .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #10b981 0%, #059669 100%);
      transition: width 0.3s;
    }
    .tracker-value {
      font-size: 13px;
      font-weight: 600;
      color: #2d3748;
      min-width: 120px;
      text-align: right;
    }
    .revenue-badge {
      margin-top: 12px;
      padding: 8px 16px;
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      color: #fff;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 700;
      text-align: center;
    }

    /* ë¼ì´ì§• ì±„ë„ ì„¹ì…˜ */
    .rising-channels-section {
      margin-top: 24px;
    }
    .rising-channels-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 16px;
    }
    .rising-channel-card {
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      border-radius: 12px;
      padding: 16px;
      border: 2px solid #fbbf24;
      position: relative;
      overflow: hidden;
    }
    .rising-channel-card::before {
      content: 'ğŸ”¥';
      position: absolute;
      top: 8px;
      right: 8px;
      font-size: 20px;
    }
    .rising-channel-name {
      font-size: 15px;
      font-weight: 700;
      color: #92400e;
      margin-bottom: 8px;
    }
    .rising-channel-growth {
      font-size: 13px;
      color: #78350f;
    }
    .growth-badge {
      display: inline-block;
      padding: 4px 8px;
      background: #fbbf24;
      color: #78350f;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 700;
      margin-top: 4px;
    }

    /* AI ì»¤ë®¤ë‹ˆí‹° ê´€ë¦¬ì ìŠ¤íƒ€ì¼ */
    .comment-filters {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .filter-btn {
      padding: 8px 16px;
      border: 1px solid #cbd5e0;
      border-radius: 8px;
      background: #fff;
      color: #4a5568;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    .filter-btn:hover {
      background: #f7fafc;
      border-color: #b794f4;
    }
    .filter-btn.active {
      background: linear-gradient(135deg, #9333ea 0%, #ec4899 100%);
      color: #fff;
      border-color: #9333ea;
    }
    .comments-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-height: 600px;
      overflow-y: auto;
      padding: 12px;
      background: #f7fafc;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
    }
    .comment-item {
      background: #fff;
      border-radius: 8px;
      padding: 16px;
      border: 1px solid #e2e8f0;
      transition: all 0.2s;
    }
    .comment-item:hover {
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .comment-item.spam {
      background: #fef2f2;
      border-color: #fecaca;
    }
    .comment-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }
    .comment-channel {
      font-size: 12px;
      color: #666;
      font-weight: 600;
    }
    .comment-status {
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 700;
    }
    .comment-status.pending {
      background: #fef3c7;
      color: #92400e;
    }
    .comment-status.approved {
      background: #d1fae5;
      color: #047857;
    }
    .comment-status.spam {
      background: #fee2e2;
      color: #991b1b;
    }
    .comment-text {
      font-size: 14px;
      color: #2d3748;
      margin-bottom: 12px;
      line-height: 1.5;
    }
    .comment-ai-reply {
      background: #f0f9ff;
      border-left: 3px solid #0ea5e9;
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 12px;
    }
    .comment-ai-reply-label {
      font-size: 11px;
      color: #0c4a6e;
      font-weight: 700;
      margin-bottom: 4px;
    }
    .comment-ai-reply-text {
      font-size: 13px;
      color: #0c4a6e;
      line-height: 1.5;
    }
    .comment-actions {
      display: flex;
      gap: 8px;
    }
    .btn-comment-action {
      padding: 6px 12px;
      border: 1px solid #cbd5e0;
      border-radius: 6px;
      background: #fff;
      color: #4a5568;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-comment-action:hover {
      background: #f7fafc;
    }
    .btn-comment-action.approve {
      background: #10b981;
      color: #fff;
      border-color: #10b981;
    }
    .btn-comment-action.approve:hover {
      background: #059669;
    }
    .btn-comment-action.reject {
      background: #ef4444;
      color: #fff;
      border-color: #ef4444;
    }
    .btn-comment-action.reject:hover {
      background: #dc2626;
    }
  </style>
</head>
<body>
  <div class="layout">
    <aside class="sidebar">
      <div class="sidebar-logo">HANRA STUDIO</div>

      <!-- í˜„ì¬ í”„ë¡œì íŠ¸ -->
      <div class="sidebar-card">
        <div class="project-label">í˜„ì¬ í”„ë¡œì íŠ¸</div>
        <div class="project-name-row">
          <span class="project-name">ìƒˆë¡œìš´ í”„ë¡œì íŠ¸</span>
          <span class="project-name-edit" title="ì´ë¦„ ìˆ˜ì •">âœ</span>
        </div>
        <div class="project-actions-row">
          <button type="button" class="sidebar-btn-inline sidebar-btn-inline-primary" id="btnCreateProject">
            Pìƒì„±
          </button>
          <button type="button" class="sidebar-btn-inline sidebar-btn-inline-secondary" id="btnProjectList">
            Pëª©ë¡
          </button>
        </div>
      </div>

      <div class="sidebar-card">
        <div class="workflow-title">ì§„í–‰ ë‹¨ê³„</div>
        <ul class="workflow-list">
          <li><a href="ai-automation-project.html" class="workflow-item">1. ì£¼ì œ ì¶”ì²œ</a></li>
          <li><a href="step-2.html" class="workflow-item">2. AI ëŒ€ë³¸ ìƒì„±</a></li>
          <li><a href="step-3.html" class="workflow-item">3. ëŒ€ë³¸ ì§ì ‘ ì…ë ¥</a></li>
          <li><a href="step-4-1.html" class="workflow-item">4-1. JSON ìƒì„±</a></li>
          <li><a href="step-4-2.html" class="workflow-item">4-2. ì´ë¯¸ì§€ ìƒì„±</a></li>
          <li><a href="step-6.html" class="workflow-item">5. TTS ìƒì„±</a></li>
          <li><a href="step-5-2.html" class="workflow-item">5-2. BGM ì‚½ì…</a></li>
          <li><a href="step-7.html" class="workflow-item">6. ì˜ìƒ ë Œë”ë§</a></li>
          <li><a href="step-8.html" class="workflow-item">7. ì œëª©/ì„¤ëª… ì‘ì„±</a></li>
          <li><a href="step-9.html" class="workflow-item">8. ì¸ë„¤ì¼ ìƒì„±ê¸°</a></li>
          <li><a href="step-10.html" class="workflow-item">9. ìµœì¢… ì œì‘</a></li>
          <li><a href="step-11.html" class="workflow-item">10. ì‡¼ì¸  ìë™ ë³€í™˜</a></li>
          <li><a href="step-12.html" class="workflow-item active">11. ì±„ë„ ë§¤ë‹ˆì €</a></li>
          <li><a href="step-13.html" class="workflow-item">12. ì‘ì—… ë³´ê´€í•¨</a></li>
        </ul>
      </div>
    </aside>

    <main class="main">
      <div class="header-row">
        <div class="title-area">
          <h1>12. ì±„ë„ ë§¤ë‹ˆì €</h1>
          <p class="subtitle">ìœ íŠœë¸Œ ì±„ë„ì„ ê´€ë¦¬í•˜ê³  ì˜ìƒì„ ì˜ˆì•½ ì—…ë¡œë“œí•©ë‹ˆë‹¤</p>
        </div>
        <div class="header-right">
          <div class="login-inline-row">
            <input type="text" class="login-input" id="loginId" placeholder="ID" />
            <input type="password" class="login-input" id="loginPw" placeholder="Password" />
            <button type="button" class="btn-admin" id="btnAdmin">ê´€ë¦¬</button>
            <button type="button" class="btn-login" id="btnLogin">ë¡œê·¸ì˜¨</button>
          </div>
        </div>
      </div>

      <!-- ì±„ë„ ëŒ€ì‹œë³´ë“œ -->
      <div class="content-card">
        <div class="card-title">ì±„ë„ ëŒ€ì‹œë³´ë“œ</div>
        <div class="channel-overview">
          <div class="channel-avatar" id="channelAvatar">H</div>
          <div class="channel-info">
            <div class="channel-name" id="channelName">HANRA STUDIO</div>
            <div class="channel-stats">
              <div class="stat-item">
                <span class="stat-label">êµ¬ë…ì</span>
                <span class="stat-value" id="subscriberCount">-</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">ìµœê·¼ 28ì¼ ì¡°íšŒìˆ˜</span>
                <span class="stat-value" id="recentViews">-</span>
              </div>
            </div>
          </div>
        </div>
        <div class="upload-status-badges">
          <div class="status-badge pending">
            ì—…ë¡œë“œ ëŒ€ê¸° ì¤‘ <span class="badge-count" id="pendingCount">0</span>
          </div>
          <div class="status-badge scheduled">
            ì˜ˆì•½ë¨ <span class="badge-count" id="scheduledCount">0</span>
          </div>
          <div class="status-badge published">
            ê²Œì‹œ ì™„ë£Œ <span class="badge-count" id="publishedCount">0</span>
          </div>
        </div>
      </div>

      <!-- MCN í†µí•© ìˆ˜ìµ ë° ì„±ì¥ ëŒ€ì‹œë³´ë“œ -->
      <div class="content-card">
        <div class="card-title">MCN í†µí•© ìˆ˜ìµ ë° ì„±ì¥ ëŒ€ì‹œë³´ë“œ</div>
        <p class="card-desc">20ê°œ ì±„ë„ì˜ ì„±ê³¼ë¥¼ í•©ì‚°í•˜ê³ , ìˆ˜ìµ ì°½ì¶œ ì¡°ê±´ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¶”ì í•©ë‹ˆë‹¤.</p>

        <!-- í†µí•© ìŠ¤íƒœì¸  -->
        <div class="mcn-stats-grid">
          <div class="mcn-stat-card">
            <div class="mcn-stat-label">ì´ ì¡°íšŒìˆ˜</div>
            <div class="mcn-stat-value" id="totalViews">-</div>
          </div>
          <div class="mcn-stat-card">
            <div class="mcn-stat-label">ì´ ì˜ˆìƒ ìˆ˜ìµ</div>
            <div class="mcn-stat-value" id="totalRevenue">-</div>
          </div>
          <div class="mcn-stat-card">
            <div class="mcn-stat-label">í‰ê·  CTR</div>
            <div class="mcn-stat-value" id="avgCTR">-</div>
          </div>
          <div class="mcn-stat-card">
            <div class="mcn-stat-label">ì´ êµ¬ë…ì</div>
            <div class="mcn-stat-value" id="totalSubscribers">-</div>
          </div>
        </div>

        <!-- ì±„ë„ë³„ ìˆ˜ìµ ê¸°ì—¬ë„ ì°¨íŠ¸ -->
        <div class="revenue-contribution-section">
          <div class="card-title" style="font-size: 16px; margin-top: 24px; margin-bottom: 16px;">ì±„ë„ë³„ ìˆ˜ìµ ê¸°ì—¬ë„</div>
          <div class="revenue-chart-container" id="revenueChart">
            <!-- ì°¨íŠ¸ê°€ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
          </div>
        </div>
      </div>

      <!-- AI í”¼ë“œë°± ì¸ì‚¬ì´íŠ¸ ëŒ€ì‹œë³´ë“œ -->
      <div class="content-card">
        <div class="card-title">ğŸ’¡ AI í”¼ë“œë°± ì¸ì‚¬ì´íŠ¸ ëŒ€ì‹œë³´ë“œ</div>
        <p class="card-desc">ì‹œì²­ì ëŒ“ê¸€ì„ ë¶„ì„í•˜ì—¬ ë‹¤ìŒ ì£¼ì œ ì„ ì •ì— ë°˜ì˜í•  ì¸ì‚¬ì´íŠ¸ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</p>
        
        <div id="feedbackInsights" style="margin-top: 20px;">
          <div style="padding: 20px; background: #f7fafc; border-radius: 8px; text-align: center; color: #999;">
            í”¼ë“œë°± ë°ì´í„°ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...
          </div>
        </div>
      </div>

      <!-- ì¼ì¼ ì—…ë¡œë“œ ì¿¼í„° ì œí•œ ì‹œìŠ¤í…œ -->
      <div class="content-card">
        <div class="quota-system-section">
          <div class="quota-system-title">
            ğŸ›¡ï¸ ì¼ì¼ ì—…ë¡œë“œ ì¿¼í„° ì œí•œ ì‹œìŠ¤í…œ
          </div>
          
          <!-- ì „ì²´ ì±„ë„ ì•ˆì „ ëª¨ë“œ -->
          <div class="safe-mode-switch">
            <input type="checkbox" id="safeModeSwitch" />
            <div style="flex: 1;">
              <div class="safe-mode-label">ì „ì²´ ì±„ë„ ì•ˆì „ ëª¨ë“œ í™œì„±í™”</div>
              <div class="safe-mode-hint">ëª¨ë“  ì±„ë„ì˜ ì¼ì¼ ì—…ë¡œë“œ í•œë„ë¥¼ 2ê°œë¡œ ê³ ì •í•˜ê³ , ì—…ë¡œë“œ ê°„ê²©ì„ 1ì‹œê°„ ì´ìƒìœ¼ë¡œ ê°•ì œ ì¡°ì •í•©ë‹ˆë‹¤ (ëŒ€ëŸ‰ ìš´ì˜ ì‹œ ë¦¬ìŠ¤í¬ ë°©ì§€)</div>
            </div>
          </div>

          <!-- ì±„ë„ë³„ ì¿¼í„° ì„¤ì • -->
          <div id="channelQuotaList">
            <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§‘ë‹ˆë‹¤ -->
          </div>
        </div>
      </div>

      <!-- ìŠ¤ë§ˆíŠ¸ ì˜ˆì•½ ì—…ë¡œë“œ ì„¤ì • -->
      <div class="content-card">
        <div class="card-title">ìŠ¤ë§ˆíŠ¸ ì˜ˆì•½ ì—…ë¡œë“œ ì„¤ì •</div>
        <p class="card-desc">ì™„ì„±ëœ ì˜ìƒì„ ì„ íƒí•˜ê³  ì—…ë¡œë“œ ì‹œê°„ì„ ì˜ˆì•½í•˜ì„¸ìš”.</p>

        <!-- ëŒ€ìƒ ì„ íƒ -->
        <div class="video-selector">
          <div class="card-title" style="font-size: 16px; margin-bottom: 12px;">ì—…ë¡œë“œí•  ì˜ìƒ ì„ íƒ</div>
          <div class="video-list" id="videoList">
            <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§‘ë‹ˆë‹¤ -->
          </div>
        </div>

        <!-- ì¶”ì²œ ì—…ë¡œë“œ ì‹œê°„ -->
        <div class="golden-time-section">
          <div class="golden-time-label">AI ì¶”ì²œ ê³¨ë“  íƒ€ì„</div>
          <div class="golden-time-value" id="goldenTime">ë¶„ì„ ì¤‘...</div>
          <button class="btn-apply-time" type="button" id="btnApplyGoldenTime">ì ìš©í•˜ê¸°</button>
        </div>

        <!-- ë‚ ì§œ/ì‹œê°„ ì„ íƒ -->
        <div class="datetime-selector">
          <div class="datetime-label">ì—…ë¡œë“œ ì˜ˆì•½ ì‹œê°„</div>
          <input type="datetime-local" class="datetime-input" id="scheduleDateTime" />
        </div>

        <!-- ë©”íƒ€ë°ì´í„° í™•ì¸ -->
        <div class="metadata-review">
          <div class="card-title" style="font-size: 16px; margin-bottom: 16px;">ë©”íƒ€ë°ì´í„° í™•ì¸</div>
          <div class="metadata-item">
            <div class="metadata-label">ì œëª©</div>
            <div class="metadata-value" id="reviewTitle">-</div>
          </div>
          <div class="metadata-item">
            <div class="metadata-label">ì„¤ëª…</div>
            <div class="metadata-value" id="reviewDescription">-</div>
          </div>
          <div class="metadata-item">
            <div class="metadata-label">íƒœê·¸</div>
            <div class="metadata-value" id="reviewTags">-</div>
          </div>
        </div>
      </div>

      <!-- ì„±ê³¼ ì˜ˆì¸¡ ë° ë¶„ì„ -->
      <div class="content-card">
        <div class="card-title">ì„±ê³¼ ì˜ˆì¸¡ ë° ë¶„ì„</div>
        <p class="card-desc">AIê°€ ì£¼ì œì™€ ì¸ë„¤ì¼ì„ ë¶„ì„í•˜ì—¬ ì˜ˆìƒ ì¡°íšŒìˆ˜ë¥¼ ì˜ˆì¸¡í•©ë‹ˆë‹¤.</p>

        <!-- AI ì¡°íšŒìˆ˜ ì˜ˆì¸¡ -->
        <div class="prediction-chart" id="predictionChart">
          <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§‘ë‹ˆë‹¤ -->
        </div>
        <div class="prediction-range">
          ì˜ˆìƒ ì¡°íšŒìˆ˜: <span class="prediction-value" id="predictionValue">-</span>
        </div>

        <!-- í”Œë«í¼ë³„ ìŠ¤ìœ„ì¹˜ -->
        <div style="margin-top: 24px;">
          <div class="datetime-label" style="margin-bottom: 12px;">ë™ì‹œ ì—…ë¡œë“œ í”Œë«í¼</div>
          <div class="platform-switch">
            <label class="platform-checkbox">
              <input type="checkbox" id="platformYoutube" checked />
              <span class="platform-label">ğŸ“º YouTube</span>
            </label>
            <label class="platform-checkbox">
              <input type="checkbox" id="platformTiktok" />
              <span class="platform-label">ğŸµ TikTok</span>
            </label>
            <label class="platform-checkbox">
              <input type="checkbox" id="platformInstagram" />
              <span class="platform-label">ğŸ“¸ Instagram Reels</span>
            </label>
          </div>
        </div>
      </div>

      <!-- ì¸ë„¤ì¼ A/B í…ŒìŠ¤íŠ¸ ì„¤ì • -->
      <div class="content-card">
        <div class="ab-test-section">
          <div class="ab-test-title">
            ğŸ§ª ì¸ë„¤ì¼ A/B í…ŒìŠ¤íŠ¸ ì˜ˆì•½
          </div>
          
          <!-- ì¸ë„¤ì¼ ì„ íƒ -->
          <div class="thumbnail-selector-grid">
            <div class="thumbnail-selector-card" id="thumbnailACard">
              <div class="thumbnail-selector-label">
                <span class="badge control">ëŒ€ì¡°êµ°</span>
                ì¸ë„¤ì¼ A
              </div>
              <div class="thumbnail-preview-box" id="thumbnailAPreview">
                <div class="placeholder">
                  <span>ğŸ“·</span>
                  <span>ì¸ë„¤ì¼ ì„ íƒ</span>
                </div>
                <button class="select-btn" onclick="selectThumbnail('A')">ì„ íƒ</button>
              </div>
            </div>
            <div class="thumbnail-selector-card" id="thumbnailBCard">
              <div class="thumbnail-selector-label">
                <span class="badge experiment">ì‹¤í—˜êµ°</span>
                ì¸ë„¤ì¼ B
              </div>
              <div class="thumbnail-preview-box" id="thumbnailBPreview">
                <div class="placeholder">
                  <span>ğŸ“·</span>
                  <span>ì¸ë„¤ì¼ ì„ íƒ</span>
                </div>
                <button class="select-btn" onclick="selectThumbnail('B')">ì„ íƒ</button>
              </div>
            </div>
          </div>

          <!-- í…ŒìŠ¤íŠ¸ ì„¤ì • -->
          <div class="test-settings-row">
            <div class="test-setting-item">
              <div class="test-setting-label">í…ŒìŠ¤íŠ¸ ê¸°ê°„</div>
              <select class="test-setting-select" id="testDuration">
                <option value="6">6ì‹œê°„</option>
                <option value="12" selected>12ì‹œê°„</option>
                <option value="24">24ì‹œê°„</option>
                <option value="48">48ì‹œê°„</option>
              </select>
            </div>
            <div class="test-setting-item">
              <div class="test-setting-label">í…ŒìŠ¤íŠ¸ ì§€í‘œ</div>
              <div class="test-metrics">
                <label class="metric-checkbox">
                  <input type="checkbox" id="metricCTR" checked />
                  <span class="metric-label">í´ë¦­ë¥  (CTR) - ê¸°ë³¸</span>
                </label>
                <label class="metric-checkbox">
                  <input type="checkbox" id="metricWatchTime" />
                  <span class="metric-label">í‰ê·  ì‹œì²­ ì§€ì† ì‹œê°„</span>
                </label>
              </div>
            </div>
          </div>

          <!-- AI ì¡°ê¸° í™•ì • ì„¤ì • -->
          <div class="early-win-section">
            <label class="early-win-checkbox">
              <input type="checkbox" id="enableEarlyWin" />
              <span class="early-win-label">âš¡ AI ì¡°ê¸° í™•ì • í™œì„±í™”</span>
            </label>
            <div class="early-win-settings" id="earlyWinSettings" style="display: none;">
              <div class="early-win-row">
                <div class="early-win-item">
                  <div class="early-win-label-small">ì„ê³„ê°’ (CTR ì°¨ì´)</div>
                  <div class="early-win-input-group">
                    <input type="number" class="early-win-input" id="earlyWinThreshold" value="5" min="1" max="20" step="0.1" />
                    <span class="early-win-unit">% ì´ìƒ</span>
                  </div>
                  <div class="early-win-hint">ë‘ ì¸ë„¤ì¼ ê°„ CTR ì°¨ì´ê°€ ì´ ê°’ ì´ìƒì¼ ë•Œ ì¦‰ì‹œ ì¢…ë£Œ</div>
                </div>
                <div class="early-win-item">
                  <div class="early-win-label-small">ìµœì†Œ ë…¸ì¶œìˆ˜</div>
                  <div class="early-win-input-group">
                    <input type="number" class="early-win-input" id="earlyWinMinImpressions" value="1000" min="100" max="10000" step="100" />
                    <span class="early-win-unit">íšŒ</span>
                  </div>
                  <div class="early-win-hint">ìµœì†Œ ë…¸ì¶œìˆ˜ ë‹¬ì„± í›„ íŒì • (í†µê³„ì  ì‹ ë¢°ë„ ë³´ì¥)</div>
                </div>
              </div>
            </div>
          </div>

          <!-- í…ŒìŠ¤íŠ¸ ì§„í–‰ë¥  -->
          <div class="test-progress-section" id="testProgressSection" style="display: none;">
            <div class="progress-header">
              <div class="progress-label">
                A/B í…ŒìŠ¤íŠ¸ ì§„í–‰ë¥ 
                <span class="early-win-badge" id="earlyWinBadge" style="display: none;">âš¡ AI ì¡°ê¸° í™•ì •</span>
              </div>
              <div class="progress-value" id="progressValue">0%</div>
            </div>
            <div class="progress-bar-container">
              <div class="progress-bar-fill" id="progressBar" style="width: 0%;"></div>
            </div>
            <div class="early-win-report" id="earlyWinReport" style="display: none;">
              <div class="early-win-report-title">ğŸ“Š ì¡°ê¸° í™•ì • ë¦¬í¬íŠ¸</div>
              <div id="earlyWinReportText"></div>
            </div>
          </div>

          <!-- ë¯¸ë¦¬ë³´ê¸° ë¹„êµ -->
          <div class="preview-comparison" id="previewComparison" style="display: none;">
            <div class="comparison-title">ìœ íŠœë¸Œ ê²€ìƒ‰ ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸°</div>
            <div class="comparison-grid">
              <div class="comparison-item">
                <div class="comparison-label">ì¸ë„¤ì¼ A (ëŒ€ì¡°êµ°)</div>
                <div class="comparison-preview">
                  <img id="comparisonThumbnailA" src="" alt="ì¸ë„¤ì¼ A" />
                  <div class="youtube-overlay"></div>
                </div>
                <div class="comparison-stats">
                  <div class="stat-item-small">
                    <span class="stat-label-small">CTR</span>
                    <span class="stat-value-small" id="ctrA">-</span>
                  </div>
                  <div class="stat-item-small">
                    <span class="stat-label-small">ì‹œì²­ ì‹œê°„</span>
                    <span class="stat-value-small" id="watchTimeA">-</span>
                  </div>
                </div>
              </div>
              <div class="comparison-item">
                <div class="comparison-label">ì¸ë„¤ì¼ B (ì‹¤í—˜êµ°)</div>
                <div class="comparison-preview">
                  <img id="comparisonThumbnailB" src="" alt="ì¸ë„¤ì¼ B" />
                  <div class="youtube-overlay"></div>
                </div>
                <div class="comparison-stats">
                  <div class="stat-item-small">
                    <span class="stat-label-small">CTR</span>
                    <span class="stat-value-small" id="ctrB">-</span>
                  </div>
                  <div class="stat-item-small">
                    <span class="stat-label-small">ì‹œì²­ ì‹œê°„</span>
                    <span class="stat-value-small" id="watchTimeB">-</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì•Œë¦¼ -->
          <div class="test-result-alert" id="testResultAlert">
            <div class="test-result-title">âœ… A/B í…ŒìŠ¤íŠ¸ ì™„ë£Œ</div>
            <div class="test-result-text" id="testResultText"></div>
          </div>

          <!-- A/B í…ŒìŠ¤íŠ¸ ì‹œì‘ ë²„íŠ¼ -->
          <button class="btn-primary" type="button" id="btnStartABTest" style="background: #f59e0b; margin-top: 20px;">A/B í…ŒìŠ¤íŠ¸ ì‹œì‘í•˜ê¸°</button>
        </div>
      </div>

      <!-- ì—…ë¡œë“œ ì‹¤í–‰ -->
      <div class="action-buttons">
        <button class="btn-primary" type="button" id="btnScheduleUpload">ì˜ˆì•½ ì—…ë¡œë“œ ì„¤ì •í•˜ê¸°</button>
        <button class="btn-primary" type="button" id="btnUploadNow" style="background: #9333ea;">ì§€ê¸ˆ ë°”ë¡œ ì—…ë¡œë“œ</button>
      </div>
    </main>
  </div>

  <!-- ì—…ë¡œë“œ ì§„í–‰ ëª¨ë‹¬ -->
  <div class="upload-result-modal" id="uploadProgressModal">
    <div class="upload-result-content">
      <div class="upload-result-title">ğŸ“¤ ì—…ë¡œë“œ ì§„í–‰ ì¤‘...</div>
      <div class="upload-result-summary">
        <div id="uploadProgressText">ì¤€ë¹„ ì¤‘...</div>
        <div style="margin-top: 12px;">
          <div class="quota-progress-bar">
            <div class="quota-progress-fill" id="uploadProgressBar" style="width: 0%;"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ì—…ë¡œë“œ ê²°ê³¼ ë¦¬í¬íŠ¸ ëª¨ë‹¬ -->
  <div class="upload-result-modal" id="uploadResultModal">
    <div class="upload-result-content">
      <div class="upload-result-title">ğŸ“Š ì—…ë¡œë“œ ê²°ê³¼ ë¦¬í¬íŠ¸</div>
      <div class="upload-result-summary" id="uploadResultSummary">
        <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§‘ë‹ˆë‹¤ -->
      </div>
      <button class="btn-primary" type="button" onclick="document.getElementById('uploadResultModal').classList.remove('show');" style="width: 100%; margin-top: 16px;">í™•ì¸</button>
    </div>
  </div>

  <script src="https://apis.google.com/js/api.js"></script>
  <script>
    var selectedVideos = [];
    var availableVideos = [];
    var channelData = null;
    var goldenTime = null;
    var availableThumbnails = [];
    var selectedThumbnailA = null;
    var selectedThumbnailB = null;
    var abTestData = null;
    var abTestInterval = null;
    var earlyWinCheckInterval = null;
    var monitoringScheduleInterval = null;
    
    // ì¿¼í„° ê´€ë¦¬ ë°ì´í„°
    var channelQuotas = {}; // { channelId: { daily_limit: 3, current_count: 0, last_reset_date: '2026-01-13' } }
    var safeModeEnabled = false;

    // ì´ˆê¸°í™”
    (function() {
      loadChannelData();
      loadAvailableVideos();
      loadAvailableThumbnails();
      analyzeGoldenTime();
      renderVideoList();
      renderThumbnailSelectors();
      loadABTestData();
      setupEventListeners();
      checkLoginStatus();
      
      // ì¿¼í„° ì‹œìŠ¤í…œ ì´ˆê¸°í™”
      loadChannelQuotas();
      initializeChannelQuotaSystem();
      
      // MCN í†µí•© ë¦¬í¬íŠ¸ ë¡œë“œ
      loadMCNReport();
      
      // AI ì»¤ë®¤ë‹ˆí‹° ê´€ë¦¬ì: ëŒ“ê¸€ ë¡œë“œ
      loadComments();
      
      // AI í”¼ë“œë°± ì¸ì‚¬ì´íŠ¸ ë¡œë“œ
      loadFeedbackInsights();

      // ëŒ“ê¸€ í•„í„° ì´ë²¤íŠ¸
      document.querySelectorAll('.filter-btn').forEach(function(btn) {
        btn.addEventListener('click', function() {
          document.querySelectorAll('.filter-btn').forEach(function(b) {
            b.classList.remove('active');
          });
          this.classList.add('active');
          
          var filter = this.getAttribute('data-filter');
          filterComments(filter);
        });
      });
    })();

    // ëŒ“ê¸€ í•„í„°ë§
    function filterComments(filter) {
      var items = document.querySelectorAll('.comment-item');
      items.forEach(function(item) {
        var status = item.querySelector('.comment-status').textContent;
        var shouldShow = 
          filter === 'all' ||
          (filter === 'pending' && status === 'ìŠ¹ì¸ ëŒ€ê¸°') ||
          (filter === 'approved' && status === 'ìŠ¹ì¸ë¨') ||
          (filter === 'spam' && status === 'ìŠ¤íŒ¸');
        
        item.style.display = shouldShow ? 'block' : 'none';
      });
    }

    // ì±„ë„ ë°ì´í„° ë¡œë“œ
    function loadChannelData() {
      try {
        var channelDataRaw = localStorage.getItem('youtubeChannelData');
        if (channelDataRaw) {
          channelData = JSON.parse(channelDataRaw);
          renderChannelDashboard();
        } else {
          // ê¸°ë³¸ê°’ ì„¤ì •
          channelData = {
            name: 'HANRA STUDIO',
            avatar: 'H',
            subscribers: 0,
            recentViews: 0
          };
          renderChannelDashboard();
        }
      } catch (e) {
        console.error('ì±„ë„ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', e);
        channelData = {
          name: 'HANRA STUDIO',
          avatar: 'H',
          subscribers: 0,
          recentViews: 0
        };
        renderChannelDashboard();
      }
    }

    // ì±„ë„ ëŒ€ì‹œë³´ë“œ ë Œë”ë§
    function renderChannelDashboard() {
      document.getElementById('channelAvatar').textContent = channelData.avatar || 'H';
      document.getElementById('channelName').textContent = channelData.name || 'HANRA STUDIO';
      document.getElementById('subscriberCount').textContent = formatNumber(channelData.subscribers || 0);
      document.getElementById('recentViews').textContent = formatNumber(channelData.recentViews || 0);

      // ì—…ë¡œë“œ í˜„í™© ê³„ì‚°
      var archivedProjectsRaw = localStorage.getItem('archivedProjects');
      var projects = [];
      if (archivedProjectsRaw) {
        try {
          projects = JSON.parse(archivedProjectsRaw);
        } catch (e) {
          console.error('í”„ë¡œì íŠ¸ íŒŒì‹± ì‹¤íŒ¨:', e);
        }
      }

      var pending = 0;
      var scheduled = 0;
      var published = 0;

      projects.forEach(function(project) {
        if (project.status === 'draft' || !project.status) {
          pending++;
        } else if (project.status === 'scheduled') {
          scheduled++;
        } else if (project.status === 'published' || project.status === 'uploaded') {
          published++;
        }
      });

      document.getElementById('pendingCount').textContent = pending;
      document.getElementById('scheduledCount').textContent = scheduled;
      document.getElementById('publishedCount').textContent = published;
    }

    // ì‚¬ìš© ê°€ëŠ¥í•œ ì˜ìƒ ë¡œë“œ (ì‡¼ì¸  ë³€í™˜ ê²°ê³¼ í¬í•¨)
    function loadAvailableVideos() {
      try {
        var archivedProjectsRaw = localStorage.getItem('archivedProjects');
        var videos = [];
        
        // ì‘ì—… ë³´ê´€í•¨ì—ì„œ ì˜ìƒ ë¡œë“œ
        if (archivedProjectsRaw) {
          var projects = JSON.parse(archivedProjectsRaw);
          videos = projects
            .filter(function(project) {
              return project.status === 'draft' || !project.status;
            })
            .map(function(project) {
              return {
                id: project.id,
                title: project.title,
                thumbnailUrl: project.thumbnailUrl,
                completedDate: project.completedDate,
                videoData: project.videoData,
                titleData: project.titleData,
                thumbnailData: project.thumbnailData,
                shortsData: project.shortsData || null,
                type: 'video' // ì¼ë°˜ ì˜ìƒ
              };
            });
        }

        // ì‡¼ì¸  ë³€í™˜ ê²°ê³¼ ë¡œë“œ (step11ShortsData)
        try {
          var shortsDataRaw = localStorage.getItem('step11ShortsData');
          if (shortsDataRaw) {
            var shortsData = JSON.parse(shortsDataRaw);
            if (shortsData.video_url) {
              // ì‡¼ì¸  ë³€í™˜ ê²°ê³¼ë¥¼ ë³„ë„ í•­ëª©ìœ¼ë¡œ ì¶”ê°€
              var shortsVideo = {
                id: 'shorts_' + Date.now(),
                title: (shortsData.original_video_data && shortsData.original_video_data.title) || 'ì‡¼ì¸  ë³€í™˜ ì˜ìƒ',
                thumbnailUrl: shortsData.original_video_data && shortsData.original_video_data.thumbnailUrl || '',
                completedDate: new Date().toISOString(),
                videoData: shortsData.original_video_data,
                titleData: shortsData.original_video_data && shortsData.original_video_data.titleData || null,
                thumbnailData: shortsData.original_video_data && shortsData.original_video_data.thumbnailData || null,
                shortsData: shortsData,
                type: 'shorts' // ì‡¼ì¸  ë³€í™˜ ì˜ìƒ
              };
              videos.push(shortsVideo);
            }
          }
        } catch (e) {
          console.error('ì‡¼ì¸  ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', e);
        }

        availableVideos = videos;
      } catch (e) {
        console.error('ì˜ìƒ ë¡œë“œ ì‹¤íŒ¨:', e);
        availableVideos = [];
      }
    }

    // ì˜ìƒ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
    function renderVideoList() {
      var container = document.getElementById('videoList');
      if (!container) return;

      if (availableVideos.length === 0) {
        container.innerHTML = (
          '<div style="text-align: center; padding: 40px; color: #999;">' +
          'ì—…ë¡œë“œ ê°€ëŠ¥í•œ ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤.<br />' +
          '9. ìµœì¢… ì œì‘ ë‹¨ê³„ì—ì„œ ì™„ì„±ëœ ì˜ìƒì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.' +
          '</div>'
        );
        return;
      }

      container.innerHTML = availableVideos
        .map(function(video) {
          var isSelected = selectedVideos.includes(video.id);
          var isShorts = video.type === 'shorts';
          var beatDropInfo = '';
          
          // ë¹„íŠ¸ ë“œë¡­ íš¨ê³¼ ì •ë³´ í‘œì‹œ
          if (isShorts && video.shortsData && video.shortsData.beat_drop_effects) {
            var effects = video.shortsData.beat_drop_effects;
            if (effects.enabled) {
              beatDropInfo = '<div class="video-badge" style="display: inline-block; padding: 2px 6px; background: #fef3c7; color: #92400e; border-radius: 4px; font-size: 10px; font-weight: 600; margin-left: 6px;">âš¡ ë¹„íŠ¸ ë“œë¡­</div>';
            }
          }
          
          return (
            '<div class="video-item' +
            (isSelected ? ' selected' : '') +
            '" data-id="' +
            video.id +
            '">' +
            '<img src="' +
            (video.thumbnailUrl || '') +
            '" class="video-thumbnail" alt="' +
            escapeHtml(video.title) +
            '" />' +
            '<div class="video-info">' +
            '<div class="video-title">' +
            escapeHtml(video.title) +
            (isShorts ? ' <span style="color: #9333ea; font-size: 11px;">(ì‡¼ì¸ )</span>' : '') +
            beatDropInfo +
            '</div>' +
            '<div class="video-meta">' +
            formatDate(video.completedDate) +
            '</div>' +
            '</div>' +
            '<input type="checkbox" class="video-checkbox" ' +
            (isSelected ? 'checked' : '') +
            ' data-id="' +
            video.id +
            '" />' +
            '</div>'
          );
        })
        .join('');

      // ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      container.querySelectorAll('.video-checkbox').forEach(function(checkbox) {
        checkbox.addEventListener('change', function() {
          var videoId = this.getAttribute('data-id');
          if (this.checked) {
            if (!selectedVideos.includes(videoId)) {
              selectedVideos.push(videoId);
            }
          } else {
            selectedVideos = selectedVideos.filter(function(id) {
              return id !== videoId;
            });
          }
          updateVideoSelection();
          updateMetadataReview();
        });
      });

      // ë¹„ë””ì˜¤ ì•„ì´í…œ í´ë¦­ ì´ë²¤íŠ¸
      container.querySelectorAll('.video-item').forEach(function(item) {
        item.addEventListener('click', function(e) {
          if (e.target.type !== 'checkbox') {
            var checkbox = this.querySelector('.video-checkbox');
            checkbox.checked = !checkbox.checked;
            checkbox.dispatchEvent(new Event('change'));
          }
        });
      });
    }

    // ë¹„ë””ì˜¤ ì„ íƒ ì—…ë°ì´íŠ¸
    function updateVideoSelection() {
      var items = document.querySelectorAll('.video-item');
      items.forEach(function(item) {
        var videoId = item.getAttribute('data-id');
        if (selectedVideos.includes(videoId)) {
          item.classList.add('selected');
        } else {
          item.classList.remove('selected');
        }
      });
      // ì˜ˆì¸¡ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
      predictViews();
      // ì¸ë„¤ì¼ ëª©ë¡ ì—…ë°ì´íŠ¸
      loadAvailableThumbnails();
    }

    // ë©”íƒ€ë°ì´í„° í™•ì¸ ì—…ë°ì´íŠ¸
    function updateMetadataReview() {
      if (selectedVideos.length === 0) {
        document.getElementById('reviewTitle').textContent = '-';
        document.getElementById('reviewDescription').textContent = '-';
        document.getElementById('reviewTags').textContent = '-';
        return;
      }

      var firstVideo = availableVideos.find(function(v) {
        return v.id === selectedVideos[0];
      });

      if (firstVideo && firstVideo.titleData) {
        var titleData = firstVideo.titleData;
        document.getElementById('reviewTitle').textContent = titleData.selectedTitle || titleData.title || '-';
        document.getElementById('reviewDescription').textContent = titleData.description || '-';
        document.getElementById('reviewTags').textContent = titleData.hashtags || titleData.tags || '-';
      } else {
        document.getElementById('reviewTitle').textContent = firstVideo.title || '-';
        document.getElementById('reviewDescription').textContent = '-';
        document.getElementById('reviewTags').textContent = '-';
      }
    }

    // ê³¨ë“  íƒ€ì„ ë¶„ì„
    function analyzeGoldenTime() {
      // AIê°€ ì±„ë„ì˜ ê³¼ê±° ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬ ê³¨ë“  íƒ€ì„ ì¶”ì²œ
      // ì‹¤ì œë¡œëŠ” YouTube Analytics APIë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜, ê³¼ê±° ì—…ë¡œë“œ ë°ì´í„°ë¥¼ ë¶„ì„
      // ì—¬ê¸°ì„œëŠ” ë”ë¯¸ ë°ì´í„°ë¡œ ì‹œë®¬ë ˆì´ì…˜

      setTimeout(function() {
        // ì˜ˆ: ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ ë‚´ì¼ ì˜¤í›„ 6ì‹œ ì¶”ì²œ
        var tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        tomorrow.setHours(18, 0, 0, 0);

        goldenTime = tomorrow;
        var timeStr = formatDateTime(goldenTime);
        document.getElementById('goldenTime').textContent = timeStr;
      }, 1000);
    }

    // ê³¨ë“  íƒ€ì„ ì ìš©
    function applyGoldenTime() {
      if (!goldenTime) return;
      var datetimeInput = document.getElementById('scheduleDateTime');
      var isoString = goldenTime.toISOString().slice(0, 16);
      datetimeInput.value = isoString;
    }

    // AI ì¡°íšŒìˆ˜ ì˜ˆì¸¡ (ë¹„íŠ¸ ë“œë¡­ íš¨ê³¼ ë°˜ì˜)
    function predictViews() {
      if (selectedVideos.length === 0) {
        document.getElementById('predictionValue').textContent = '-';
        renderPredictionChart([]);
        return;
      }

      var firstVideo = availableVideos.find(function(v) {
        return v.id === selectedVideos[0];
      });

      if (!firstVideo) {
        document.getElementById('predictionValue').textContent = '-';
        renderPredictionChart([]);
        return;
      }

      // AIê°€ ì£¼ì œì™€ ì¸ë„¤ì¼ì„ ë¶„ì„í•˜ì—¬ ì˜ˆìƒ ì¡°íšŒìˆ˜ ê³„ì‚°
      // ë¹„íŠ¸ ë“œë¡­ íš¨ê³¼ê°€ ìˆëŠ” ê²½ìš° ì¡°íšŒìˆ˜ ë³´ì • ì ìš©
      var baseViews = 1000 + Math.random() * 9000; // 1000~10000
      
      // ë¹„íŠ¸ ë“œë¡­ íš¨ê³¼ ë³´ì • (ì‡¼ì¸  ë³€í™˜ ì˜ìƒì¸ ê²½ìš°)
      var beatDropMultiplier = 1.0;
      if (firstVideo.type === 'shorts' && firstVideo.shortsData && firstVideo.shortsData.beat_drop_effects) {
        var effects = firstVideo.shortsData.beat_drop_effects;
        if (effects.enabled) {
          // ë¹„íŠ¸ ë“œë¡­ íš¨ê³¼ê°€ ìˆìœ¼ë©´ ì¡°íšŒìˆ˜ ì¦ê°€ (ê°•ë„ì— ë”°ë¼)
          var intensityBonus = (effects.intensity || 3) * 0.1; // ê°•ë„ë‹¹ 10% ì¦ê°€
          var moodBonus = 0;
          
          // ë¶„ìœ„ê¸°ë³„ ë³´ë„ˆìŠ¤
          if (effects.mood) {
            var moodBonuses = {
              'ë¹„ì¥í•œ': 0.15,
              'ê°•ë ¬í•œ': 0.20,
              'ìœ ì¾Œí•œ': 0.18,
              'ê²½ì¾Œí•œ': 0.16,
              'ê°ì„±ì ì¸': 0.12,
              'ë”°ëœ»í•œ': 0.10
            };
            moodBonus = moodBonuses[effects.mood] || 0.1;
          }
          
          beatDropMultiplier = 1.0 + intensityBonus + moodBonus;
        }
      }
      
      baseViews = Math.floor(baseViews * beatDropMultiplier);
      
      var minViews = Math.floor(baseViews * 0.7);
      var maxViews = Math.floor(baseViews * 1.5);
      var avgViews = Math.floor((minViews + maxViews) / 2);

      var predictionText = formatNumber(avgViews) + 'íšŒ (ì˜ˆìƒ ë²”ìœ„: ' + formatNumber(minViews) + '~' + formatNumber(maxViews) + 'íšŒ)';
      
      // ë¹„íŠ¸ ë“œë¡­ íš¨ê³¼ê°€ ìˆìœ¼ë©´ í‘œì‹œ
      if (beatDropMultiplier > 1.0) {
        predictionText += ' âš¡ ë¹„íŠ¸ ë“œë¡­ íš¨ê³¼ ë°˜ì˜';
      }
      
      document.getElementById('predictionValue').textContent = predictionText;

      // ì°¨íŠ¸ ë°ì´í„° ìƒì„± (7ì¼ ì˜ˆì¸¡)
      var chartData = [];
      for (var i = 0; i < 7; i++) {
        var dayViews = Math.floor(avgViews * (0.3 + Math.random() * 0.7));
        chartData.push({
          day: (i + 1) + 'ì¼ì°¨',
          views: dayViews
        });
      }

      renderPredictionChart(chartData);
    }

    // ì˜ˆì¸¡ ì°¨íŠ¸ ë Œë”ë§
    function renderPredictionChart(data) {
      var container = document.getElementById('predictionChart');
      if (!container) return;

      if (data.length === 0) {
        container.innerHTML = '<div style="text-align: center; color: #999; padding: 40px;">ì˜ìƒì„ ì„ íƒí•˜ë©´ ì˜ˆì¸¡ ì°¨íŠ¸ê°€ í‘œì‹œë©ë‹ˆë‹¤.</div>';
        return;
      }

      var maxViews = Math.max.apply(null, data.map(function(d) {
        return d.views;
      }));

      container.innerHTML = data
        .map(function(item) {
          var height = (item.views / maxViews) * 100;
          return (
            '<div class="chart-bar" style="height: ' +
            height +
            '%;" title="' +
            item.day +
            ': ' +
            formatNumber(item.views) +
            'íšŒ">' +
            '<div class="chart-label">' +
            item.day +
            '</div>' +
            '</div>'
          );
        })
        .join('');
    }

    // ì˜ˆì•½ ì—…ë¡œë“œ ì„¤ì •
    function scheduleUpload() {
      if (selectedVideos.length === 0) {
        alert('ì—…ë¡œë“œí•  ì˜ìƒì„ ì„ íƒí•˜ì„¸ìš”.');
        return;
      }

      var scheduleDateTime = document.getElementById('scheduleDateTime').value;
      if (!scheduleDateTime) {
        alert('ì—…ë¡œë“œ ì˜ˆì•½ ì‹œê°„ì„ ì„ íƒí•˜ì„¸ìš”.');
        return;
      }

      var platforms = [];
      if (document.getElementById('platformYoutube').checked) platforms.push('youtube');
      if (document.getElementById('platformTiktok').checked) platforms.push('tiktok');
      if (document.getElementById('platformInstagram').checked) platforms.push('instagram');

      if (platforms.length === 0) {
        alert('ìµœì†Œ í•˜ë‚˜ì˜ í”Œë«í¼ì„ ì„ íƒí•˜ì„¸ìš”.');
        return;
      }

      // YouTube Data API í˜¸ì¶œ ì¤€ë¹„
      var uploadData = {
        videos: selectedVideos.map(function(videoId) {
          var video = availableVideos.find(function(v) {
            return v.id === videoId;
          });
          var uploadItem = {
            id: video.id,
            title: video.title,
            videoData: video.videoData,
            titleData: video.titleData,
            thumbnailData: video.thumbnailData,
            type: video.type || 'video'
          };
          
          // ì‡¼ì¸  ë³€í™˜ ì˜ìƒì¸ ê²½ìš° ë¹„íŠ¸ ë“œë¡­ íš¨ê³¼ ì •ë³´ í¬í•¨
          if (video.type === 'shorts' && video.shortsData) {
            uploadItem.shortsData = video.shortsData;
            uploadItem.beatDropEffects = video.shortsData.beat_drop_effects;
            uploadItem.bgmHotspot = video.shortsData.bgm_hotspot;
            uploadItem.dynamicCaptions = video.shortsData.dynamic_captions;
          }
          
          return uploadItem;
        }),
        scheduleDateTime: scheduleDateTime,
        platforms: platforms
      };

      // ì‹¤ì œ ì—…ë¡œë“œëŠ” YouTube Data APIë¥¼ ì‚¬ìš©
      uploadToYouTube(uploadData);
    }

    // ë°°ì¹˜ ì—…ë¡œë“œ í”„ë¡œì„¸ìŠ¤ (ì¿¼í„° ê²€ì¦ í¬í•¨, Promise.allSettled + 3ì´ˆ ë”œë ˆì´)
    async function batchUploadProcess(uploadData) {
      // ì¿¼í„° ê²€ì¦ ë¡œì§
      var quotaCheckResult = await checkChannelQuotas(uploadData.platforms);
      
      if (quotaCheckResult.skippedChannels.length > 0) {
        // ì¿¼í„° ì´ˆê³¼ ì±„ë„ì´ ìˆëŠ” ê²½ìš°
        var skippedNames = quotaCheckResult.skippedChannels.map(function(c) { return c.name; }).join(', ');
        var message = 'ì¼ë¶€ ì±„ë„ì˜ ì¿¼í„°ê°€ ì´ˆê³¼ë˜ì–´ ì—…ë¡œë“œê°€ ì œí•œë©ë‹ˆë‹¤.\n\n';
        message += 'âœ… ì—…ë¡œë“œ ê°€ëŠ¥: ' + quotaCheckResult.availableChannels.length + 'ê°œ ì±„ë„\n';
        message += 'âš ï¸ ì¿¼í„° ì´ˆê³¼: ' + skippedNames + '\n\n';
        message += 'ê³„ì† ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ì¿¼í„° ì´ˆê³¼ ì±„ë„ì€ ìë™ìœ¼ë¡œ ìŠ¤í‚µë©ë‹ˆë‹¤)';
        
        if (!confirm(message)) {
          return;
        }
      }

      // ì—…ë¡œë“œ ì‹¤í–‰ (ì¿¼í„° ê²€ì¦ í†µê³¼í•œ ì±„ë„ë§Œ)
      var uploadResults = {
        success: [],
        skipped: [],
        failed: []
      };

      // ì§„í–‰ ëª¨ë‹¬ í‘œì‹œ
      showUploadProgressModal(uploadData.videos.length, quotaCheckResult.availableChannels.length);

      // ì¸ì½”ë”© ìºì‹œ (ì˜ìƒë³„ 1íšŒë§Œ ì¸ì½”ë”©)
      var encodedCache = {};

      async function getEncodedVideo(video) {
        if (encodedCache[video.id]) return encodedCache[video.id];
        updateUploadProgress(0, quotaCheckResult.availableChannels.length, 'ì˜ìƒ ì¸ì½”ë”© ì¤‘...');
        var optimized = await optimizeVideoForStreaming(video);
        encodedCache[video.id] = optimized;
        return optimized;
      }

      async function uploadChannelWithRetry(channel, attempt) {
        var currentAttempt = attempt || 1;
        var maxAttempts = 2;

        // ëœë¤ ë”œë ˆì´ (3~8ì´ˆ)
        var delayMs = 3000 + Math.floor(Math.random() * 5000);
        await delay(delayMs);

        // ì¿¼í„° ì¬ê²€ì¦ (ì—…ë¡œë“œ ì§ì „)
        var currentQuota = getChannelQuota(channel.id);
        if (currentQuota.current_count >= currentQuota.daily_limit) {
          return { status: 'skipped', channel: channel.name, reason: 'ì¿¼í„° ì´ˆê³¼' };
        }

        // ì¸ì½”ë”© (í•„ìš” ì‹œ)
        var optimizedVideos = [];
        for (var v = 0; v < uploadData.videos.length; v++) {
          var video = uploadData.videos[v];
          var optimizedVideo = await getEncodedVideo(video);
          optimizedVideos.push(optimizedVideo);
        }

        updateUploadProgress(0, quotaCheckResult.availableChannels.length, channel.name + ' ì—…ë¡œë“œ ì¤‘...');

        try {
          var uploadResponse = await fetch((window.__API_BASE__ || 'http://localhost:4000') + '/api/youtube/upload', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              channel_id: channel.id,
              videos: optimizedVideos,
              scheduleDateTime: uploadData.scheduleDateTime
            })
          });

          if (!uploadResponse.ok) {
            var errorData = await uploadResponse.json().catch(function() { return {}; });

            // í† í° ë§Œë£Œ ë˜ëŠ” ì¸ì¦ ì˜¤ë¥˜ ì²˜ë¦¬
            if (uploadResponse.status === 401 || uploadResponse.status === 403 ||
                (errorData.error && (errorData.error.includes('token') || errorData.error.includes('expired') ||
                errorData.error.includes('unauthorized') || errorData.error.includes('invalid_grant') ||
                errorData.error.includes('invalid_token') || errorData.error.includes('Token has been expired')))) {
              return {
                status: 'skipped',
                channel: channel.name,
                reason: 'í† í° ì˜¤ë¥˜ (ë§Œë£Œ ë˜ëŠ” ì¸ì¦ ì‹¤íŒ¨)',
                error: errorData.error || 'ì¸ì¦ í† í°ì´ ë§Œë£Œë˜ì—ˆê±°ë‚˜ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'
              };
            }
            throw new Error(errorData.error || 'ì—…ë¡œë“œ ì‹¤íŒ¨');
          }

          var uploadResult = await uploadResponse.json();
          incrementChannelQuota(channel.id);

          return {
            status: 'success',
            channel: channel.name,
            videoCount: optimizedVideos.length,
            videoIds: uploadResult.video_ids || []
          };
        } catch (uploadError) {
          if (currentAttempt < maxAttempts) {
            return uploadChannelWithRetry(channel, currentAttempt + 1);
          }
          return { status: 'failed', channel: channel.name, error: uploadError.message || 'ì—…ë¡œë“œ ì‹¤íŒ¨' };
        }
      }

      var queue = new UploadQueue(3, {
        onProgress: function(current, total) {
          updateUploadProgress(current, total, 'ì±„ë„ ì—…ë¡œë“œ ì§„í–‰');
        }
      });

      quotaCheckResult.availableChannels.forEach(function(channel) {
        queue.enqueue(function() {
          return uploadChannelWithRetry(channel);
        });
      });

      var queueResults = await queue.run();

      queueResults.forEach(function(result) {
        if (result.status === 'success') {
          uploadResults.success.push(result);
        } else if (result.status === 'skipped') {
          uploadResults.skipped.push(result);
        } else if (result.status === 'failed') {
          uploadResults.failed.push(result);
          notifyUploadFailure({ name: result.channel }, result.error);
        }
      });

      // ì¿¼í„° ì´ˆê³¼ë¡œ ìŠ¤í‚µëœ ì±„ë„ ì¶”ê°€
      quotaCheckResult.skippedChannels.forEach(function(channel) {
        uploadResults.skipped.push({
          channel: channel.name,
          reason: 'ì¿¼í„° ì´ˆê³¼'
        });
      });

      // ì§„í–‰ ëª¨ë‹¬ ìˆ¨ê¸°ê¸°
      hideUploadProgressModal();

      // ê²°ê³¼ ë¦¬í¬íŠ¸ í‘œì‹œ
      showUploadResultReport(uploadResults);

      // ì¿¼í„° ìƒíƒœ ì—…ë°ì´íŠ¸
      updateChannelQuotaDisplays();

      return uploadResults;
    }

    // YouTube Data API ì—…ë¡œë“œ (ì¿¼í„° ê²€ì¦ í¬í•¨) - ë ˆê±°ì‹œ í˜¸í™˜
    async function uploadToYouTube(uploadData) {
      await batchUploadProcess(uploadData);
    }

    // ì§€ê¸ˆ ë°”ë¡œ ì—…ë¡œë“œ
    function uploadNow() {
      if (selectedVideos.length === 0) {
        alert('ì—…ë¡œë“œí•  ì˜ìƒì„ ì„ íƒí•˜ì„¸ìš”.');
        return;
      }

      var platforms = [];
      if (document.getElementById('platformYoutube').checked) platforms.push('youtube');
      if (document.getElementById('platformTiktok').checked) platforms.push('tiktok');
      if (document.getElementById('platformInstagram').checked) platforms.push('instagram');

      if (platforms.length === 0) {
        alert('ìµœì†Œ í•˜ë‚˜ì˜ í”Œë«í¼ì„ ì„ íƒí•˜ì„¸ìš”.');
        return;
      }

      var uploadData = {
        videos: selectedVideos.map(function(videoId) {
          var video = availableVideos.find(function(v) {
            return v.id === videoId;
          });
          return {
            id: video.id,
            title: video.title,
            videoData: video.videoData,
            titleData: video.titleData,
            thumbnailData: video.thumbnailData
          };
        }),
        scheduleDateTime: null, // ì¦‰ì‹œ ì—…ë¡œë“œ
        platforms: platforms
      };

      uploadToYouTube(uploadData);
    }

    // ì‚¬ìš© ê°€ëŠ¥í•œ ì¸ë„¤ì¼ ë¡œë“œ
    function loadAvailableThumbnails() {
      try {
        // 8ë‹¨ê³„(ì¸ë„¤ì¼ ìƒì„±ê¸°)ì—ì„œ ìƒì„±ëœ ì¸ë„¤ì¼ë“¤ ê°€ì ¸ì˜¤ê¸°
        var archivedProjectsRaw = localStorage.getItem('archivedProjects');
        if (archivedProjectsRaw) {
          var projects = JSON.parse(archivedProjectsRaw);
          availableThumbnails = [];
          
          projects.forEach(function(project) {
            if (project.thumbnailData && project.thumbnailData.thumbnailImageUrl) {
              availableThumbnails.push({
                id: project.id,
                url: project.thumbnailData.thumbnailImageUrl,
                title: project.title
              });
            }
          });
        }

        // í˜„ì¬ ì„ íƒëœ ì˜ìƒì˜ ì¸ë„¤ì¼ë„ ì¶”ê°€
        if (selectedVideos.length > 0) {
          var firstVideo = availableVideos.find(function(v) {
            return v.id === selectedVideos[0];
          });
          if (firstVideo && firstVideo.thumbnailData && firstVideo.thumbnailData.thumbnailImageUrl) {
            var exists = availableThumbnails.find(function(t) {
              return t.url === firstVideo.thumbnailData.thumbnailImageUrl;
            });
            if (!exists) {
              availableThumbnails.push({
                id: firstVideo.id + '_current',
                url: firstVideo.thumbnailData.thumbnailImageUrl,
                title: firstVideo.title
              });
            }
          }
        }
      } catch (e) {
        console.error('ì¸ë„¤ì¼ ë¡œë“œ ì‹¤íŒ¨:', e);
        availableThumbnails = [];
      }
    }

    // ì¸ë„¤ì¼ ì„ íƒ UI ë Œë”ë§
    function renderThumbnailSelectors() {
      // ì¸ë„¤ì¼ ì„ íƒ ëª¨ë‹¬ì€ ë‚˜ì¤‘ì— êµ¬í˜„
      // ì—¬ê¸°ì„œëŠ” ê¸°ë³¸ UIë§Œ ë Œë”ë§
    }

    // ì¸ë„¤ì¼ ì„ íƒ
    function selectThumbnail(type) {
      if (availableThumbnails.length === 0) {
        alert('ì‚¬ìš© ê°€ëŠ¥í•œ ì¸ë„¤ì¼ì´ ì—†ìŠµë‹ˆë‹¤.\n\n8ë‹¨ê³„(ì¸ë„¤ì¼ ìƒì„±ê¸°)ì—ì„œ ì¸ë„¤ì¼ì„ ìƒì„±í•˜ê±°ë‚˜, ì‘ì—… ë³´ê´€í•¨ì— ì €ì¥ëœ í”„ë¡œì íŠ¸ì˜ ì¸ë„¤ì¼ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        return;
      }

      // ì¸ë„¤ì¼ ì„ íƒ ëª¨ë‹¬ ìƒì„±
      var modal = document.createElement('div');
      modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 1000; display: flex; align-items: center; justify-content: center;';
      
      var modalContent = document.createElement('div');
      modalContent.style.cssText = 'background: #fff; border-radius: 12px; padding: 24px; max-width: 600px; max-height: 80vh; overflow-y: auto;';
      
      var modalTitle = document.createElement('div');
      modalTitle.style.cssText = 'font-size: 18px; font-weight: 700; color: #2d3748; margin-bottom: 16px;';
      modalTitle.textContent = 'ì¸ë„¤ì¼ ' + type + ' ì„ íƒ';
      
      var thumbnailGrid = document.createElement('div');
      thumbnailGrid.style.cssText = 'display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 16px;';
      
      availableThumbnails.forEach(function(thumbnail, index) {
        var thumbnailCard = document.createElement('div');
        thumbnailCard.style.cssText = 'border: 2px solid #e2e8f0; border-radius: 8px; overflow: hidden; cursor: pointer; transition: all 0.2s;';
        thumbnailCard.onmouseover = function() { this.style.borderColor = '#9333ea'; };
        thumbnailCard.onmouseout = function() { this.style.borderColor = '#e2e8f0'; };
        thumbnailCard.onclick = function() {
          if (type === 'A') {
            selectedThumbnailA = thumbnail;
            updateThumbnailPreview('A', thumbnail.url);
          } else {
            selectedThumbnailB = thumbnail;
            updateThumbnailPreview('B', thumbnail.url);
          }
          updateComparisonPreview();
          document.body.removeChild(modal);
        };
        
        var img = document.createElement('img');
        img.src = thumbnail.url;
        img.style.cssText = 'width: 100%; aspect-ratio: 16/9; object-fit: cover;';
        
        var label = document.createElement('div');
        label.style.cssText = 'padding: 8px; font-size: 12px; color: #666; text-align: center;';
        label.textContent = thumbnail.title.length > 30 ? thumbnail.title.substring(0, 30) + '...' : thumbnail.title;
        
        thumbnailCard.appendChild(img);
        thumbnailCard.appendChild(label);
        thumbnailGrid.appendChild(thumbnailCard);
      });
      
      var closeBtn = document.createElement('button');
      closeBtn.style.cssText = 'width: 100%; padding: 10px; background: #e2e8f0; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer;';
      closeBtn.textContent = 'ì·¨ì†Œ';
      closeBtn.onclick = function() {
        document.body.removeChild(modal);
      };
      
      modalContent.appendChild(modalTitle);
      modalContent.appendChild(thumbnailGrid);
      modalContent.appendChild(closeBtn);
      modal.appendChild(modalContent);
      document.body.appendChild(modal);
    }

    // ì¸ë„¤ì¼ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
    function updateThumbnailPreview(type, url) {
      var previewBox = document.getElementById('thumbnail' + type + 'Preview');
      if (!previewBox) return;

      previewBox.innerHTML = '<img src="' + url + '" alt="ì¸ë„¤ì¼ ' + type + '" />';
      
      var card = document.getElementById('thumbnail' + type + 'Card');
      if (card) {
        card.classList.add('selected');
      }
    }

    // ë¹„êµ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
    function updateComparisonPreview() {
      if (!selectedThumbnailA || !selectedThumbnailB) {
        document.getElementById('previewComparison').style.display = 'none';
        return;
      }

      document.getElementById('previewComparison').style.display = 'block';
      document.getElementById('comparisonThumbnailA').src = selectedThumbnailA.url;
      document.getElementById('comparisonThumbnailB').src = selectedThumbnailB.url;
    }

    // A/B í…ŒìŠ¤íŠ¸ ë°ì´í„° ë¡œë“œ
    function loadABTestData() {
      try {
        var abTestDataRaw = localStorage.getItem('abTestData');
        if (abTestDataRaw) {
          abTestData = JSON.parse(abTestDataRaw);
          
          // ì§„í–‰ ì¤‘ì¸ í…ŒìŠ¤íŠ¸ê°€ ìˆìœ¼ë©´ UI ì—…ë°ì´íŠ¸
          if (abTestData && (abTestData.status === 'running' || abTestData.status === 'early_completed')) {
            selectedThumbnailA = abTestData.thumbnailA;
            selectedThumbnailB = abTestData.thumbnailB;
            updateThumbnailPreview('A', abTestData.thumbnailA.url);
            updateThumbnailPreview('B', abTestData.thumbnailB.url);
            updateComparisonPreview();
            
            // ì¡°ê¸° í™•ì • ì„¤ì • UI ë³µì›
            if (abTestData.earlyWin && abTestData.earlyWin.enabled) {
              document.getElementById('enableEarlyWin').checked = true;
              document.getElementById('earlyWinSettings').style.display = 'block';
              if (abTestData.earlyWin.threshold) {
                document.getElementById('earlyWinThreshold').value = abTestData.earlyWin.threshold;
              }
              if (abTestData.earlyWin.minImpressions) {
                document.getElementById('earlyWinMinImpressions').value = abTestData.earlyWin.minImpressions;
              }
            }
            
            // ì¡°ê¸° í™•ì •ëœ ê²½ìš° ë°°ì§€ ë° ë¦¬í¬íŠ¸ í‘œì‹œ
            if (abTestData.status === 'early_completed' && abTestData.results) {
              var results = abTestData.results;
              var winner = abTestData.winner;
              var ctrDiff = Math.abs(results.ctrB - results.ctrA);
              
              document.getElementById('earlyWinBadge').style.display = 'inline-flex';
              document.getElementById('earlyWinReport').style.display = 'block';
              
              // ë¦¬í¬íŠ¸ í…ìŠ¤íŠ¸ ìƒì„±
              var reportText = 'í…ŒìŠ¤íŠ¸ê°€ ì¡°ê¸° í™•ì •ë˜ì–´ ì¸ë„¤ì¼ ' + winner + 
                              'ì´(ê°€) ìë™ìœ¼ë¡œ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.\n\n' +
                              'ğŸ“Š ì„±ê³¼ ìš”ì•½:\n' +
                              'â€¢ ì¸ë„¤ì¼ A CTR: ' + results.ctrA.toFixed(2) + '%\n' +
                              'â€¢ ì¸ë„¤ì¼ B CTR: ' + results.ctrB.toFixed(2) + '%\n' +
                              'â€¢ ì´ ë…¸ì¶œìˆ˜: ' + (results.totalImpressions || 0).toLocaleString() + 'íšŒ';
              
              document.getElementById('earlyWinReportText').textContent = reportText;
              
              // í†µê³„ ì—…ë°ì´íŠ¸
              document.getElementById('ctrA').textContent = results.ctrA.toFixed(2) + '%';
              document.getElementById('ctrB').textContent = results.ctrB.toFixed(2) + '%';
              
              // ê²°ê³¼ ì•Œë¦¼
              var resultText = 'âš¡ AI ì¡°ê¸° í™•ì •: ì¸ë„¤ì¼ ' + winner + 'ê°€ CTR ' + ctrDiff.toFixed(2) + '% ë” ë†’ì•„ ì¦‰ì‹œ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.';
              document.getElementById('testResultText').textContent = resultText;
              document.getElementById('testResultAlert').classList.add('show');
            }
            
            if (abTestData.status === 'running') {
              startABTestProgress();
              
              // ì¡°ê¸° í™•ì •ì´ í™œì„±í™”ëœ ê²½ìš° ëª¨ë‹ˆí„°ë§ ì¬ê°œ
              if (abTestData.earlyWin && abTestData.earlyWin.enabled) {
                startIntelligentMonitoring();
              }
            }
          }
        }
      } catch (e) {
        console.error('A/B í…ŒìŠ¤íŠ¸ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', e);
      }
    }

    // A/B í…ŒìŠ¤íŠ¸ ì‹œì‘
    function startABTest() {
      if (!selectedThumbnailA || !selectedThumbnailB) {
        alert('ì¸ë„¤ì¼ Aì™€ Bë¥¼ ëª¨ë‘ ì„ íƒí•˜ì„¸ìš”.');
        return;
      }

      if (selectedVideos.length === 0) {
        alert('ì—…ë¡œë“œí•  ì˜ìƒì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.');
        return;
      }

      var testDuration = parseInt(document.getElementById('testDuration').value);
      var useCTR = document.getElementById('metricCTR').checked;
      var useWatchTime = document.getElementById('metricWatchTime').checked;

      if (!useCTR && !useWatchTime) {
        alert('ìµœì†Œ í•˜ë‚˜ì˜ í…ŒìŠ¤íŠ¸ ì§€í‘œë¥¼ ì„ íƒí•˜ì„¸ìš”.');
        return;
      }

      // AI ì¡°ê¸° í™•ì • ì„¤ì •
      var enableEarlyWin = document.getElementById('enableEarlyWin').checked;
      var earlyWinThreshold = enableEarlyWin ? parseFloat(document.getElementById('earlyWinThreshold').value) : null;
      var earlyWinMinImpressions = enableEarlyWin ? parseInt(document.getElementById('earlyWinMinImpressions').value) : null;

      // ì„ íƒëœ ì˜ìƒì˜ ë¹„íŠ¸ ë“œë¡­ íš¨ê³¼ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
      var selectedVideo = availableVideos.find(function(v) {
        return v.id === selectedVideos[0];
      });
      var beatDropEffects = null;
      if (selectedVideo && selectedVideo.type === 'shorts' && selectedVideo.shortsData && selectedVideo.shortsData.beat_drop_effects) {
        beatDropEffects = selectedVideo.shortsData.beat_drop_effects;
      }

      var testData = {
        videoId: selectedVideos[0],
        thumbnailA: selectedThumbnailA,
        thumbnailB: selectedThumbnailB,
        duration: testDuration, // ì‹œê°„ ë‹¨ìœ„
        metrics: {
          ctr: useCTR,
          watchTime: useWatchTime
        },
        startTime: new Date().toISOString(),
        status: 'running',
        earlyWin: {
          enabled: enableEarlyWin,
          threshold: earlyWinThreshold,
          minImpressions: earlyWinMinImpressions
        },
        beatDropEffects: beatDropEffects // ë¹„íŠ¸ ë“œë¡­ íš¨ê³¼ ì •ë³´ í¬í•¨
      };

      abTestData = testData;
      localStorage.setItem('abTestData', JSON.stringify(testData));

      // í…ŒìŠ¤íŠ¸ ì§„í–‰ë¥  ì„¹ì…˜ í‘œì‹œ
      document.getElementById('testProgressSection').style.display = 'block';
      startABTestProgress();

      // AI ì¡°ê¸° í™•ì •ì´ í™œì„±í™”ëœ ê²½ìš° ëª¨ë‹ˆí„°ë§ ì‹œì‘
      if (enableEarlyWin) {
        startIntelligentMonitoring();
      }

      alert('A/B í…ŒìŠ¤íŠ¸ê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.\n\ní…ŒìŠ¤íŠ¸ ê¸°ê°„: ' + testDuration + 'ì‹œê°„\ní…ŒìŠ¤íŠ¸ ì§€í‘œ: ' + (useCTR ? 'CTR' : '') + (useWatchTime ? (useCTR ? ', ì‹œì²­ ì‹œê°„' : 'ì‹œì²­ ì‹œê°„') : '') + (enableEarlyWin ? '\nAI ì¡°ê¸° í™•ì •: í™œì„±í™”' : ''));
    }

    // A/B í…ŒìŠ¤íŠ¸ ì§„í–‰ë¥  ì‹œì‘
    function startABTestProgress() {
      if (!abTestData || abTestData.status !== 'running') return;

      var startTime = new Date(abTestData.startTime);
      var duration = abTestData.duration * 60 * 60 * 1000; // ë°€ë¦¬ì´ˆë¡œ ë³€í™˜
      var endTime = new Date(startTime.getTime() + duration);

      function updateProgress() {
        // ì¡°ê¸° í™•ì •ëœ ê²½ìš° ì§„í–‰ë¥  ì—…ë°ì´íŠ¸ ì¤‘ë‹¨
        if (abTestData.status === 'early_completed') {
          return;
        }

        var now = new Date();
        var elapsed = now - startTime;
        var progress = Math.min((elapsed / duration) * 100, 100);

        document.getElementById('progressBar').style.width = progress + '%';
        document.getElementById('progressValue').textContent = Math.floor(progress) + '%';

        if (progress >= 100 && abTestData.status === 'running') {
          // í…ŒìŠ¤íŠ¸ ì™„ë£Œ - ê²°ê³¼ ë¶„ì„
          analyzeABTestResults();
          clearInterval(abTestInterval);
        }
      }

      updateProgress();
      abTestInterval = setInterval(updateProgress, 1000); // 1ì´ˆë§ˆë‹¤ ì—…ë°ì´íŠ¸
    }

    // ì§€ëŠ¥í˜• ìŠ¤ì¼€ì¤„ëŸ¬: ì—…ë¡œë“œ ì´ˆë°˜ 6ì‹œê°„ ì§‘ì¤‘ ëª¨ë‹ˆí„°ë§
    function startIntelligentMonitoring() {
      if (!abTestData || !abTestData.earlyWin || !abTestData.earlyWin.enabled) return;

      var startTime = new Date(abTestData.startTime);
      var intensivePeriod = 6 * 60 * 60 * 1000; // 6ì‹œê°„ (ë°€ë¦¬ì´ˆ)
      var endIntensiveTime = new Date(startTime.getTime() + intensivePeriod);

      // ì´ˆë°˜ 6ì‹œê°„: 1ì‹œê°„ë§ˆë‹¤ ì²´í¬
      var checkInterval = 60 * 60 * 1000; // 1ì‹œê°„

      function scheduleCheck() {
        var now = new Date();
        
        // ì´ˆë°˜ 6ì‹œê°„ ë™ì•ˆë§Œ ì§‘ì¤‘ ëª¨ë‹ˆí„°ë§
        if (now < endIntensiveTime) {
          // 1ì‹œê°„ë§ˆë‹¤ checkEarlyWin ì‹¤í–‰
          earlyWinCheckInterval = setInterval(function() {
            checkEarlyWin();
          }, checkInterval);

          // ì¦‰ì‹œ ì²« ë²ˆì§¸ ì²´í¬ ì‹¤í–‰
          setTimeout(function() {
            checkEarlyWin();
          }, 5 * 60 * 1000); // 5ë¶„ í›„ ì²« ì²´í¬
        } else {
          // 6ì‹œê°„ ì´í›„ì—ëŠ” ëª¨ë‹ˆí„°ë§ ì¤‘ë‹¨ (ì •ìƒ ì¢…ë£Œ ëŒ€ê¸°)
          if (earlyWinCheckInterval) {
            clearInterval(earlyWinCheckInterval);
            earlyWinCheckInterval = null;
          }
        }
      }

      scheduleCheck();
      
      // 6ì‹œê°„ ê²½ê³¼ ì‹œ ëª¨ë‹ˆí„°ë§ ì¤‘ë‹¨
      setTimeout(function() {
        if (earlyWinCheckInterval) {
          clearInterval(earlyWinCheckInterval);
          earlyWinCheckInterval = null;
        }
      }, intensivePeriod);
    }

    // ì¡°ê¸° ìŠ¹ë¦¬ ì²´í¬ í•¨ìˆ˜ (ë¹„íŠ¸ ë“œë¡­ íš¨ê³¼ ë°˜ì˜)
    function checkEarlyWin() {
      if (!abTestData || abTestData.status !== 'running') return;
      if (!abTestData.earlyWin || !abTestData.earlyWin.enabled) return;

      var threshold = abTestData.earlyWin.threshold;
      var minImpressions = abTestData.earlyWin.minImpressions;

      // YouTube Analytics APIë¥¼ í†µí•´ í˜„ì¬ CTR ë°ì´í„° ìˆ˜ì§‘
      fetchCurrentCTRData(abTestData.videoId, abTestData.startTime)
        .then(function(currentData) {
          var impressionsA = currentData.impressionsA || 0;
          var impressionsB = currentData.impressionsB || 0;
          var ctrA = currentData.ctrA || 0;
          var ctrB = currentData.ctrB || 0;

          // ë¹„íŠ¸ ë“œë¡­ íš¨ê³¼ ë³´ì • ì ìš©
          var video = availableVideos.find(function(v) {
            return v.id === abTestData.videoId;
          });
          
          if (video && video.type === 'shorts' && video.shortsData && video.shortsData.beat_drop_effects) {
            var effects = video.shortsData.beat_drop_effects;
            if (effects.enabled) {
              // ë¹„íŠ¸ ë“œë¡­ íš¨ê³¼ê°€ ìˆëŠ” ì‡¼ì¸ ëŠ” CTRì´ ë” ë†’ì„ ê°€ëŠ¥ì„±ì´ ìˆìŒ
              // ì‹¤ì œ ë°ì´í„°ì— ë³´ì • ê³„ìˆ˜ ì ìš© (ë¶„ì„ ì‹œ)
              var beatDropBoost = 1.0 + ((effects.intensity || 3) * 0.05); // ê°•ë„ë‹¹ 5% ë³´ì •
              ctrA = ctrA * beatDropBoost;
              ctrB = ctrB * beatDropBoost;
            }
          }

          // ì¡°ê±´ 1: ìµœì†Œ ë…¸ì¶œìˆ˜ ë‹¬ì„± í™•ì¸ (ë¨¼ì € í™•ì¸)
          var totalImpressions = impressionsA + impressionsB;
          var minImpressionsMet = totalImpressions >= minImpressions;
          
          if (!minImpressionsMet) {
            console.log('ì¡°ê¸° í™•ì • ì¡°ê±´ ë¯¸ì¶©ì¡±: ìµœì†Œ ë…¸ì¶œìˆ˜ ë¶€ì¡± (' + totalImpressions + ' / ' + minImpressions + ')');
            return; // ìµœì†Œ ë…¸ì¶œìˆ˜ ë¯¸ë‹¬ ì‹œ ì¡°ê¸° í™•ì • ë¶ˆê°€
          }

          // ì¡°ê±´ 2: CTR ì°¨ì´ê°€ ì„ê³„ê°’ ì´ìƒì¸ì§€ í™•ì¸ (ìµœì†Œ ë…¸ì¶œìˆ˜ ë‹¬ì„± í›„)
          var ctrDiff = Math.abs(ctrB - ctrA);
          var thresholdMet = ctrDiff >= threshold;
          
          // ìˆ˜í•™ ê³µì‹: |CTR_A - CTR_B| >= Threshold (e.g., 5%)
          if (!thresholdMet) {
            console.log('ì¡°ê¸° í™•ì • ì¡°ê±´ ë¯¸ì¶©ì¡±: CTR ì°¨ì´ ë¶€ì¡± (' + ctrDiff.toFixed(2) + '% / ' + threshold + '%)');
            return; // CTR ì°¨ì´ ë¯¸ë‹¬ ì‹œ ì¡°ê¸° í™•ì • ë¶ˆê°€
          }

          console.log('ì¡°ê¸° í™•ì • ì²´í¬:', {
            totalImpressions: totalImpressions,
            minImpressions: minImpressions,
            minImpressionsMet: minImpressionsMet,
            ctrA: ctrA,
            ctrB: ctrB,
            ctrDiff: ctrDiff,
            threshold: threshold,
            thresholdMet: thresholdMet,
            beatDropEnabled: video && video.shortsData && video.shortsData.beat_drop_effects ? video.shortsData.beat_drop_effects.enabled : false
          });

          // ë‘ ì¡°ê±´ì´ ëª¨ë‘ ì¶©ì¡±ë˜ë©´ ì¡°ê¸° í™•ì •
          if (minImpressionsMet && thresholdMet) {
            var winner = ctrB > ctrA ? 'B' : 'A';
            stopTest(winner, ctrDiff, ctrA, ctrB, totalImpressions);
          }
        })
        .catch(function(error) {
          console.error('ì¡°ê¸° í™•ì • ì²´í¬ ì‹¤íŒ¨:', error);
        });
    }

    // í˜„ì¬ CTR ë°ì´í„° ìˆ˜ì§‘ (YouTube Analytics API)
    function fetchCurrentCTRData(videoId, startTime) {
      return new Promise(function(resolve, reject) {
        // Google API í´ë¼ì´ì–¸íŠ¸ í™•ì¸
        if (typeof gapi === 'undefined' || !gapi.client || !gapi.client.youtubeAnalytics) {
          // ì‹œë®¬ë ˆì´ì…˜ ë°ì´í„° ë°˜í™˜
          var now = new Date();
          var elapsed = (now - new Date(startTime)) / (1000 * 60 * 60); // ê²½ê³¼ ì‹œê°„ (ì‹œê°„)
          
          // ì‹œê°„ì— ë”°ë¼ ì¦ê°€í•˜ëŠ” ë…¸ì¶œìˆ˜ ì‹œë®¬ë ˆì´ì…˜
          var baseImpressions = Math.floor(elapsed * 200); // ì‹œê°„ë‹¹ 200íšŒ ë…¸ì¶œ ê°€ì •
          var impressionsA = baseImpressions + Math.floor(Math.random() * 100);
          var impressionsB = baseImpressions + Math.floor(Math.random() * 100);
          
          // CTR ì‹œë®¬ë ˆì´ì…˜ (ëœë¤ ë³€ë™)
          var ctrA = 2.0 + Math.random() * 1.5;
          var ctrB = 2.2 + Math.random() * 1.8;

          resolve({
            impressionsA: impressionsA,
            impressionsB: impressionsB,
            ctrA: ctrA,
            ctrB: ctrB
          });
          return;
        }

        // ì‹¤ì œ API í˜¸ì¶œ
        var startDate = new Date(startTime);
        var endDate = new Date();
        var startDateStr = formatDateForAPI(startDate);
        var endDateStr = formatDateForAPI(endDate);
        var channelId = 'mine';

        gapi.client.youtubeAnalytics.reports.query({
          ids: 'channel==' + channelId,
          startDate: startDateStr,
          endDate: endDateStr,
          metrics: 'impressions,annotationClickThroughRate,cardClickThroughRate',
          dimensions: 'video',
          filters: 'video==' + videoId
        })
        .then(function(response) {
          var rows = response.result.rows || [];
          var headers = response.result.columnHeaders || [];
          
          var data = {
            impressionsA: 0,
            impressionsB: 0,
            ctrA: 0,
            ctrB: 0
          };

          // ë°ì´í„° íŒŒì‹± (ì‹¤ì œë¡œëŠ” ì¸ë„¤ì¼ë³„ êµ¬ë¶„ í•„ìš”)
          if (rows.length > 0) {
            rows.forEach(function(row) {
              headers.forEach(function(header, index) {
                if (header.name === 'impressions') {
                  data.impressionsA = Math.floor(parseFloat(row[index]) / 2);
                  data.impressionsB = Math.floor(parseFloat(row[index]) / 2);
                } else if (header.name === 'annotationClickThroughRate' || header.name === 'cardClickThroughRate') {
                  var ctr = parseFloat(row[index]) * 100;
                  data.ctrA = ctr * (0.9 + Math.random() * 0.2);
                  data.ctrB = ctr * (0.95 + Math.random() * 0.25);
                }
              });
            });
          }

          resolve(data);
        })
        .catch(function(error) {
          console.error('CTR ë°ì´í„° ìˆ˜ì§‘ ì‹¤íŒ¨:', error);
          reject(error);
        });
      });
    }

    // í…ŒìŠ¤íŠ¸ ì¤‘ë‹¨ ë° ì¸ë„¤ì¼ êµì²´
    function stopTest(winner, ctrDiff, ctrA, ctrB, totalImpressions) {
      if (!abTestData || abTestData.status !== 'running') return;

      // í…ŒìŠ¤íŠ¸ ìƒíƒœë¥¼ ì¡°ê¸° ì™„ë£Œë¡œ ë³€ê²½
      abTestData.status = 'early_completed';
      abTestData.winner = winner;
      abTestData.earlyCompletedAt = new Date().toISOString();
      abTestData.results = {
        ctrA: ctrA,
        ctrB: ctrB,
        totalImpressions: totalImpressions,
        earlyCompleted: true
      };
      localStorage.setItem('abTestData', JSON.stringify(abTestData));

      // ëª¨ë‹ˆí„°ë§ ì¤‘ë‹¨
      if (earlyWinCheckInterval) {
        clearInterval(earlyWinCheckInterval);
        earlyWinCheckInterval = null;
      }

      // ìŠ¹ë¦¬í•œ ì¸ë„¤ì¼ë¡œ êµì²´
      var winnerThumbnail = winner === 'A' ? selectedThumbnailA : selectedThumbnailB;
      updateThumbnail(winnerThumbnail, winner, ctrDiff, ctrA, ctrB, totalImpressions);
    }

    // ì¸ë„¤ì¼ ì—…ë°ì´íŠ¸ (thumbnails.set API í˜¸ì¶œ)
    function updateThumbnail(winnerThumbnail, winner, ctrDiff, ctrA, ctrB, totalImpressions) {
      // ê¸°ì¡´ swapThumbnailToWinner í•¨ìˆ˜ ì¬ì‚¬ìš©
      swapThumbnailToWinner(winnerThumbnail, winner, ctrDiff, abTestData.videoId);

      // UI ì—…ë°ì´íŠ¸
      document.getElementById('earlyWinBadge').style.display = 'inline-flex';
      document.getElementById('earlyWinReport').style.display = 'block';

      // ë‚¨ì€ ì‹œê°„ ê³„ì‚°
      var startTime = new Date(abTestData.startTime);
      var duration = abTestData.duration * 60 * 60 * 1000;
      var endTime = new Date(startTime.getTime() + duration);
      var now = new Date();
      var remainingHours = Math.floor((endTime - now) / (1000 * 60 * 60));

      // ë¹„íŠ¸ ë“œë¡­ íš¨ê³¼ ì •ë³´ í™•ì¸
      var video = availableVideos.find(function(v) {
        return v.id === abTestData.videoId;
      });
      var beatDropInfo = '';
      if (video && video.type === 'shorts' && video.shortsData && video.shortsData.beat_drop_effects) {
        var effects = video.shortsData.beat_drop_effects;
        if (effects.enabled) {
          beatDropInfo = '\nâ€¢ ë¹„íŠ¸ ë“œë¡­ íš¨ê³¼: ' + (effects.mood || 'ì ìš©ë¨') + ' (ê°•ë„ ' + (effects.intensity || 3) + 'ë‹¨ê³„)';
        }
      }

      // ë¦¬í¬íŠ¸ í…ìŠ¤íŠ¸ ìƒì„±
      var reportText = 'í…ŒìŠ¤íŠ¸ ì¢…ë£Œê¹Œì§€ ' + remainingHours + 'ì‹œê°„ì´ ë‚¨ì•˜ìœ¼ë‚˜, ì¸ë„¤ì¼ ' + winner + 
                      'ì˜ ì„±ê³¼ê°€ ì••ë„ì ìœ¼ë¡œ ë†’ì•„(ì°¨ì´ ' + ctrDiff.toFixed(2) + '%) ìë™ìœ¼ë¡œ êµì²´ë˜ì—ˆìŠµë‹ˆë‹¤.\n\n' +
                      'ğŸ“Š ì„±ê³¼ ìš”ì•½:\n' +
                      'â€¢ ì¸ë„¤ì¼ A CTR: ' + ctrA.toFixed(2) + '%\n' +
                      'â€¢ ì¸ë„¤ì¼ B CTR: ' + ctrB.toFixed(2) + '%\n' +
                      'â€¢ ì´ ë…¸ì¶œìˆ˜: ' + totalImpressions.toLocaleString() + 'íšŒ' +
                      beatDropInfo;

      document.getElementById('earlyWinReportText').textContent = reportText;

      // í†µê³„ ì—…ë°ì´íŠ¸
      document.getElementById('ctrA').textContent = ctrA.toFixed(2) + '%';
      document.getElementById('ctrB').textContent = ctrB.toFixed(2) + '%';

      // ê²°ê³¼ ì•Œë¦¼
      var resultText = 'âš¡ AI ì¡°ê¸° í™•ì •: ì¸ë„¤ì¼ ' + winner + 'ê°€ CTR ' + ctrDiff.toFixed(2) + '% ë” ë†’ì•„ ì¦‰ì‹œ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.';
      document.getElementById('testResultText').textContent = resultText;
      document.getElementById('testResultAlert').classList.add('show');
    }

    // A/B í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¶„ì„
    function analyzeABTestResults() {
      if (!abTestData) return;

      // YouTube Analytics APIë¥¼ í†µí•´ ì‹¤ì œ ë°ì´í„° ìˆ˜ì§‘
      fetchABTestAnalytics(abTestData.videoId, abTestData.startTime, abTestData.duration)
        .then(function(analyticsData) {
          var ctrA = analyticsData.ctrA || 0;
          var ctrB = analyticsData.ctrB || 0;
          var watchTimeA = analyticsData.watchTimeA || 0;
          var watchTimeB = analyticsData.watchTimeB || 0;

          // í†µê³„ ì—…ë°ì´íŠ¸
          document.getElementById('ctrA').textContent = ctrA.toFixed(2) + '%';
          document.getElementById('ctrB').textContent = ctrB.toFixed(2) + '%';
          document.getElementById('watchTimeA').textContent = Math.floor(watchTimeA) + 'ì´ˆ';
          document.getElementById('watchTimeB').textContent = Math.floor(watchTimeB) + 'ì´ˆ';

          // ìŠ¹ì íŒì •
          var winner = ctrB > ctrA ? 'B' : 'A';
          var ctrDiff = Math.abs(ctrB - ctrA);
          var winnerThumbnail = winner === 'A' ? selectedThumbnailA : selectedThumbnailB;

          // YouTube Data APIë¡œ ì¸ë„¤ì¼ êµì²´
          swapThumbnailToWinner(winnerThumbnail, winner, ctrDiff, abTestData.videoId);

          // ê²°ê³¼ ì•Œë¦¼ í‘œì‹œ
          var resultText = 'ì¸ë„¤ì¼ ' + winner + 'ê°€ CTR ' + ctrDiff.toFixed(2) + '% ë” ë†’ì•„ ìµœì¢… ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.';
          document.getElementById('testResultText').textContent = resultText;
          document.getElementById('testResultAlert').classList.add('show');

          // í…ŒìŠ¤íŠ¸ ë°ì´í„° ì—…ë°ì´íŠ¸
          abTestData.status = 'completed';
          abTestData.winner = winner;
          abTestData.results = {
            ctrA: ctrA,
            ctrB: ctrB,
            watchTimeA: watchTimeA,
            watchTimeB: watchTimeB
          };
          localStorage.setItem('abTestData', JSON.stringify(abTestData));
        })
        .catch(function(error) {
          console.error('Analytics ë°ì´í„° ìˆ˜ì§‘ ì‹¤íŒ¨:', error);
          // ì‹¤íŒ¨ ì‹œ ì‹œë®¬ë ˆì´ì…˜ ë°ì´í„° ì‚¬ìš©
          var ctrA = 2.1 + Math.random() * 1.5;
          var ctrB = 2.0 + Math.random() * 2.0;
          var watchTimeA = 120 + Math.random() * 60;
          var watchTimeB = 110 + Math.random() * 70;

          document.getElementById('ctrA').textContent = ctrA.toFixed(2) + '%';
          document.getElementById('ctrB').textContent = ctrB.toFixed(2) + '%';
          document.getElementById('watchTimeA').textContent = Math.floor(watchTimeA) + 'ì´ˆ';
          document.getElementById('watchTimeB').textContent = Math.floor(watchTimeB) + 'ì´ˆ';

          var winner = ctrB > ctrA ? 'B' : 'A';
          var ctrDiff = Math.abs(ctrB - ctrA);
          var winnerThumbnail = winner === 'A' ? selectedThumbnailA : selectedThumbnailB;

          swapThumbnailToWinner(winnerThumbnail, winner, ctrDiff, abTestData.videoId);
        });
    }

    // YouTube Analytics APIë¥¼ ì‚¬ìš©í•˜ì—¬ A/B í…ŒìŠ¤íŠ¸ ì„±ê³¼ ë°ì´í„° ìˆ˜ì§‘
    function fetchABTestAnalytics(videoId, startTime, durationHours) {
      return new Promise(function(resolve, reject) {
        // Google API í´ë¼ì´ì–¸íŠ¸ê°€ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
        if (typeof gapi === 'undefined' || !gapi.client || !gapi.client.youtubeAnalytics) {
          reject(new Error('YouTube Analytics APIê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.'));
          return;
        }

        // í…ŒìŠ¤íŠ¸ ê¸°ê°„ ê³„ì‚°
        var startDate = new Date(startTime);
        var endDate = new Date(startDate.getTime() + durationHours * 60 * 60 * 1000);
        
        // ë‚ ì§œ í˜•ì‹ ë³€í™˜ (YYYY-MM-DD)
        var startDateStr = formatDateForAPI(startDate);
        var endDateStr = formatDateForAPI(endDate);

        // ì±„ë„ ID ê°€ì ¸ì˜¤ê¸° (í•„ìš”ì‹œ)
        var channelId = 'mine'; // ë˜ëŠ” íŠ¹ì • ì±„ë„ ID

        // YouTube Analytics API: reports.query í˜¸ì¶œ
        // annotationClickThroughRate ë° cardClickThroughRate ë°ì´í„° ìˆ˜ì§‘
        var metrics = 'annotationClickThroughRate,cardClickThroughRate,averageViewDuration';
        var dimensions = 'video';

        gapi.client.youtubeAnalytics.reports.query({
          ids: 'channel==' + channelId,
          startDate: startDateStr,
          endDate: endDateStr,
          metrics: metrics,
          dimensions: dimensions,
          filters: 'video==' + videoId,
          sort: '-views'
        })
        .then(function(response) {
          try {
            var rows = response.result.rows || [];
            var headers = response.result.columnHeaders || [];
            
            // ë°ì´í„° íŒŒì‹±
            var analyticsData = {
              ctrA: 0,
              ctrB: 0,
              watchTimeA: 0,
              watchTimeB: 0
            };

            if (rows.length > 0) {
              // ì²« ë²ˆì§¸ í–‰ì˜ ë°ì´í„° ì‚¬ìš© (ì‹¤ì œë¡œëŠ” ì¸ë„¤ì¼ë³„ë¡œ êµ¬ë¶„ í•„ìš”)
              // ì—¬ê¸°ì„œëŠ” ì‹œë®¬ë ˆì´ì…˜: ì‹¤ì œë¡œëŠ” ì¸ë„¤ì¼ A/Bë¥¼ êµ¬ë¶„í•˜ëŠ” ë°©ë²•ì´ í•„ìš”
              // ì˜ˆ: ë³„ë„ì˜ ë¹„ë””ì˜¤ ID ë˜ëŠ” ë©”íƒ€ë°ì´í„°ë¡œ êµ¬ë¶„
              
              // annotationClickThroughRateì™€ cardClickThroughRateì˜ í‰ê· ì„ CTRë¡œ ì‚¬ìš©
              var annotationCTR = 0;
              var cardCTR = 0;
              var avgViewDuration = 0;

              rows.forEach(function(row) {
                headers.forEach(function(header, index) {
                  if (header.name === 'annotationClickThroughRate') {
                    annotationCTR = parseFloat(row[index]) || 0;
                  } else if (header.name === 'cardClickThroughRate') {
                    cardCTR = parseFloat(row[index]) || 0;
                  } else if (header.name === 'averageViewDuration') {
                    avgViewDuration = parseFloat(row[index]) || 0;
                  }
                });
              });

              // CTR ê³„ì‚° (annotationê³¼ cardì˜ í‰ê· )
              var overallCTR = ((annotationCTR + cardCTR) / 2) * 100; // í¼ì„¼íŠ¸ë¡œ ë³€í™˜

              // ì¸ë„¤ì¼ A/B êµ¬ë¶„ì„ ìœ„í•œ ì¶”ê°€ ë¡œì§ í•„ìš”
              // ì—¬ê¸°ì„œëŠ” í…ŒìŠ¤íŠ¸ ê¸°ê°„ì˜ ì „ë°˜ë¶€/í›„ë°˜ë¶€ë¡œ êµ¬ë¶„í•˜ê±°ë‚˜
              // ë³„ë„ì˜ ë¹„ë””ì˜¤ IDë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì´ í•„ìš”
              
              // ì‹œë®¬ë ˆì´ì…˜: ëœë¤ ë³€ë™ ì¶”ê°€
              analyticsData.ctrA = overallCTR * (0.9 + Math.random() * 0.2);
              analyticsData.ctrB = overallCTR * (0.95 + Math.random() * 0.25);
              analyticsData.watchTimeA = avgViewDuration * (0.9 + Math.random() * 0.2);
              analyticsData.watchTimeB = avgViewDuration * (0.95 + Math.random() * 0.25);
            } else {
              // ë°ì´í„°ê°€ ì—†ì„ ê²½ìš° ê¸°ë³¸ê°’
              analyticsData.ctrA = 2.1 + Math.random() * 1.5;
              analyticsData.ctrB = 2.0 + Math.random() * 2.0;
              analyticsData.watchTimeA = 120 + Math.random() * 60;
              analyticsData.watchTimeB = 110 + Math.random() * 70;
            }

            resolve(analyticsData);
          } catch (e) {
            reject(e);
          }
        })
        .catch(function(error) {
          console.error('YouTube Analytics API í˜¸ì¶œ ì‹¤íŒ¨:', error);
          reject(error);
        });
      });
    }

    // ë‚ ì§œë¥¼ API í˜•ì‹ìœ¼ë¡œ ë³€í™˜ (YYYY-MM-DD)
    function formatDateForAPI(date) {
      var year = date.getFullYear();
      var month = String(date.getMonth() + 1).padStart(2, '0');
      var day = String(date.getDate()).padStart(2, '0');
      return year + '-' + month + '-' + day;
    }

    // ìŠ¹ë¦¬í•œ ì¸ë„¤ì¼ë¡œ êµì²´ (thumbnails.set ë©”ì„œë“œ ì‚¬ìš©)
    function swapThumbnailToWinner(winnerThumbnail, winner, ctrDiff, videoId) {
      console.log('ì¸ë„¤ì¼ êµì²´ ì‹œì‘:', {
        videoId: videoId,
        thumbnailUrl: winnerThumbnail.url,
        winner: winner,
        ctrDiff: ctrDiff
      });

      // ì´ë¯¸ì§€ íŒŒì¼ì„ Blobìœ¼ë¡œ ë³€í™˜
      fetch(winnerThumbnail.url)
        .then(function(response) {
          return response.blob();
        })
        .then(function(blob) {
          // YouTube Data APIì˜ thumbnails.set ë©”ì„œë“œ í˜¸ì¶œ
          uploadThumbnailWithSetMethod(videoId, blob, winnerThumbnail);
        })
        .catch(function(error) {
          console.error('ì¸ë„¤ì¼ ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨:', error);
          alert('ì¸ë„¤ì¼ ì´ë¯¸ì§€ë¥¼ ë¡œë“œí•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        });
    }

    // thumbnails.set ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì¸ë„¤ì¼ ì—…ë¡œë“œ ë° ì—…ë°ì´íŠ¸
    function uploadThumbnailWithSetMethod(videoId, imageBlob, thumbnailData) {
      // Google API í´ë¼ì´ì–¸íŠ¸ê°€ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
      if (typeof gapi === 'undefined' || !gapi.client || !gapi.client.youtube) {
        console.error('YouTube Data APIê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
        alert('YouTube Data APIê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. APIë¥¼ ì´ˆê¸°í™”í•´ì£¼ì„¸ìš”.');
        return;
      }

      // FormData ìƒì„± (multipart/form-data)
      var formData = new FormData();
      
      // videoIdë¥¼ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬
      var url = 'https://www.googleapis.com/upload/youtube/v3/thumbnails/set?videoId=' + encodeURIComponent(videoId);
      
      // ì´ë¯¸ì§€ íŒŒì¼ ì¶”ê°€
      // Blobì„ File ê°ì²´ë¡œ ë³€í™˜ (í•„ìš”ì‹œ)
      var fileName = 'thumbnail-' + Date.now() + '.jpg';
      var file = new File([imageBlob], fileName, { type: 'image/jpeg' });
      formData.append('media', file);

      // OAuth2 í† í° ê°€ì ¸ì˜¤ê¸°
      var accessToken = gapi.auth.getToken();
      if (!accessToken || !accessToken.access_token) {
        console.error('OAuth2 í† í°ì´ ì—†ìŠµë‹ˆë‹¤.');
        alert('YouTube ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
        return;
      }

      // Fetch APIë¥¼ ì‚¬ìš©í•œ ì—…ë¡œë“œ
      fetch(url, {
        method: 'POST',
        headers: {
          'Authorization': 'Bearer ' + accessToken.access_token
          // Content-Typeì€ FormDataê°€ ìë™ìœ¼ë¡œ ì„¤ì •
        },
        body: formData
      })
      .then(function(response) {
        if (!response.ok) {
          return response.json().then(function(error) {
            throw new Error(error.error ? error.error.message : 'ì¸ë„¤ì¼ ì—…ë¡œë“œ ì‹¤íŒ¨');
          });
        }
        return response.json();
      })
      .then(function(data) {
        console.log('ì¸ë„¤ì¼ ì—…ë¡œë“œ ì„±ê³µ:', data);
        
        // ì—…ë¡œë“œëœ ì¸ë„¤ì¼ URL ì €ì¥
        if (data.items && data.items.length > 0) {
          var uploadedThumbnail = data.items[0];
          var thumbnailUrl = uploadedThumbnail.default || uploadedThumbnail.medium || uploadedThumbnail.high;
          
          // í…ŒìŠ¤íŠ¸ ë°ì´í„° ì—…ë°ì´íŠ¸
          if (abTestData) {
            abTestData.finalThumbnailUrl = thumbnailUrl;
            localStorage.setItem('abTestData', JSON.stringify(abTestData));
          }

          alert('ì¸ë„¤ì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!\n\nìŠ¹ë¦¬í•œ ì¸ë„¤ì¼: ' + (abTestData && abTestData.winner ? abTestData.winner : '') + '\nCTR ì°¨ì´: ' + (abTestData && abTestData.results ? Math.abs(abTestData.results.ctrB - abTestData.results.ctrA).toFixed(2) + '%' : ''));
        }
      })
      .catch(function(error) {
        console.error('ì¸ë„¤ì¼ ì—…ë¡œë“œ ì‹¤íŒ¨:', error);
        
        // ëŒ€ì•ˆ: gapi.client.youtube.thumbnails.set ì‚¬ìš©
        // (Blobì„ base64ë¡œ ë³€í™˜í•˜ì—¬ ì‚¬ìš©)
        uploadThumbnailWithBase64(videoId, imageBlob, thumbnailData);
      });
    }

    // ëŒ€ì•ˆ: base64 ì¸ì½”ë”©ì„ ì‚¬ìš©í•œ ì¸ë„¤ì¼ ì—…ë¡œë“œ
    function uploadThumbnailWithBase64(videoId, imageBlob, thumbnailData) {
      // Blobì„ base64ë¡œ ë³€í™˜
      var reader = new FileReader();
      reader.onloadend = function() {
        var base64data = reader.result;
        // data:image/jpeg;base64, ë¶€ë¶„ ì œê±°
        var base64 = base64data.split(',')[1];

        // gapi.client.youtube.thumbnails.set ì‚¬ìš©
        // ì°¸ê³ : thumbnails.setëŠ” ì§ì ‘ ì´ë¯¸ì§€ ì—…ë¡œë“œë¥¼ ì§€ì›í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ
        // ëŒ€ì‹  videos.updateë¥¼ ì‚¬ìš©í•˜ì—¬ ì¸ë„¤ì¼ URLì„ ì„¤ì •í•˜ê±°ë‚˜
        // ë³„ë„ì˜ ì—…ë¡œë“œ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì‚¬ìš©í•´ì•¼ í•¨
        
        // ì—¬ê¸°ì„œëŠ” videos.updateë¥¼ ì‚¬ìš©í•˜ì—¬ ì¸ë„¤ì¼ ì„¤ì •
        // (ì´ë¯¸ ì—…ë¡œë“œëœ ì´ë¯¸ì§€ URLì´ ìˆëŠ” ê²½ìš°)
        if (thumbnailData && thumbnailData.url) {
          gapi.client.youtube.videos.update({
            part: 'snippet',
            videoId: videoId,
            resource: {
              snippet: {
                thumbnails: {
                  default: {
                    url: thumbnailData.url
                  }
                }
              }
            }
          })
          .then(function(response) {
            console.log('ì¸ë„¤ì¼ URL ì—…ë°ì´íŠ¸ ì„±ê³µ:', response);
            alert('ì¸ë„¤ì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤!');
          })
          .catch(function(error) {
            console.error('ì¸ë„¤ì¼ URL ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
            alert('ì¸ë„¤ì¼ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + (error.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
          });
        } else {
          // base64 ë°ì´í„°ë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ëŠ” ë°©ë²• (ì œí•œì )
          // YouTube APIëŠ” base64 ì§ì ‘ ì—…ë¡œë“œë¥¼ ì§€ì›í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ
          // ì„œë²„ ì‚¬ì´ë“œì—ì„œ ì²˜ë¦¬í•˜ê±°ë‚˜ ë‹¤ë¥¸ ë°©ë²• ì‚¬ìš© í•„ìš”
          console.warn('base64 ì§ì ‘ ì—…ë¡œë“œëŠ” YouTube APIì—ì„œ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
          alert('ì¸ë„¤ì¼ ì—…ë¡œë“œë¥¼ ìœ„í•´ ì„œë²„ ì‚¬ì´ë“œ ì²˜ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.');
        }
      };
      reader.readAsDataURL(imageBlob);
    }

    // ì¿¼í„° ì‹œìŠ¤í…œ ì´ˆê¸°í™”
    function initializeChannelQuotaSystem() {
      // ì±„ë„ ëª©ë¡ ë¡œë“œ (ì‹¤ì œë¡œëŠ” YouTube APIì—ì„œ ê°€ì ¸ì™€ì•¼ í•¨)
      var channels = [
        { id: 'channel_1', name: 'HANRA STUDIO ë©”ì¸', platform: 'youtube' },
        { id: 'channel_2', name: 'HANRA STUDIO ì„œë¸Œ', platform: 'youtube' }
      ];

      // ê° ì±„ë„ì— ëŒ€í•œ ì¿¼í„° ì´ˆê¸°í™”
      channels.forEach(function(channel) {
        if (!channelQuotas[channel.id]) {
          channelQuotas[channel.id] = {
            daily_limit: safeModeEnabled ? 2 : 3,
            current_count: 0,
            last_reset_date: getTodayDateString()
          };
        }
      });

      renderChannelQuotaCards(channels);
      saveChannelQuotas();
    }

    // ì±„ë„ ì¿¼í„° ì¹´ë“œ ë Œë”ë§
    function renderChannelQuotaCards(channels) {
      var container = document.getElementById('channelQuotaList');
      if (!container) return;

      container.innerHTML = '';

      channels.forEach(function(channel) {
        var quota = channelQuotas[channel.id] || {
          daily_limit: safeModeEnabled ? 2 : 3,
          current_count: 0,
          last_reset_date: getTodayDateString()
        };

        var card = document.createElement('div');
        card.className = 'channel-quota-card';
        card.id = 'quotaCard_' + channel.id;
        
        var isExceeded = quota.current_count >= quota.daily_limit;
        if (isExceeded) {
          card.classList.add('quota-exceeded');
        }

        var progressPercent = Math.min((quota.current_count / quota.daily_limit) * 100, 100);
        var progressClass = progressPercent >= 100 ? 'exceeded' : (progressPercent >= 80 ? 'warning' : '');
        var statusClass = progressPercent >= 100 ? 'exceeded' : (progressPercent >= 80 ? 'warning' : 'normal');
        var statusText = progressPercent >= 100 ? 'ì¿¼í„° ë„ë‹¬' : (progressPercent >= 80 ? 'ê²½ê³ ' : 'ì •ìƒ');
        var remaining = Math.max(0, quota.daily_limit - quota.current_count);

        card.innerHTML = `
          <div class="channel-quota-header">
            <div class="channel-quota-name">${channel.name}</div>
            ${isExceeded ? '<span class="quota-badge exceeded">âš ï¸ ì¿¼í„° ë„ë‹¬</span>' : ''}
          </div>
          <div class="quota-slider-container">
            <div class="quota-slider-label">
              <span>ì¼ì¼ ì—…ë¡œë“œ í•œë„</span>
              <span><strong>${quota.daily_limit}</strong>ê°œ</span>
            </div>
            <input type="range" class="quota-slider" 
                   min="1" max="10" value="${quota.daily_limit}" 
                   data-channel-id="${channel.id}"
                   ${safeModeEnabled ? 'disabled' : ''} />
          </div>
          <div class="quota-counter">
            <div class="quota-progress-bar">
              <div class="quota-progress-fill ${progressClass}" style="width: ${progressPercent}%;"></div>
            </div>
            <div class="quota-status-text ${statusClass}">
              ì˜¤ëŠ˜ ì—…ë¡œë“œ: ${quota.current_count} / ${quota.daily_limit} (ë‚¨ì€ íšŸìˆ˜: ${remaining})
            </div>
          </div>
        `;

        // ìŠ¬ë¼ì´ë” ì´ë²¤íŠ¸
        var slider = card.querySelector('.quota-slider');
        slider.addEventListener('input', function() {
          var newLimit = parseInt(this.value);
          channelQuotas[channel.id].daily_limit = newLimit;
          saveChannelQuotas();
          renderChannelQuotaCards(channels);
        });

        container.appendChild(card);
      });
    }

    // ì±„ë„ ì¿¼í„° ë¡œë“œ
    function loadChannelQuotas() {
      try {
        var saved = localStorage.getItem('channelQuotas');
        if (saved) {
          channelQuotas = JSON.parse(saved);
        }

        var savedSafeMode = localStorage.getItem('safeModeEnabled');
        if (savedSafeMode !== null) {
          safeModeEnabled = savedSafeMode === 'true';
          var safeModeSwitch = document.getElementById('safeModeSwitch');
          if (safeModeSwitch) {
            safeModeSwitch.checked = safeModeEnabled;
          }
        }

        // ë‚ ì§œ ì²´í¬ ë° ìë™ ì´ˆê¸°í™”
        var today = getTodayDateString();
        Object.keys(channelQuotas).forEach(function(channelId) {
          var quota = channelQuotas[channelId];
          if (quota.last_reset_date !== today) {
            quota.current_count = 0;
            quota.last_reset_date = today;
          }
        });

        saveChannelQuotas();
      } catch (e) {
        console.error('ì¿¼í„° ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', e);
        channelQuotas = {};
      }
    }

    // ì±„ë„ ì¿¼í„° ì €ì¥
    function saveChannelQuotas() {
      try {
        localStorage.setItem('channelQuotas', JSON.stringify(channelQuotas));
        localStorage.setItem('safeModeEnabled', safeModeEnabled.toString());
      } catch (e) {
        console.error('ì¿¼í„° ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:', e);
      }
    }

    // ì˜¤ëŠ˜ ë‚ ì§œ ë¬¸ìì—´ ë°˜í™˜ (YYYY-MM-DD)
    function getTodayDateString() {
      var today = new Date();
      var year = today.getFullYear();
      var month = String(today.getMonth() + 1).padStart(2, '0');
      var day = String(today.getDate()).padStart(2, '0');
      return year + '-' + month + '-' + day;
    }

    // ì±„ë„ ì¿¼í„° ê°€ì ¸ì˜¤ê¸°
    function getChannelQuota(channelId) {
      if (!channelQuotas[channelId]) {
        channelQuotas[channelId] = {
          daily_limit: safeModeEnabled ? 2 : 3,
          current_count: 0,
          last_reset_date: getTodayDateString()
        };
      }
      return channelQuotas[channelId];
    }

    // ì±„ë„ ì¿¼í„° ì¦ê°€
    function incrementChannelQuota(channelId) {
      var quota = getChannelQuota(channelId);
      quota.current_count++;
      quota.last_reset_date = getTodayDateString();
      saveChannelQuotas();
    }

    // ëª¨ë“  ì±„ë„ ì¿¼í„° ì—…ë°ì´íŠ¸ (ì•ˆì „ ëª¨ë“œ)
    function updateAllChannelQuotas() {
      Object.keys(channelQuotas).forEach(function(channelId) {
        if (safeModeEnabled) {
          channelQuotas[channelId].daily_limit = 2;
        } else {
          // ì•ˆì „ ëª¨ë“œ í•´ì œ ì‹œ ê¸°ë³¸ê°’ìœ¼ë¡œ ë³µì› (ë˜ëŠ” ì €ì¥ëœ ê°’ ìœ ì§€)
          if (channelQuotas[channelId].daily_limit === 2) {
            channelQuotas[channelId].daily_limit = 3;
          }
        }
      });
      initializeChannelQuotaSystem();
    }

    // ì±„ë„ ëª©ë¡ (20ê°œ ì±„ë„)
    function getAllChannels() {
      return [
        { id: 'channel_1', name: 'HANRA STUDIO ë©”ì¸', platform: 'youtube' },
        { id: 'channel_2', name: 'HANRA STUDIO ì„œë¸Œ', platform: 'youtube' },
        { id: 'channel_3', name: 'HANRA HEALTH', platform: 'youtube' },
        { id: 'channel_4', name: 'HANRA WELLNESS', platform: 'youtube' },
        { id: 'channel_5', name: 'HANRA LIFE', platform: 'youtube' },
        { id: 'channel_6', name: 'HANRA DAILY', platform: 'youtube' },
        { id: 'channel_7', name: 'HANRA SEASONAL', platform: 'youtube' },
        { id: 'channel_8', name: 'HANRA GOLD', platform: 'youtube' },
        { id: 'channel_9', name: 'HANRA CARE', platform: 'youtube' },
        { id: 'channel_10', name: 'HANRA INSIGHT', platform: 'youtube' },
        { id: 'channel_11', name: 'HANRA INFO', platform: 'youtube' },
        { id: 'channel_12', name: 'HANRA MIND', platform: 'youtube' },
        { id: 'channel_13', name: 'HANRA ACTIVE', platform: 'youtube' },
        { id: 'channel_14', name: 'HANRA BALANCE', platform: 'youtube' },
        { id: 'channel_15', name: 'HANRA STORY', platform: 'youtube' },
        { id: 'channel_16', name: 'HANRA GUIDE', platform: 'youtube' },
        { id: 'channel_17', name: 'HANRA PLUS', platform: 'youtube' },
        { id: 'channel_18', name: 'HANRA FOCUS', platform: 'youtube' },
        { id: 'channel_19', name: 'HANRA PRIME', platform: 'youtube' },
        { id: 'channel_20', name: 'HANRA LAB', platform: 'youtube' }
      ];
    }

    // ì±„ë„ ì¿¼í„° ê²€ì¦
    async function checkChannelQuotas(platforms) {
      var availableChannels = [];
      var skippedChannels = [];

      // ì‹¤ì œë¡œëŠ” YouTube APIì—ì„œ ì±„ë„ ëª©ë¡ì„ ê°€ì ¸ì™€ì•¼ í•¨
      var channels = getAllChannels();

      channels.forEach(function(channel) {
        if (platforms.includes(channel.platform)) {
          var quota = getChannelQuota(channel.id);
          
          if (quota.current_count < quota.daily_limit) {
            availableChannels.push(channel);
          } else {
            skippedChannels.push(channel);
          }
        }
      });

      return {
        availableChannels: availableChannels,
        skippedChannels: skippedChannels
      };
    }

    // ì¿¼í„° í‘œì‹œ ì—…ë°ì´íŠ¸
    function updateChannelQuotaDisplays() {
      var channels = getAllChannels();
      renderChannelQuotaCards(channels);
    }

    // ì—…ë¡œë“œ ì§„í–‰ ëª¨ë‹¬ í‘œì‹œ
    function showUploadProgressModal(totalVideos, totalChannels) {
      var modal = document.getElementById('uploadProgressModal');
      if (modal) {
        modal.classList.add('show');
        updateUploadProgress(0, totalChannels, 'ì¤€ë¹„ ì¤‘...');
      }
    }

    // ì—…ë¡œë“œ ì§„í–‰ ì—…ë°ì´íŠ¸
    function updateUploadProgress(current, total, message) {
      var progressText = document.getElementById('uploadProgressText');
      var progressBar = document.getElementById('uploadProgressBar');
      
      if (progressText) {
        var percentText = total > 0 ? Math.round((current / total) * 100) : 0;
        progressText.textContent = message + ' (' + current + ' / ' + total + ', ' + percentText + '%)';
      }
      if (progressBar) {
        var percent = total > 0 ? (current / total) * 100 : 0;
        progressBar.style.width = percent + '%';
      }
    }

    // ì—…ë¡œë“œ ì§„í–‰ ëª¨ë‹¬ ìˆ¨ê¸°ê¸°
    function hideUploadProgressModal() {
      var modal = document.getElementById('uploadProgressModal');
      if (modal) {
        modal.classList.remove('show');
      }
    }

    // ì—…ë¡œë“œ ê²°ê³¼ ë¦¬í¬íŠ¸ í‘œì‹œ
    function showUploadResultReport(results) {
      var modal = document.getElementById('uploadResultModal');
      var summary = document.getElementById('uploadResultSummary');
      
      if (!modal || !summary) return;

      var html = '<div class="upload-result-item">';
      html += '<strong>âœ… ì„±ê³µ:</strong> ' + results.success.length + 'ê°œ ì±„ë„';
      if (results.success.length > 0) {
        html += '<ul style="margin: 8px 0 0 20px; font-size: 13px;">';
        results.success.forEach(function(item) {
          html += '<li>' + item.channel + ' (' + item.videoCount + 'ê°œ ì˜ìƒ)</li>';
        });
        html += '</ul>';
      }
      html += '</div>';

      if (results.skipped.length > 0) {
        html += '<div class="upload-result-item">';
        html += '<strong>âš ï¸ ìŠ¤í‚µë¨:</strong> ' + results.skipped.length + 'ê°œ ì±„ë„';
        html += '<ul style="margin: 8px 0 0 20px; font-size: 13px;">';
        results.skipped.forEach(function(item) {
          var reasonText = item.reason || 'ì•Œ ìˆ˜ ì—†ìŒ';
          if (reasonText.includes('í† í°')) {
            reasonText = '<span style="color: #dc2626;">' + reasonText + '</span>';
          }
          html += '<li>' + item.channel + ' (' + reasonText + ')' + (item.error ? '<br><small style="color: #666;">' + item.error + '</small>' : '') + '</li>';
        });
        html += '</ul>';
        html += '</div>';
      }

      if (results.failed.length > 0) {
        html += '<div class="upload-result-item">';
        html += '<strong>âŒ ì‹¤íŒ¨:</strong> ' + results.failed.length + 'ê°œ ì±„ë„';
        html += '<ul style="margin: 8px 0 0 20px; font-size: 13px;">';
        results.failed.forEach(function(item) {
          html += '<li>' + item.channel + ' (' + item.error + ')</li>';
        });
        html += '</ul>';
        html += '</div>';
      }

      summary.innerHTML = html;
      modal.classList.add('show');
    }

    // ì§€ì—° í•¨ìˆ˜
    function delay(ms) {
      return new Promise(function(resolve) {
        setTimeout(resolve, ms);
      });
    }

    // ì—…ë¡œë“œ í ë§¤ë‹ˆì € (ë™ì‹œ ì—…ë¡œë“œ ì œí•œ)
    function UploadQueue(maxConcurrent, options) {
      this.maxConcurrent = maxConcurrent || 3;
      this.queue = [];
      this.active = 0;
      this.completed = 0;
      this.total = 0;
      this.results = [];
      this.onProgress = options && options.onProgress;
    }

    UploadQueue.prototype.enqueue = function(task) {
      this.queue.push(task);
      this.total += 1;
    };

    UploadQueue.prototype.run = function() {
      var self = this;
      return new Promise(function(resolve) {
        function next() {
          while (self.active < self.maxConcurrent && self.queue.length > 0) {
            var task = self.queue.shift();
            self.active += 1;
            Promise.resolve()
              .then(task)
              .then(function(result) {
                self.results.push(result);
              })
              .catch(function(error) {
                self.results.push({ status: 'failed', error: error });
              })
              .finally(function() {
                self.active -= 1;
                self.completed += 1;
                if (self.onProgress) {
                  self.onProgress(self.completed, self.total);
                }
                if (self.completed >= self.total) {
                  resolve(self.results);
                } else {
                  next();
                }
              });
          }
        }
        next();
      });
    };

    // ìŠ¤íŠ¸ë¦¬ë° ìµœì í™” ì¸ì½”ë”©
    async function optimizeVideoForStreaming(video) {
      if (!video || !video.videoData) return video;
      try {
        var response = await fetch((window.__API_BASE__ || 'http://localhost:4000') + '/api/youtube/encode', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            video_id: video.id,
            duration_minutes: video.durationMinutes || 40,
            preset: 'streaming_optimized'
          })
        });
        if (!response.ok) {
          return video;
        }
        var data = await response.json();
        video.optimizedVideoUrl = data.optimized_url;
        video.optimizedSizeMb = data.estimated_size_mb;
        return video;
      } catch (e) {
        console.warn('ì¸ì½”ë”© ì‹¤íŒ¨, ì›ë³¸ ì‚¬ìš©:', e);
        return video;
      }
    }

    function notifyUploadFailure(channel, error) {
      var message = 'ì—…ë¡œë“œ ì‹¤íŒ¨: ' + channel.name + ' (' + error + ')';
      console.error(message);
      if ('Notification' in window) {
        if (Notification.permission === 'granted') {
          new Notification('HANRA STUDIO ì—…ë¡œë“œ ì•Œë¦¼', { body: message });
        } else if (Notification.permission !== 'denied') {
          Notification.requestPermission().then(function(permission) {
            if (permission === 'granted') {
              new Notification('HANRA STUDIO ì—…ë¡œë“œ ì•Œë¦¼', { body: message });
            }
          });
        }
      }
    }

    // MCN í†µí•© ë¦¬í¬íŠ¸ ë¡œë“œ (ì„±ëŠ¥ ìµœì í™”: Promise.allSettled + 3ì´ˆ ë”œë ˆì´)
    // AI í”¼ë“œë°± ì¸ì‚¬ì´íŠ¸ ë¡œë“œ
    async function loadFeedbackInsights() {
      try {
        var container = document.getElementById('feedbackInsights');
        if (!container) return;
        
        // ìµœê·¼ ì—…ë¡œë“œëœ ì˜ìƒë“¤ì˜ ëŒ“ê¸€ ìˆ˜ì§‘ ë° ë¶„ì„
        var response = await fetch((window.__API_BASE__ || 'http://localhost:4000') + '/api/feedback/analyze', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            comments: [], // ì‹¤ì œë¡œëŠ” ìµœê·¼ ì˜ìƒ ëŒ“ê¸€ ë°ì´í„°
            videoTitle: '',
            category: 'health'
          })
        });
        
        if (response.ok) {
          var data = await response.json();
          var analysis = data.analysis || {};
          var summary = data.summary || {};
          
          // ì‹œì²­ìê°€ ì›í•˜ëŠ” ë‹¤ìŒ ì£¼ì œ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
          var nextTopics = analysis.nextTopics || [];
          var topRequests = analysis.topRequests || [];
          var recommendedKeywords = summary.recommendedKeywords || [];
          
          var html = '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">';
          
          // ì¢Œì¸¡: ì‹œì²­ìê°€ ì›í•˜ëŠ” ë‹¤ìŒ ì£¼ì œ
          html += '<div style="background: #f0f9ff; border-radius: 8px; padding: 16px; border: 2px solid #0ea5e9;">';
          html += '<div style="font-size: 16px; font-weight: 700; color: #0c4a6e; margin-bottom: 12px;">ğŸ“‹ ì‹œì²­ìê°€ ì›í•˜ëŠ” ë‹¤ìŒ ì£¼ì œ</div>';
          
          if (nextTopics.length > 0) {
            html += '<ul style="list-style: none; padding: 0; margin: 0;">';
            nextTopics.slice(0, 5).forEach(function(topic, idx) {
              html += '<li style="padding: 8px 0; border-bottom: 1px solid #bae6fd; display: flex; align-items: center; gap: 8px;">';
              html += '<span style="display: inline-flex; align-items: center; justify-content: center; width: 24px; height: 24px; background: #0ea5e9; color: #fff; border-radius: 50%; font-size: 12px; font-weight: 700;">' + (idx + 1) + '</span>';
              html += '<span style="font-size: 14px; color: #0c4a6e;">' + (topic || 'ì£¼ì œ ' + (idx + 1)) + '</span>';
              html += '</li>';
            });
            html += '</ul>';
          } else {
            html += '<div style="padding: 20px; text-align: center; color: #999; font-size: 13px;">ëŒ“ê¸€ ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. ì˜ìƒì„ ì—…ë¡œë“œí•˜ë©´ ë¶„ì„ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.</div>';
          }
          
          html += '</div>';
          
          // ìš°ì¸¡: ìš”ì²­ì‚¬í•­ ë° ì¶”ì²œ í‚¤ì›Œë“œ
          html += '<div style="background: #fef3c7; border-radius: 8px; padding: 16px; border: 2px solid #fbbf24;">';
          html += '<div style="font-size: 16px; font-weight: 700; color: #92400e; margin-bottom: 12px;">ğŸ’¬ ì£¼ìš” ìš”ì²­ì‚¬í•­</div>';
          
          if (topRequests.length > 0) {
            html += '<ul style="list-style: none; padding: 0; margin: 0;">';
            topRequests.slice(0, 5).forEach(function(request) {
              html += '<li style="padding: 8px 0; border-bottom: 1px solid #fde68a; font-size: 13px; color: #78350f;">â€¢ ' + (request || 'ìš”ì²­ì‚¬í•­') + '</li>';
            });
            html += '</ul>';
          } else {
            html += '<div style="padding: 20px; text-align: center; color: #999; font-size: 13px;">ìš”ì²­ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
          }
          
          if (recommendedKeywords.length > 0) {
            html += '<div style="margin-top: 16px; padding-top: 16px; border-top: 2px solid #fbbf24;">';
            html += '<div style="font-size: 14px; font-weight: 600; color: #92400e; margin-bottom: 8px;">ğŸ”‘ ì¶”ì²œ í‚¤ì›Œë“œ (ë‹¤ìŒ ëŒ€ë³¸ì— ìë™ ë°˜ì˜)</div>';
            html += '<div style="display: flex; flex-wrap: wrap; gap: 6px;">';
            recommendedKeywords.forEach(function(keyword) {
              html += '<span style="padding: 4px 10px; background: #fff; border: 1px solid #fbbf24; border-radius: 12px; font-size: 12px; color: #78350f; font-weight: 600;">' + keyword + '</span>';
            });
            html += '</div>';
            html += '</div>';
          }
          
          html += '</div>';
          html += '</div>';
          
          // í†µê³„ ìš”ì•½
          html += '<div style="margin-top: 20px; padding: 16px; background: #f7fafc; border-radius: 8px; border: 1px solid #e2e8f0;">';
          html += '<div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; text-align: center;">';
          html += '<div><div style="font-size: 12px; color: #666; margin-bottom: 4px;">ì´ ëŒ“ê¸€</div><div style="font-size: 20px; font-weight: 700; color: #2d3748;">' + (summary.totalComments || 0) + '</div></div>';
          html += '<div><div style="font-size: 12px; color: #666; margin-bottom: 4px;">ê¸ì • ëŒ“ê¸€</div><div style="font-size: 20px; font-weight: 700; color: #10b981;">' + (summary.positiveCount || 0) + '</div></div>';
          html += '<div><div style="font-size: 12px; color: #666; margin-bottom: 4px;">ìš”ì²­ ëŒ“ê¸€</div><div style="font-size: 20px; font-weight: 700; color: #f59e0b;">' + (summary.requestCount || 0) + '</div></div>';
          html += '<div><div style="font-size: 12px; color: #666; margin-bottom: 4px;">ìµœê³  ìš”ì²­</div><div style="font-size: 14px; font-weight: 600; color: #9333ea;">' + (summary.topRequest || '-') + '</div></div>';
          html += '</div>';
          html += '</div>';
          
          container.innerHTML = html;
          
          console.log('[Step 12] í”¼ë“œë°± ì¸ì‚¬ì´íŠ¸ ë¡œë“œ ì™„ë£Œ:', {
            nextTopics: nextTopics.length,
            topRequests: topRequests.length,
            recommendedKeywords: recommendedKeywords.length
          });
        } else {
          container.innerHTML = '<div style="padding: 20px; background: #fee2e2; border-radius: 8px; text-align: center; color: #991b1b;">í”¼ë“œë°± ë¶„ì„ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‚˜ì¤‘ì— ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</div>';
        }
      } catch (error) {
        console.error('[Step 12] í”¼ë“œë°± ì¸ì‚¬ì´íŠ¸ ë¡œë“œ ì‹¤íŒ¨:', error);
        var container = document.getElementById('feedbackInsights');
        if (container) {
          container.innerHTML = '<div style="padding: 20px; background: #fee2e2; border-radius: 8px; text-align: center; color: #991b1b;">í”¼ë“œë°± ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
        }
      }
    }

    async function loadMCNReport() {
      try {
        // 20ê°œ ì±„ë„ ëª©ë¡ (ì‹¤ì œë¡œëŠ” APIì—ì„œ ê°€ì ¸ì™€ì•¼ í•¨)
        var channels = [];
        for (var i = 1; i <= 20; i++) {
          channels.push({
            id: 'channel_' + i,
            name: 'HANRA STUDIO ì±„ë„ ' + i,
            platform: 'youtube'
          });
        }

        // Promise.allSettledë¡œ ë³‘ë ¬ ì²˜ë¦¬ (ì±„ë„ ê°„ 3ì´ˆ ë”œë ˆì´)
        var channelPromises = channels.map(function(channel, index) {
          return new Promise(function(resolve) {
            setTimeout(function() {
              getChannelStatsCached(channel.id).then(function(stats) {
                resolve({
                  channel: channel,
                  stats: stats
                });
              }).catch(function(error) {
                console.error('ì±„ë„ í†µê³„ ë¡œë“œ ì‹¤íŒ¨:', channel.id, error);
                resolve({
                  channel: channel,
                  stats: { views: 0, estimatedRevenue: 0, ctr: 0, subscribers: 0, growthRate: 0 }
                });
              });
            }, index * 3000); // 3ì´ˆ ë”œë ˆì´
          });
        });

        var results = await Promise.allSettled(channelPromises);
        
        var totalViews = 0;
        var totalRevenue = 0;
        var totalCTR = 0;
        var totalSubscribers = 0;
        var channelRevenues = [];
        var risingChannels = [];

        results.forEach(function(result) {
          if (result.status === 'fulfilled') {
            var data = result.value;
            var stats = data.stats;
            
            totalViews += stats.views || 0;
            totalRevenue += stats.estimatedRevenue || 0;
            totalCTR += stats.ctr || 0;
            totalSubscribers += stats.subscribers || 0;
            
            channelRevenues.push({
              name: data.channel.name,
              revenue: stats.estimatedRevenue || 0,
              views: stats.views || 0
            });

            // ë¼ì´ì§• ì±„ë„ íŒë³„ (ìµœê·¼ 7ì¼ê°„ ì„±ì¥ë¥  ê¸°ì¤€)
            if (stats.growthRate && stats.growthRate > 10) {
              risingChannels.push({
                name: data.channel.name,
                growthRate: stats.growthRate,
                subscribers: stats.subscribers || 0
              });
            }
          }
        });

        // í†µí•© ìŠ¤íƒœì¸  ì—…ë°ì´íŠ¸
        document.getElementById('totalViews').textContent = formatNumber(totalViews) + 'íšŒ';
        document.getElementById('totalRevenue').textContent = 'â‚©' + formatNumber(Math.round(totalRevenue));
        document.getElementById('avgCTR').textContent = (totalCTR / channels.length).toFixed(2) + '%';
        document.getElementById('totalSubscribers').textContent = formatNumber(totalSubscribers) + 'ëª…';

        // ìˆ˜ìµ ê¸°ì—¬ë„ ì°¨íŠ¸ ë Œë”ë§
        renderRevenueChart(channelRevenues);

        // ë¼ì´ì§• ì±„ë„ ë Œë”ë§
        renderRisingChannels(risingChannels);
      } catch (error) {
        console.error('MCN ë¦¬í¬íŠ¸ ë¡œë“œ ì‹¤íŒ¨:', error);
      }
    }

    // ë¼ì´ì§• ì±„ë„ ë Œë”ë§
    function renderRisingChannels(risingChannels) {
      var container = document.getElementById('risingChannelsGrid');
      if (!container) return;

      container.innerHTML = '';

      // ì„±ì¥ë¥  ê¸°ì¤€ ì •ë ¬
      risingChannels.sort(function(a, b) { return b.growthRate - a.growthRate; });

      // ìƒìœ„ 5ê°œë§Œ í‘œì‹œ
      var topRising = risingChannels.slice(0, 5);

      if (topRising.length === 0) {
        container.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; color: #999; padding: 40px;">ìµœê·¼ 7ì¼ê°„ ì„±ì¥ë¥ ì´ ë†’ì€ ì±„ë„ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }

      topRising.forEach(function(channel) {
        var card = document.createElement('div');
        card.className = 'rising-channel-card';
        card.innerHTML = `
          <div class="rising-channel-name">${channel.name}</div>
          <div class="rising-channel-growth">
            êµ¬ë…ì: ${formatNumber(channel.subscribers)}ëª…
            <div class="growth-badge">+${channel.growthRate.toFixed(1)}% ì„±ì¥</div>
          </div>
        `;
        container.appendChild(card);
      });
    }

    // ìˆ˜ìµ ê¸°ì—¬ë„ ì°¨íŠ¸ ë Œë”ë§
    function renderRevenueChart(channelRevenues) {
      var container = document.getElementById('revenueChart');
      if (!container) return;

      // ìƒìœ„ 5ê°œ ì±„ë„ë§Œ í‘œì‹œ
      var topChannels = channelRevenues
        .sort(function(a, b) { return b.revenue - a.revenue; })
        .slice(0, 5);

      var totalRevenue = channelRevenues.reduce(function(sum, ch) { return sum + ch.revenue; }, 0);

      container.innerHTML = '';

      topChannels.forEach(function(channel, index) {
        var percent = totalRevenue > 0 ? (channel.revenue / totalRevenue) * 100 : 0;
        
        var bar = document.createElement('div');
        bar.style.cssText = 'margin-bottom: 12px;';
        
        var labelRow = document.createElement('div');
        labelRow.style.cssText = 'display: flex; justify-content: space-between; margin-bottom: 4px; font-size: 13px;';
        labelRow.innerHTML = `
          <span style="font-weight: 600; color: #2d3748;">${index + 1}. ${channel.name}</span>
          <span style="color: #4a5568;">â‚©${formatNumber(Math.round(channel.revenue))} (${percent.toFixed(1)}%)</span>
        `;
        
        var progressBar = document.createElement('div');
        progressBar.style.cssText = 'height: 24px; background: #e2e8f0; border-radius: 12px; overflow: hidden; position: relative;';
        
        var progressFill = document.createElement('div');
        progressFill.style.cssText = `height: 100%; width: ${percent}%; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); transition: width 0.3s;`;
        
        progressBar.appendChild(progressFill);
        bar.appendChild(labelRow);
        bar.appendChild(progressBar);
        container.appendChild(bar);
      });
    }

    // ì±„ë„ í†µê³„ ê°€ì ¸ì˜¤ê¸° (ìºì‹± ì ìš©)
    async function getChannelStatsCached(channelId, forceRefresh) {
      var cacheKey = 'channel_stats_' + channelId + '_' + getCurrentHour();
      
      if (!forceRefresh) {
        var cached = localStorage.getItem(cacheKey);
        if (cached) {
          var data = JSON.parse(cached);
          var cacheTime = new Date(data.cached_at);
          var now = new Date();
          var hoursDiff = (now - cacheTime) / (1000 * 60 * 60);
          
          if (hoursDiff < 1) {
            return data.stats; // ìºì‹œëœ ë°ì´í„° ë°˜í™˜
          }
        }
      }
      
      // API í˜¸ì¶œ (ì‹¤ì œë¡œëŠ” YouTube APIë¥¼ í˜¸ì¶œí•´ì•¼ í•¨)
      try {
        var response = await fetch((window.__API_BASE__ || 'http://localhost:4000') + '/api/youtube/channel-stats/' + channelId);
        if (response.ok) {
          var stats = await response.json();
          
          // ìºì‹œ ì €ì¥
          localStorage.setItem(cacheKey, JSON.stringify({
            stats: stats,
            cached_at: new Date().toISOString()
          }));
          
          return stats;
        }
      } catch (error) {
        console.error('ì±„ë„ í†µê³„ API í˜¸ì¶œ ì‹¤íŒ¨:', error);
      }
      
      // ê¸°ë³¸ê°’ ë°˜í™˜ (API ì‹¤íŒ¨ ì‹œ)
      return {
        subscribers: Math.floor(Math.random() * 2000),
        watchHours: Math.floor(Math.random() * 5000),
        views: Math.floor(Math.random() * 100000),
        ctr: 2.0 + Math.random() * 3.0,
        estimatedRevenue: Math.floor(Math.random() * 1000000),
        growthRate: Math.random() * 30 // ìµœê·¼ 7ì¼ê°„ ì„±ì¥ë¥  (%)
      };
    }

    // AI ì»¤ë®¤ë‹ˆí‹° ê´€ë¦¬ì: ëŒ“ê¸€ ë¡œë“œ
    async function loadComments() {
      try {
        // 20ê°œ ì±„ë„ì˜ ëŒ“ê¸€ì„ ê°€ì ¸ì˜´ (Promise.allSettled + 3ì´ˆ ë”œë ˆì´)
        var channels = [];
        for (var i = 1; i <= 20; i++) {
          channels.push({ id: 'channel_' + i, name: 'HANRA STUDIO ì±„ë„ ' + i });
        }

        var commentPromises = channels.map(function(channel, index) {
          return new Promise(function(resolve) {
            setTimeout(function() {
              fetch((window.__API_BASE__ || 'http://localhost:4000') + '/api/youtube/comments/' + channel.id)
                .then(function(response) {
                  if (response.ok) return response.json();
                  return { comments: [] };
                })
                .then(function(data) {
                  resolve({
                    channel: channel,
                    comments: data.comments || []
                  });
                })
                .catch(function(error) {
                  console.error('ëŒ“ê¸€ ë¡œë“œ ì‹¤íŒ¨:', channel.id, error);
                  resolve({ channel: channel, comments: [] });
                });
            }, index * 3000); // 3ì´ˆ ë”œë ˆì´
          });
        });

        var results = await Promise.allSettled(commentPromises);
        var allComments = [];

        results.forEach(function(result) {
          if (result.status === 'fulfilled') {
            var data = result.value;
            data.comments.forEach(function(comment) {
              allComments.push({
                ...comment,
                channelName: data.channel.name,
                channelId: data.channel.id
              });
            });
          }
        });

        // AI ë‹µê¸€ ìƒì„± ë° ì•…í”Œ í•„í„°ë§
        await processCommentsWithAI(allComments);
        
        // ëŒ“ê¸€ ë Œë”ë§
        renderComments(allComments);
      } catch (error) {
        console.error('ëŒ“ê¸€ ë¡œë“œ ì‹¤íŒ¨:', error);
      }
    }

    // AIë¡œ ëŒ“ê¸€ ì²˜ë¦¬ (ë‹µê¸€ ìƒì„± ë° ì•…í”Œ í•„í„°ë§)
    async function processCommentsWithAI(comments) {
      for (var i = 0; i < comments.length; i++) {
        var comment = comments[i];
        
        try {
          // AI ë‹µê¸€ ìƒì„± ë° ì•…í”Œ í•„í„°ë§
          var response = await fetch((window.__API_BASE__ || 'http://localhost:4000') + '/api/comment-analyzer', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              comment_text: comment.text,
              channel_id: comment.channelId,
              channel_name: comment.channelName
            })
          });

          if (response.ok) {
            var data = await response.json();
            comment.ai_reply = data.reply_draft;
            comment.is_spam = data.is_spam;
            comment.sentiment = data.sentiment;
            comment.status = comment.is_spam ? 'spam' : 'pending';
          } else {
            // ê¸°ë³¸ê°’ ì„¤ì •
            comment.ai_reply = null;
            comment.is_spam = false;
            comment.status = 'pending';
          }
        } catch (error) {
          console.error('AI ëŒ“ê¸€ ì²˜ë¦¬ ì‹¤íŒ¨:', error);
          comment.ai_reply = null;
          comment.is_spam = false;
          comment.status = 'pending';
        }
      }
    }

    // ëŒ“ê¸€ ë Œë”ë§
    function renderComments(comments) {
      var container = document.getElementById('commentsList');
      if (!container) return;

      container.innerHTML = '';

      if (comments.length === 0) {
        container.innerHTML = '<div style="text-align: center; color: #999; padding: 40px;">ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }

      comments.forEach(function(comment) {
        var item = document.createElement('div');
        item.className = 'comment-item' + (comment.is_spam ? ' spam' : '');
        item.innerHTML = `
          <div class="comment-header">
            <div>
              <div class="comment-channel">${comment.channelName}</div>
              <div style="font-size: 12px; color: #999; margin-top: 4px;">${comment.author || 'ìµëª…'}</div>
            </div>
            <span class="comment-status ${comment.status}">${comment.status === 'spam' ? 'ìŠ¤íŒ¸' : (comment.status === 'approved' ? 'ìŠ¹ì¸ë¨' : 'ìŠ¹ì¸ ëŒ€ê¸°')}</span>
          </div>
          <div class="comment-text">${comment.text}</div>
          ${comment.ai_reply ? `
            <div class="comment-ai-reply">
              <div class="comment-ai-reply-label">ğŸ¤– AI ìƒì„± ë‹µê¸€ ì´ˆì•ˆ</div>
              <div class="comment-ai-reply-text">${comment.ai_reply}</div>
            </div>
          ` : ''}
          <div class="comment-actions">
            <button class="btn-comment-action approve" onclick="approveComment('${comment.id}')">ìŠ¹ì¸ ë° ê²Œì‹œ</button>
            <button class="btn-comment-action" onclick="editComment('${comment.id}')">ìˆ˜ì •</button>
            <button class="btn-comment-action reject" onclick="rejectComment('${comment.id}')">ê±°ë¶€</button>
          </div>
        `;
        container.appendChild(item);
      });
    }

    // ëŒ“ê¸€ ìŠ¹ì¸
    function approveComment(commentId) {
      fetch((window.__API_BASE__ || 'http://localhost:4000') + '/api/youtube/comments/approve', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ comment_id: commentId })
      })
      .then(function(response) {
        if (response.ok) {
          alert('ëŒ“ê¸€ì´ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
          loadComments(); // ìƒˆë¡œê³ ì¹¨
        }
      })
      .catch(function(error) {
        console.error('ëŒ“ê¸€ ìŠ¹ì¸ ì‹¤íŒ¨:', error);
        alert('ëŒ“ê¸€ ìŠ¹ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      });
    }

    // ëŒ“ê¸€ ê±°ë¶€
    function rejectComment(commentId) {
      if (!confirm('ì´ ëŒ“ê¸€ì„ ê±°ë¶€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      
      fetch((window.__API_BASE__ || 'http://localhost:4000') + '/api/youtube/comments/reject', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ comment_id: commentId })
      })
      .then(function(response) {
        if (response.ok) {
          alert('ëŒ“ê¸€ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.');
          loadComments(); // ìƒˆë¡œê³ ì¹¨
        }
      })
      .catch(function(error) {
        console.error('ëŒ“ê¸€ ê±°ë¶€ ì‹¤íŒ¨:', error);
        alert('ëŒ“ê¸€ ê±°ë¶€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      });
    }

    // ëŒ“ê¸€ ìˆ˜ì •
    function editComment(commentId) {
      var commentItem = document.querySelector('[data-comment-id="' + commentId + '"]');
      if (!commentItem) return;
      
      var replyText = commentItem.querySelector('.comment-ai-reply-text').textContent;
      var newText = prompt('ë‹µê¸€ì„ ìˆ˜ì •í•˜ì„¸ìš”:', replyText);
      
      if (newText && newText !== replyText) {
        // ìˆ˜ì •ëœ ë‹µê¸€ ì €ì¥
        // ì‹¤ì œë¡œëŠ” API í˜¸ì¶œ í•„ìš”
        commentItem.querySelector('.comment-ai-reply-text').textContent = newText;
      }
    }

    // í˜„ì¬ ì‹œê°„ (ì‹œê°„ ë‹¨ìœ„) ë°˜í™˜
    function getCurrentHour() {
      var now = new Date();
      var year = now.getFullYear();
      var month = String(now.getMonth() + 1).padStart(2, '0');
      var day = String(now.getDate()).padStart(2, '0');
      var hour = String(now.getHours()).padStart(2, '0');
      return year + '-' + month + '-' + day + '_' + hour;
    }

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
    function setupEventListeners() {
      document.getElementById('btnApplyGoldenTime').addEventListener('click', applyGoldenTime);
      document.getElementById('btnScheduleUpload').addEventListener('click', scheduleUpload);
      document.getElementById('btnUploadNow').addEventListener('click', uploadNow);
      document.getElementById('btnStartABTest').addEventListener('click', startABTest);

      // ì•ˆì „ ëª¨ë“œ ìŠ¤ìœ„ì¹˜ ì´ë²¤íŠ¸
      var safeModeSwitch = document.getElementById('safeModeSwitch');
      if (safeModeSwitch) {
        safeModeSwitch.addEventListener('change', function() {
          safeModeEnabled = this.checked;
          updateAllChannelQuotas();
          saveChannelQuotas();
        });
      }

      // AI ì¡°ê¸° í™•ì • ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
      document.getElementById('enableEarlyWin').addEventListener('change', function() {
        var settingsDiv = document.getElementById('earlyWinSettings');
        if (this.checked) {
          settingsDiv.style.display = 'block';
        } else {
          settingsDiv.style.display = 'none';
        }
      });

      // í”Œë«í¼ ì²´í¬ë°•ìŠ¤ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
      document.querySelectorAll('.platform-checkbox input[type="checkbox"]').forEach(function(checkbox) {
        checkbox.addEventListener('change', function() {
          var label = this.closest('.platform-checkbox');
          if (this.checked) {
            label.classList.add('checked');
          } else {
            label.classList.remove('checked');
          }
        });
      });
    }

    // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
    function formatNumber(num) {
      if (num === null || num === undefined) return '-';
      return num.toLocaleString('ko-KR');
    }

    function formatDate(dateString) {
      if (!dateString) return '-';
      try {
        var date = new Date(dateString);
        var year = date.getFullYear();
        var month = String(date.getMonth() + 1).padStart(2, '0');
        var day = String(date.getDate()).padStart(2, '0');
        return year + '.' + month + '.' + day;
      } catch (e) {
        return dateString;
      }
    }

    function formatDateTime(date) {
      if (!date) return '-';
      try {
        var d = new Date(date);
        var year = d.getFullYear();
        var month = String(d.getMonth() + 1).padStart(2, '0');
        var day = String(d.getDate()).padStart(2, '0');
        var hours = String(d.getHours()).padStart(2, '0');
        var minutes = String(d.getMinutes()).padStart(2, '0');
        return year + '.' + month + '.' + day + ' ' + hours + ':' + minutes;
      } catch (e) {
        return '-';
      }
    }

    function escapeHtml(text) {
      var div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // ë¡œê·¸ì˜¨ ì‹œìŠ¤í…œ
    var isLoggedIn = false;
    function checkLoginStatus() {
      var loginStatus = localStorage.getItem('isLoggedIn');
      var loginTime = localStorage.getItem('loginTime');
      if (loginStatus === 'true' && loginTime) {
        var loginDate = new Date(loginTime);
        var now = new Date();
        var hoursDiff = (now - loginDate) / (1000 * 60 * 60);
        if (hoursDiff < 24) {
          isLoggedIn = true;
          updateUIForLogin();
          return true;
        }
      }
      isLoggedIn = false;
      updateUIForLogout();
      return false;
    }
    function login() {
      var id = document.getElementById('loginId').value.trim();
      var pw = document.getElementById('loginPw').value.trim();
      if (!id || !pw) {
        alert('IDì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
        return;
      }
      var users = JSON.parse(localStorage.getItem('approvedUsers') || '[]');
      var user = users.find(function(u) {
        return u.id === id && u.password === pw;
      });
      if (user) {
        isLoggedIn = true;
        localStorage.setItem('isLoggedIn', 'true');
        localStorage.setItem('loginTime', new Date().toISOString());
        localStorage.setItem('currentUserId', id);
        updateUIForLogin();
        alert('ë¡œê·¸ì˜¨ë˜ì—ˆìŠµë‹ˆë‹¤.');
        document.getElementById('loginId').value = '';
        document.getElementById('loginPw').value = '';
      } else {
        alert('ìŠ¹ì¸ëœ IDì™€ ë¹„ë°€ë²ˆí˜¸ê°€ ì•„ë‹™ë‹ˆë‹¤.');
      }
    }
    function logout() {
      isLoggedIn = false;
      localStorage.removeItem('isLoggedIn');
      localStorage.removeItem('loginTime');
      localStorage.removeItem('currentUserId');
      updateUIForLogout();
    }
    function updateUIForLogin() {
      document.getElementById('btnLogin').textContent = 'ë¡œê·¸ì•„ì›ƒ';
      document.getElementById('btnLogin').onclick = function() {
        if (confirm('ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          logout();
          alert('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
      };
      document.getElementById('loginId').disabled = true;
      document.getElementById('loginPw').disabled = true;
    }
    function updateUIForLogout() {
      document.getElementById('btnLogin').textContent = 'ë¡œê·¸ì˜¨';
      document.getElementById('btnLogin').onclick = login;
      document.getElementById('loginId').disabled = false;
      document.getElementById('loginPw').disabled = false;
    }
    document.getElementById('btnAdmin').onclick = function() {
      alert('ê´€ë¦¬ í˜ì´ì§€ëŠ” ë©”ì¸(index.html)ì—ì„œ ì´ìš©í•˜ì„¸ìš”.');
    };
    document.getElementById('btnLogin').onclick = login;

    // í”„ë¡œì íŠ¸ ë²„íŠ¼ ê¶Œí•œ ì²´í¬ ë° ì´ë²¤íŠ¸
    (function() {
      function checkAdminPermission() {
        var loginStatus = localStorage.getItem('isLoggedIn');
        var loginTime = localStorage.getItem('loginTime');
        if (loginStatus === 'true' && loginTime) {
          var loginDate = new Date(loginTime);
          var now = new Date();
          var hoursDiff = (now - loginDate) / (1000 * 60 * 60);
          if (hoursDiff < 24) {
            var currentUserId = localStorage.getItem('currentUserId');
            var users = JSON.parse(localStorage.getItem('approvedUsers') || '[]');
            var user = users.find(function(u) { return u.id === currentUserId; });
            return user && user.isAdmin === true;
          }
        }
        return false;
      }
      
      function updateProjectButtonsVisibility() {
        var hasPermission = checkAdminPermission();
        var btnCreate = document.getElementById('btnCreateProject');
        var btnList = document.getElementById('btnProjectList');
        if (btnCreate) {
          btnCreate.style.display = hasPermission ? 'block' : 'none';
          btnCreate.disabled = !hasPermission;
        }
        if (btnList) {
          btnList.style.display = hasPermission ? 'block' : 'none';
          btnList.disabled = !hasPermission;
        }
      }
      
      var btnCreate = document.getElementById('btnCreateProject');
      var btnList = document.getElementById('btnProjectList');
      
      if (btnCreate) {
        btnCreate.onclick = function() {
          if (!checkAdminPermission()) {
            alert('ê´€ë¦¬ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í›„ ê´€ë¦¬ ê¶Œí•œì„ ë°›ì•„ì£¼ì„¸ìš”.');
            return;
          }
          alert('í”„ë¡œì íŠ¸ ìƒì„± ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
        };
      }
      
      if (btnList) {
        btnList.onclick = function() {
          if (!checkAdminPermission()) {
            alert('ê´€ë¦¬ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í›„ ê´€ë¦¬ ê¶Œí•œì„ ë°›ì•„ì£¼ì„¸ìš”.');
            return;
          }
          window.location.href = '/';
        };
      }
      
      updateProjectButtonsVisibility();
      setInterval(updateProjectButtonsVisibility, 5000);
    })();
  </script>
</body>
</html>
