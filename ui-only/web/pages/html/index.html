<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë¡±í¼ í”„ë¡œì íŠ¸ - AI ìë™í™”</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Malgun Gothic", sans-serif;
      background: #f5f5f5;
      color: #333;
      min-height: 100vh;
    }
    .layout { display: flex; min-height: 100vh; padding-top: 0; }
    /* ê³µí†µ Sticky Header */
    .global-header {
      position: sticky;
      top: 0;
      z-index: 1000;
      background: #fff;
      border-bottom: 1px solid #e8ecf4;
      padding: 12px 32px;
      margin: 0 -32px 16px -32px;
    }
    /* í—¤ë” ë¡œê·¸ì¸ í–‰ */
    .login-inline-row {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .login-input {
      height: 32px;
      padding: 0 10px;
      border: 1px solid #cbd5e0;
      border-radius: 4px;
      font-size: 13px;
      box-sizing: border-box;
      box-sizing: border-box;
      transition: background-color 0.2s, border-color 0.2s;
    }
    .login-inline-row .login-input {
      width: 140px;
    }
    .login-input::placeholder { color: #a0aec0; }
    .login-input:disabled {
      background-color: #E0E0E0;
      border-color: #999;
      color: #666;
      pointer-events: none;
      cursor: not-allowed;
    }
    .btn-admin {
      padding: 0 12px;
      height: 32px;
      background: #e0e0e0;
      color: #333;
      border: 1px solid #c0c0c0;
      border-radius: 4px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
    }
    .btn-admin:hover { background: #d5d5d5; }
    .btn-login {
      padding: 0 12px;
      height: 32px;
      background: #e0e0e0;
      color: #333;
      border: 1px solid #c0c0c0;
      border-radius: 4px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
    }
    .btn-login:hover { background: #d5d5d5; }
    .btn-login:disabled {
      background: #ccc;
      cursor: not-allowed;
      opacity: 0.6;
    }
    .locked-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      z-index: 9998;
      display: none;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 24px;
      font-weight: 700;
      pointer-events: none;
    }
    .locked-overlay.show {
      display: flex;
    }
    .project-actions {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-bottom: 16px;
    }
    .project-actions label { display: flex; align-items: center; gap: 6px; font-size: 14px; cursor: pointer; }
    .btn-delete-selected {
      padding: 8px 16px;
      background: #e53935;
      color: #fff;
      border: none;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
    }
    .btn-delete-selected:hover { background: #c62828; }
    .btn-delete-selected:disabled { background: #ccc; cursor: not-allowed; }
    .project-card input[type="checkbox"] { 
      position: absolute; 
      top: 16px; 
      left: 16px; 
      width: 18px; 
      height: 18px; 
      cursor: pointer;
      z-index: 2;
    }

    .sidebar {
      width: 300px;
      background: linear-gradient(180deg, #fafbff 0%, #f2f4f8 100%);
      border-right: 1px solid #e8ecf4;
      padding: 0 16px 24px;
      flex-shrink: 0;
    }
    .sidebar-logo {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      font-weight: 700;
      font-size: 1.5rem;
      letter-spacing: 0.05em;
      color: #2d3748;
      margin-top: 8px;
      margin-bottom: 20px;
      padding-left: 4px;
      text-align: left;
    }
    .sidebar-card {
      background: #fff;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.06);
      border: 1px solid rgba(0,0,0,0.04);
    }
    /* í˜„ì¬ í”„ë¡œì íŠ¸ */
    .project-label {
      font-size: 12px;
      color: #718096;
      margin-bottom: 6px;
    }
    .project-name-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 14px;
    }
    .project-name {
      font-size: 16px;
      font-weight: 700;
      color: #1a202c;
    }
    .project-name-edit {
      color: #718096;
      cursor: pointer;
      font-size: 14px;
    }
    .project-name-edit:hover {
      color: #3182ce;
    }
    /* í”„ë¡œì íŠ¸ ì•¡ì…˜ í•œ ì¤„ ë°°ì¹˜ */
    .project-actions-row {
      display: flex;
      gap: 6px;
      margin-top: 8px;
    }
    .sidebar-btn-inline {
      flex: 1;
      padding: 8px 12px;
      border: none;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }
    .sidebar-btn-inline-primary {
      background: linear-gradient(135deg, #805ad5 0%, #6b46c1 100%);
      color: #fff;
    }
    .sidebar-btn-inline-primary:hover {
      background: linear-gradient(135deg, #6b46c1 0%, #553c9a 100%);
    }
    .sidebar-btn-inline-secondary {
      background: #fff;
      color: #2d3748;
      border: 1px solid #e2e8f0;
    }
    .sidebar-btn-inline-secondary:hover {
      background: #f7fafc;
      border-color: #cbd5e0;
    }
    .sidebar-card-title {
      font-size: 13px;
      font-weight: 700;
      color: #4a5568;
      letter-spacing: -0.02em;
      margin-bottom: 10px;
    }
    .sidebar-card-desc {
      font-size: 13px;
      color: #718096;
      line-height: 1.5;
      margin-bottom: 10px;
    }
    .sidebar-card-link {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      font-weight: 600;
      color: #3182ce;
      text-decoration: none;
      margin-bottom: 8px;
    }
    .sidebar-card-link:hover { color: #2b6cb0; text-decoration: underline; }
    .sidebar-card-date { font-size: 12px; color: #a0aec0; }
    .sidebar-section-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
    }
    .sidebar-section-header .section-title {
      font-size: 14px;
      font-weight: 700;
      color: #2d3748;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .sidebar-section-header .section-title .star-icon {
      color: #63b3ed;
      font-size: 14px;
    }
    .btn-list-small {
      padding: 4px 10px;
      font-size: 11px;
      color: #555;
      background: #f0f0f0;
      border: 1px solid #ddd;
      border-radius: 6px;
      cursor: pointer;
      margin-left: auto;
    }
    .btn-list-small:hover { background: #e5e5e5; }
    .update-entry-card {
      background: #f0f4f8;
      border-radius: 10px;
      padding: 14px;
      margin-bottom: 10px;
      border: 1px solid #e8ecf4;
    }
    .update-entry-card .entry-title {
      font-size: 14px;
      font-weight: 700;
      color: #222;
      margin-bottom: 6px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .update-entry-card .entry-desc {
      font-size: 13px;
      color: #555;
      line-height: 1.4;
      margin-bottom: 8px;
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      line-clamp: 2;
      -webkit-box-orient: vertical;
    }
    .update-entry-card .entry-date {
      font-size: 12px;
      color: #718096;
    }
    .update-entry-card .entry-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 8px;
    }
    .entry-delete-btn {
      padding: 4px 10px;
      font-size: 11px;
      color: #c53030;
      background: #fff;
      border: 1px solid #feb2b2;
      border-radius: 6px;
      cursor: pointer;
    }
    .entry-delete-btn:hover { background: #fff5f5; }

    .main {
      flex: 1;
      padding: 24px 32px 40px;
      overflow-y: auto;
    }
    .header-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 16px;
      margin-top: 0;
      padding-top: 0;
    }
    .title-area h1 {
      margin-top: 0;
    }
    .header-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 8px;
    }
    .title-area {
      flex: 1;
    }
    .title-area h1 {
      font-size: 24px;
      font-weight: 700;
      color: #222;
      margin-bottom: 4px;
      margin-top: 0;
      line-height: 1.3;
    }
    .title-area .subtitle { 
      font-size: 14px; 
      color: #666;
      margin: 0;
      line-height: 1.4;
    }
    .btn-icon {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      color: #333;
      cursor: pointer;
      text-decoration: none;
    }
    .btn-icon:hover { background: #f8f8f8; }
    .header-buttons { 
      display: flex; 
      gap: 8px; 
      align-items: center;
      padding-top: 28px;
      margin-top: 0;
    }

    .info-banner {
      background: #fffde7;
      border: 1px solid #f5e642;
      padding: 12px 16px;
      font-size: 13px;
      color: #b71c1c;
      margin-bottom: 20px;
      border-radius: 6px;
    }
    .search-row {
      display: flex;
      gap: 12px;
      margin-bottom: 24px;
    }
    .search-input {
      flex: 1;
      padding: 12px 16px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
      background: #e8e8e8;
      color: #333;
    }
    .search-input::placeholder { color: #888; }
    .btn-primary {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 20px;
      background: #e53935;
      color: #fff;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
    }
    .btn-primary:hover { background: #c62828; }

    .project-cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 16px;
    }
    .project-card {
      background: #fff;
      border: 1px solid #e8e8e8;
      border-radius: 8px;
      padding: 20px;
      position: relative;
      transition: box-shadow 0.2s;
    }
    .project-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
    .project-card .trash-icon {
      position: absolute;
      top: 16px;
      right: 16px;
      font-size: 16px;
      color: #666;
      cursor: pointer;
    }
    .project-card .project-title {
      font-size: 16px;
      font-weight: 700;
      color: #333;
      margin-bottom: 8px;
      padding-left: 30px;
      padding-right: 28px;
      min-height: 20px;
    }
    .project-card .project-work-info {
      font-size: 12px;
      color: #3182ce;
      margin-bottom: 8px;
      padding-left: 30px;
      font-weight: 600;
    }
    .project-card .project-tag {
      display: inline-block;
      font-size: 11px;
      color: #3182ce;
      margin-bottom: 10px;
    }
    .project-card .meta {
      font-size: 12px;
      color: #666;
    }
    .project-card .meta span { display: block; margin-bottom: 2px; }
    .project-card.search-match { background: #e3f2fd; border-color: #90caf9; }

    /* ëª¨ë‹¬ ê³µí†µ */
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.4);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    .modal-overlay.show { display: flex; }
    .modal {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
      width: 90%;
      max-width: 480px;
      padding: 24px;
      position: relative;
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 16px;
    }
    .modal-title { font-size: 18px; font-weight: 700; color: #222; }
    .modal-close {
      width: 28px;
      height: 28px;
      border: none;
      background: #f0f0f0;
      border-radius: 6px;
      font-size: 18px;
      cursor: pointer;
      line-height: 1;
      color: #666;
    }
    .modal-close:hover { background: #e0e0e0; }
    .modal-desc { font-size: 13px; color: #666; margin-bottom: 20px; }
    .form-group { margin-bottom: 16px; }
    .form-label { display: block; font-size: 13px; font-weight: 600; color: #333; margin-bottom: 6px; }
    .form-label .required { color: #e53935; }
    .form-input {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 14px;
    }
    .form-input:focus { outline: none; border-color: #3182ce; }
    .modal-actions {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      margin-top: 24px;
    }
    .btn-cancel {
      padding: 10px 20px;
      border: 1px solid #ccc;
      background: #fff;
      border-radius: 8px;
      font-size: 14px;
      color: #555;
      cursor: pointer;
    }
    .btn-cancel:hover { background: #f5f5f5; }
    .btn-create {
      padding: 10px 20px;
      border: none;
      background: #e91e63;
      color: #fff;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
    }
    .btn-create:hover { background: #c2185b; }

    .notice-list-wrap { max-height: 55vh; overflow-y: auto; }
    .info-banner-row {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      margin-bottom: 20px;
    }
    .info-banner-row .info-banner { flex: 1; margin-bottom: 0; }
    .board-modal .modal { max-width: 950px; width: 92%; max-height: 85vh; display: flex; flex-direction: column; }
    .board-modal .modal-body { overflow-y: auto; flex: 1; min-height: 0; }
    .board-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }
    .board-table th, .board-table td {
      border: 1px solid #e2e8f0;
      padding: 12px 14px;
      text-align: left;
      vertical-align: top;
    }
    .board-table th {
      background: #f7fafc;
      font-weight: 600;
      color: #4a5568;
    }
    .board-table tr:hover { background: #fafafa; }
    .board-table .col-no { width: 52px; text-align: center; }
    .board-table .col-type { width: 95px; }
    .board-table .col-title { min-width: 180px; }
    .board-table .col-content { min-width: 280px; }
    .board-table .col-date { width: 105px; }
    .admin-modal .modal { max-width: 600px; }
    .admin-section { margin-bottom: 24px; padding-bottom: 20px; border-bottom: 1px solid #e2e8f0; }
    .admin-section:last-child { border-bottom: none; }
    .admin-section-title { font-size: 16px; font-weight: 700; color: #2d3748; margin-bottom: 12px; }
    .admin-form-row { display: flex; gap: 12px; margin-bottom: 12px; align-items: center; }
    .admin-form-row label { min-width: 100px; font-size: 14px; color: #4a5568; }
    .admin-form-row input { flex: 1; padding: 8px 12px; border: 1px solid #cbd5e0; border-radius: 6px; font-size: 14px; }
    .btn-save { padding: 8px 16px; background: #48bb78; color: #fff; border: none; border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer; }
    .btn-save:hover { background: #38a169; }
  </style>
</head>
<body>
  <div class="layout">
    <aside class="sidebar">
      <div class="sidebar-logo">HANRA STUDIO</div>

      <!-- í˜„ì¬ í”„ë¡œì íŠ¸ -->
      <div class="sidebar-card">
        <div class="project-label">í˜„ì¬ í”„ë¡œì íŠ¸</div>
        <div class="project-name-row">
          <span class="project-name">ìƒˆë¡œìš´ í”„ë¡œì íŠ¸</span>
          <span class="project-name-edit" title="ì´ë¦„ ìˆ˜ì •">âœ</span>
        </div>
        <div class="project-actions-row">
          <button type="button" class="sidebar-btn-inline sidebar-btn-inline-primary" id="btnCreateProject">
            Pìƒì„±
          </button>
          <button type="button" class="sidebar-btn-inline sidebar-btn-inline-secondary" id="btnProjectList">
            Pëª©ë¡
          </button>
        </div>
      </div>

      <div class="sidebar-card">
        <div class="sidebar-section-header">
          <span class="section-title"><span class="star-icon">âœ¦</span> ì—…ë°ì´íŠ¸ ì‚¬í•­</span>
          <button type="button" class="btn-list-small" id="btnUpdateList">ëª©ë¡</button>
        </div>
        <div class="notice-list-wrap">
          <div id="sidebarUpdateList"></div>
        </div>
      </div>
    </aside>

    <main class="main">
      <div class="header-row">
        <div class="title-area">
          <h1>ë¡±í¼ í”„ë¡œì íŠ¸</h1>
          <p class="subtitle">ì‘ì—…í•œ ë‚´ìš©ì„ ì €ì¥í•˜ê³  ê´€ë¦¬í•˜ì„¸ìš”</p>
        </div>
        <div class="header-right">
          <div class="login-inline-row">
            <input type="text" class="login-input" id="loginId" placeholder="ID">
            <input type="password" class="login-input" id="loginPw" placeholder="Password">
            <button type="button" class="btn-admin" id="btnAdmin">ê´€ë¦¬</button>
            <button type="button" class="btn-login" id="btnLogin">ë¡œê·¸ì˜¨</button>
          </div>
          <div class="header-buttons">
            <button type="button" class="btn-icon" id="btnNotice">ğŸ“¢ ê³µì§€ê¸€</button>
            <a href="ai-automation-project.html" class="btn-icon">ğŸ“Œ ì£¼ì œì¶”ì²œ</a>
          </div>
        </div>
      </div>


      <div class="search-row">
        <input type="text" class="search-input" id="searchInput" placeholder="í”„ë¡œì íŠ¸ ì´ë¦„ ë˜ëŠ” ì„¤ëª…ìœ¼ë¡œ ê²€ìƒ‰...">
        <button type="button" class="btn-primary" id="btnNewProject">â• ìƒˆ í”„ë¡œì íŠ¸ ë§Œë“¤ê¸°</button>
      </div>

      <div class="project-actions">
        <label><input type="checkbox" id="selectAllProjects"> ì „ì²´ ì„ íƒ</label>
        <button type="button" class="btn-delete-selected" id="btnDeleteSelected" disabled>ì„ íƒ ì‚­ì œ</button>
      </div>

      <div class="project-cards-grid" id="projectCardsGrid">
        <div class="project-card" data-name="ê²½ì œí•™" data-description="ê²½ì œ">
          <input type="checkbox" class="project-checkbox">
          <span class="trash-icon" onclick="deleteProject(this)">ğŸ—‘ï¸</span>
          <div class="project-title">ê²½ì œí•™</div>
          <span class="project-tag">ìµœê·¼ ì‘ì—…</span>
          <div class="meta">
            <span class="meta-modified">ìˆ˜ì •: 2026. 1. 13. ì˜¤í›„ 2:30:15</span>
            <span class="meta-created">ìƒì„±: 2026. 1. 10. ì˜¤ì „ 9:22:00</span>
          </div>
        </div>
        <div class="project-card" data-name="ìš°ì£¼" data-description="ìš°ì£¼">
          <input type="checkbox" class="project-checkbox">
          <span class="trash-icon" onclick="deleteProject(this)">ğŸ—‘ï¸</span>
          <div class="project-title">ìš°ì£¼</div>
          <div class="meta">
            <span class="meta-modified">ìˆ˜ì •: 2026. 1. 12. ì˜¤í›„ 4:15:00</span>
            <span class="meta-created">ìƒì„±: 2026. 1. 12. ì˜¤ì „ 11:00:00</span>
          </div>
        </div>
        <div class="project-card" data-name="sdfsdfwef" data-description="">
          <input type="checkbox" class="project-checkbox">
          <span class="trash-icon" onclick="deleteProject(this)">ğŸ—‘ï¸</span>
          <div class="project-title">sdfsdfwef</div>
          <div class="meta">
            <span class="meta-modified">ìˆ˜ì •: 2026. 1. 12. ì˜¤ì „ 10:30:00</span>
            <span class="meta-created">ìƒì„±: 2026. 1. 11. ì˜¤í›„ 3:00:00</span>
          </div>
        </div>
        <div class="project-card" data-name="123123123" data-description="">
          <input type="checkbox" class="project-checkbox">
          <span class="trash-icon" onclick="deleteProject(this)">ğŸ—‘ï¸</span>
          <div class="project-title">123123123</div>
          <div class="meta">
            <span class="meta-modified">ìˆ˜ì •: 2026. 1. 11. ì˜¤í›„ 1:20:00</span>
            <span class="meta-created">ìƒì„±: 2026. 1. 11. ì˜¤ì „ 9:00:00</span>
          </div>
        </div>
        <div class="project-card" data-name="test" data-description="">
          <input type="checkbox" class="project-checkbox">
          <span class="trash-icon" onclick="deleteProject(this)">ğŸ—‘ï¸</span>
          <div class="project-title">test</div>
          <div class="meta">
            <span class="meta-modified">ìˆ˜ì •: 2026. 1. 10. ì˜¤í›„ 5:45:00</span>
            <span class="meta-created">ìƒì„±: 2026. 1. 10. ì˜¤ì „ 8:00:00</span>
          </div>
        </div>
        <div class="project-card" data-name="ìš°ì£¼" data-description="ìš°ì£¼">
          <input type="checkbox" class="project-checkbox">
          <span class="trash-icon" onclick="deleteProject(this)">ğŸ—‘ï¸</span>
          <div class="project-title">ìš°ì£¼</div>
          <div class="meta">
            <span class="meta-modified">ìˆ˜ì •: 2026. 1. 9. ì˜¤í›„ 2:00:00</span>
            <span class="meta-created">ìƒì„±: 2026. 1. 9. ì˜¤ì „ 10:00:00</span>
          </div>
        </div>
        <div class="project-card" data-name="ê²½ì œí•™" data-description="ê²½ì œ">
          <input type="checkbox" class="project-checkbox">
          <span class="trash-icon" onclick="deleteProject(this)">ğŸ—‘ï¸</span>
          <div class="project-title">ê²½ì œí•™</div>
          <div class="meta">
            <span class="meta-modified">ìˆ˜ì •: 2026. 1. 8. ì˜¤í›„ 4:30:00</span>
            <span class="meta-created">ìƒì„±: 2026. 1. 8. ì˜¤ì „ 9:15:00</span>
          </div>
        </div>
        <div class="project-card" data-name="1ì›”12ì¼ ìš°ì£¼" data-description="ìš°ì£¼">
          <input type="checkbox" class="project-checkbox">
          <span class="trash-icon" onclick="deleteProject(this)">ğŸ—‘ï¸</span>
          <div class="project-title">1ì›”12ì¼ ìš°ì£¼</div>
          <div class="meta">
            <span class="meta-modified">ìˆ˜ì •: 2026. 1. 12. ì˜¤í›„ 6:00:00</span>
            <span class="meta-created">ìƒì„±: 2026. 1. 12. ì˜¤í›„ 1:00:00</span>
          </div>
        </div>
        <div class="project-card" data-name="0113 ìš°ì£¼" data-description="ìš°ì£¼">
          <input type="checkbox" class="project-checkbox">
          <span class="trash-icon" onclick="deleteProject(this)">ğŸ—‘ï¸</span>
          <div class="project-title">0113 ìš°ì£¼</div>
          <div class="meta">
            <span class="meta-modified">ìˆ˜ì •: 2026. 1. 13. ì˜¤ì „ 9:00:00</span>
            <span class="meta-created">ìƒì„±: 2026. 1. 13. ì˜¤ì „ 8:30:00</span>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- ê³µì§€ê¸€/ì—…ë°ì´íŠ¸ ì‚¬í•­ ì…ë ¥ ëª¨ë‹¬ -->
  <div class="modal-overlay" id="noticeModal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">ê³µì§€Â·ì—…ë°ì´íŠ¸ ë“±ë¡</h2>
        <button type="button" class="modal-close" data-close="noticeModal">&times;</button>
      </div>
      <p class="modal-desc">ìœ í˜•ì„ ì„ íƒí•˜ê³  ë‚´ìš©ì„ ì…ë ¥í•œ ë’¤ ë“±ë¡í•˜ë©´ ì•ˆë‚´ì‚¬í•­ê³¼ ì—…ë°ì´íŠ¸ ì‚¬í•­ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
      <div class="form-group">
        <label class="form-label">ìœ í˜•</label>
        <div style="display:flex;gap:16px;">
          <label><input type="radio" name="noticeType" value="ê³µì§€ê¸€" checked> ê³µì§€ê¸€</label>
          <label><input type="radio" name="noticeType" value="ì—…ë°ì´íŠ¸ ì‚¬í•­"> ì—…ë°ì´íŠ¸ ì‚¬í•­</label>
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">ë‚´ìš©</label>
        <textarea id="noticeText" class="form-input" rows="4" placeholder="ì•ˆë‚´ ë˜ëŠ” ì—…ë°ì´íŠ¸ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn-cancel" data-close="noticeModal">ì·¨ì†Œ</button>
        <button type="button" class="btn-create" id="noticeSubmit">ë“±ë¡</button>
      </div>
    </div>
  </div>

  <!-- ì—…ë°ì´íŠ¸/ì•ˆë‚´ ëª©ë¡ ê²Œì‹œíŒ ëª¨ë‹¬ -->
  <div class="modal-overlay board-modal" id="listModal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title" id="listModalTitle">ëª©ë¡</h2>
        <button type="button" class="modal-close" data-close="listModal">&times;</button>
      </div>
      <div class="modal-body" id="listModalBody">
        <table class="board-table">
          <thead>
            <tr>
              <th class="col-no">ë²ˆí˜¸</th>
              <th class="col-type">ìœ í˜•</th>
              <th class="col-title">ì œëª©</th>
              <th class="col-content">ë‚´ìš©</th>
              <th class="col-date">ë‚ ì§œ</th>
            </tr>
          </thead>
          <tbody id="listModalTbody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- ê´€ë¦¬ í˜ì´ì§€ ëª¨ë‹¬ -->
  <div class="modal-overlay admin-modal" id="adminModal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">íšŒì› ì¸ì¦ ê´€ë¦¬</h2>
        <button type="button" class="modal-close" data-close="adminModal">&times;</button>
      </div>
      <div class="modal-body" style="max-height:65vh;overflow-y:auto;">
        <div class="admin-section">
          <div class="admin-section-title">ìŠ¹ì¸ëœ ì‚¬ìš©ì ê´€ë¦¬</div>
          <div style="margin-bottom: 16px;">
            <div class="admin-form-row">
              <label>ìƒˆ ì‚¬ìš©ì ID</label>
              <input type="text" id="newUserId" placeholder="ì‚¬ìš©ì ID">
            </div>
            <div class="admin-form-row">
              <label>ìƒˆ ì‚¬ìš©ì PW</label>
              <input type="password" id="newUserPw" placeholder="ë¹„ë°€ë²ˆí˜¸">
            </div>
            <button type="button" class="btn-save" onclick="approveUser()" style="margin-top: 8px;">ì‚¬ìš©ì ìŠ¹ì¸</button>
          </div>
          <div style="margin-top: 20px;">
            <div style="font-weight: 600; margin-bottom: 12px; font-size: 14px;">ìŠ¹ì¸ëœ ì‚¬ìš©ì ëª©ë¡</div>
            <table class="board-table" style="font-size: 12px;">
              <thead>
                <tr>
                  <th class="col-no" style="width: 50px;">ë²ˆí˜¸</th>
                  <th class="col-title" style="min-width: 120px;">ID</th>
                  <th class="col-title" style="min-width: 150px;">PW</th>
                  <th class="col-date" style="width: 150px;">ìŠ¹ì¸ì¼ì‹œ</th>
                  <th style="width: 80px;">ìˆ˜ì •</th>
                  <th style="width: 80px;">ì‚­ì œ</th>
                </tr>
              </thead>
              <tbody id="approvedUsersTable"></tbody>
            </table>
          </div>
        </div>
        <div class="admin-section">
          <div class="admin-section-title">ë¡œê·¸ì¸ ì •ë³´</div>
          <div class="admin-form-row">
            <label>ê´€ë¦¬ì ID</label>
            <input type="text" id="adminId" placeholder="admin">
          </div>
          <div class="admin-form-row">
            <label>ê´€ë¦¬ì PW</label>
            <input type="password" id="adminPw" placeholder="********">
          </div>
          <button type="button" class="btn-save" onclick="saveAdminLogin()">ì €ì¥</button>
        </div>
        <div class="admin-section">
          <div class="admin-section-title">API ì¸ì¦ ê´€ë¦¬</div>
          <div class="admin-form-row">
            <label>OpenAI API</label>
            <input type="text" id="apiOpenAI" placeholder="sk-...">
          </div>
          <div class="admin-form-row">
            <label>Google API</label>
            <input type="text" id="apiGoogle" placeholder="AIza...">
          </div>
          <div class="admin-form-row">
            <label>ê¸°íƒ€ API 1</label>
            <input type="text" id="apiOther1" placeholder="API Key">
          </div>
          <div class="admin-form-row">
            <label>ê¸°íƒ€ API 2</label>
            <input type="text" id="apiOther2" placeholder="API Key">
          </div>
          <button type="button" class="btn-save" onclick="saveAdminAPIs()">ì €ì¥</button>
        </div>
        <div class="admin-section">
          <div class="admin-section-title">ğŸ‘¥ ìºë¦­í„° ê´€ë¦¬</div>
          <p style="font-size: 12px; color: #666; margin-bottom: 16px;">ì˜ìƒ ì œì‘ì— ì‚¬ìš©í•  ìºë¦­í„° ì–¼êµ´ì„ ë“±ë¡í•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
          <button type="button" class="btn-save" onclick="openCharacterManager()">ìºë¦­í„° ê´€ë¦¬ ì—´ê¸°</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ìºë¦­í„° ì•„ì…‹ ë§¤ë‹ˆì € ëª¨ë‹¬ -->
  <div id="characterManagerModal" class="character-manager-modal" style="display: none;">
    <div class="character-manager-overlay" onclick="closeCharacterManager()"></div>
    <div class="character-manager-content">
      <div class="character-manager-header">
        <h2>ğŸ‘¥ ìºë¦­í„° ì•„ì…‹ ë§¤ë‹ˆì €</h2>
        <button type="button" class="character-manager-close" onclick="closeCharacterManager()">Ã—</button>
      </div>
      <div class="character-manager-body">
        <!-- ì„±ìš°/í”„ë¦¬ì  í„° (1ì¸) -->
        <div class="character-section">
          <div class="character-section-title">ğŸ¤ ì„±ìš°/í”„ë¦¬ì  í„° (1ì¸)</div>
          <div class="character-slot-grid">
            <div class="character-slot" data-role="narrator" data-index="0">
              <div class="character-slot-upload">
                <input type="file" class="character-upload-input" accept="image/*" data-role="narrator" data-index="0" style="display: none;" />
                <div class="character-slot-placeholder">
                  <div class="character-upload-icon">+</div>
                  <div class="character-upload-text">ì´ë¯¸ì§€ ì—…ë¡œë“œ</div>
                </div>
                <img class="character-slot-image" style="display: none;" />
                <div class="character-slot-info" style="display: none;">
                  <div class="character-slot-name"></div>
                  <button type="button" class="character-slot-delete" onclick="deleteCharacter('narrator', 0)">ì‚­ì œ</button>
                </div>
              </div>
              <!-- AI ë¦½ì‹±í¬ í† ê¸€ ìŠ¤ìœ„ì¹˜ (ì„±ìš° ì „ìš©) -->
              <div class="lipsync-toggle-section">
                <div class="lipsync-toggle-row">
                  <label class="lipsync-toggle-label">
                    <span class="lipsync-toggle-text">AI ë¦½ì‹±í¬ ë¹„ë””ì˜¤ ìƒì„± (ì¸íŠ¸ë¡œ/ì•„ì›ƒíŠ¸ë¡œìš©)</span>
                    <span class="lipsync-toggle-tooltip" title="í™œì„±í™” ì‹œ, TTS ìŒì„±ì— ë§ì¶° ì…ëª¨ì–‘ì´ ì›€ì§ì´ëŠ” ì˜ìƒì´ ìƒì„±ë©ë‹ˆë‹¤. ì œì‘ ì‹œê°„ì´ í¬ê²Œ ì¦ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.">â„¹ï¸</span>
                  </label>
                  <div class="lipsync-toggle-switch" id="lipsyncToggleNarrator0" onclick="toggleLipsync('narrator', 0)">
                    <div class="lipsync-toggle-thumb"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ì£¼ì¸ê³µ (4ì¸) -->
        <div class="character-section">
          <div class="character-section-title">ğŸ¦¸â€â™‚ï¸ ì£¼ì¸ê³µ (4ì¸)</div>
          <div class="character-slot-grid">
            <div class="character-slot" data-role="main" data-index="0">
              <div class="character-slot-label">Main A</div>
              <div class="character-slot-upload">
                <input type="file" class="character-upload-input" accept="image/*" data-role="main" data-index="0" style="display: none;" />
                <div class="character-slot-placeholder">
                  <div class="character-upload-icon">+</div>
                  <div class="character-upload-text">ì´ë¯¸ì§€ ì—…ë¡œë“œ</div>
                </div>
                <img class="character-slot-image" style="display: none;" />
                <div class="character-slot-info" style="display: none;">
                  <div class="character-slot-name"></div>
                  <button type="button" class="character-slot-delete" onclick="deleteCharacter('main', 0)">ì‚­ì œ</button>
                </div>
              </div>
            </div>
            <div class="character-slot" data-role="main" data-index="1">
              <div class="character-slot-label">Main B</div>
              <div class="character-slot-upload">
                <input type="file" class="character-upload-input" accept="image/*" data-role="main" data-index="1" style="display: none;" />
                <div class="character-slot-placeholder">
                  <div class="character-upload-icon">+</div>
                  <div class="character-upload-text">ì´ë¯¸ì§€ ì—…ë¡œë“œ</div>
                </div>
                <img class="character-slot-image" style="display: none;" />
                <div class="character-slot-info" style="display: none;">
                  <div class="character-slot-name"></div>
                  <button type="button" class="character-slot-delete" onclick="deleteCharacter('main', 1)">ì‚­ì œ</button>
                </div>
              </div>
            </div>
            <div class="character-slot" data-role="main" data-index="2">
              <div class="character-slot-label">Main C</div>
              <div class="character-slot-upload">
                <input type="file" class="character-upload-input" accept="image/*" data-role="main" data-index="2" style="display: none;" />
                <div class="character-slot-placeholder">
                  <div class="character-upload-icon">+</div>
                  <div class="character-upload-text">ì´ë¯¸ì§€ ì—…ë¡œë“œ</div>
                </div>
                <img class="character-slot-image" style="display: none;" />
                <div class="character-slot-info" style="display: none;">
                  <div class="character-slot-name"></div>
                  <button type="button" class="character-slot-delete" onclick="deleteCharacter('main', 2)">ì‚­ì œ</button>
                </div>
              </div>
            </div>
            <div class="character-slot" data-role="main" data-index="3">
              <div class="character-slot-label">Main D</div>
              <div class="character-slot-upload">
                <input type="file" class="character-upload-input" accept="image/*" data-role="main" data-index="3" style="display: none;" />
                <div class="character-slot-placeholder">
                  <div class="character-upload-icon">+</div>
                  <div class="character-upload-text">ì´ë¯¸ì§€ ì—…ë¡œë“œ</div>
                </div>
                <img class="character-slot-image" style="display: none;" />
                <div class="character-slot-info" style="display: none;">
                  <div class="character-slot-name"></div>
                  <button type="button" class="character-slot-delete" onclick="deleteCharacter('main', 3)">ì‚­ì œ</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ì¡°ì—° (4ì¸) -->
        <div class="character-section">
          <div class="character-section-title">ğŸ‘¥ ì¡°ì—° (4ì¸)</div>
          <div class="character-slot-grid">
            <div class="character-slot" data-role="sub" data-index="0">
              <div class="character-slot-label">Sub A</div>
              <div class="character-slot-upload">
                <input type="file" class="character-upload-input" accept="image/*" data-role="sub" data-index="0" style="display: none;" />
                <div class="character-slot-placeholder">
                  <div class="character-upload-icon">+</div>
                  <div class="character-upload-text">ì´ë¯¸ì§€ ì—…ë¡œë“œ</div>
                </div>
                <img class="character-slot-image" style="display: none;" />
                <div class="character-slot-info" style="display: none;">
                  <div class="character-slot-name"></div>
                  <button type="button" class="character-slot-delete" onclick="deleteCharacter('sub', 0)">ì‚­ì œ</button>
                </div>
              </div>
            </div>
            <div class="character-slot" data-role="sub" data-index="1">
              <div class="character-slot-label">Sub B</div>
              <div class="character-slot-upload">
                <input type="file" class="character-upload-input" accept="image/*" data-role="sub" data-index="1" style="display: none;" />
                <div class="character-slot-placeholder">
                  <div class="character-upload-icon">+</div>
                  <div class="character-upload-text">ì´ë¯¸ì§€ ì—…ë¡œë“œ</div>
                </div>
                <img class="character-slot-image" style="display: none;" />
                <div class="character-slot-info" style="display: none;">
                  <div class="character-slot-name"></div>
                  <button type="button" class="character-slot-delete" onclick="deleteCharacter('sub', 1)">ì‚­ì œ</button>
                </div>
              </div>
            </div>
            <div class="character-slot" data-role="sub" data-index="2">
              <div class="character-slot-label">Sub C</div>
              <div class="character-slot-upload">
                <input type="file" class="character-upload-input" accept="image/*" data-role="sub" data-index="2" style="display: none;" />
                <div class="character-slot-placeholder">
                  <div class="character-upload-icon">+</div>
                  <div class="character-upload-text">ì´ë¯¸ì§€ ì—…ë¡œë“œ</div>
                </div>
                <img class="character-slot-image" style="display: none;" />
                <div class="character-slot-info" style="display: none;">
                  <div class="character-slot-name"></div>
                  <button type="button" class="character-slot-delete" onclick="deleteCharacter('sub', 2)">ì‚­ì œ</button>
                </div>
              </div>
            </div>
            <div class="character-slot" data-role="sub" data-index="3">
              <div class="character-slot-label">Sub D</div>
              <div class="character-slot-upload">
                <input type="file" class="character-upload-input" accept="image/*" data-role="sub" data-index="3" style="display: none;" />
                <div class="character-slot-placeholder">
                  <div class="character-upload-icon">+</div>
                  <div class="character-upload-text">ì´ë¯¸ì§€ ì—…ë¡œë“œ</div>
                </div>
                <img class="character-slot-image" style="display: none;" />
                <div class="character-slot-info" style="display: none;">
                  <div class="character-slot-name"></div>
                  <button type="button" class="character-slot-delete" onclick="deleteCharacter('sub', 3)">ì‚­ì œ</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="character-upload-guide">
          <div class="guide-title">ğŸ“‹ ì—…ë¡œë“œ ê°€ì´ë“œ</div>
          <ul class="guide-list">
            <li>ì •ë©´ì„ ë°”ë¼ë³´ê³ , ì´ëª©êµ¬ë¹„ê°€ ëšœë ·í•˜ê²Œ ë‚˜ì˜¨ ê³ í•´ìƒë„ ë…ì‚¬ì§„ì„ ì˜¬ë ¤ì£¼ì„¸ìš”.</li>
            <li>ì–¼êµ´ì´ ëª…í™•í•˜ê²Œ ë³´ì´ê³ , ë°°ê²½ì€ ë‹¨ìƒ‰ì´ê±°ë‚˜ ê¹”ë”í•œ ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.</li>
            <li>ìµœì†Œ 512x512 í”½ì…€ ì´ìƒì˜ í•´ìƒë„ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.</li>
            <li>ì—…ë¡œë“œëœ ì´ë¯¸ì§€ëŠ” ìë™ìœ¼ë¡œ ì–¼êµ´ íŠ¹ì§•(Embedding)ì´ ì¶”ì¶œë˜ì–´ ì €ì¥ë©ë‹ˆë‹¤.</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- ìƒˆ í”„ë¡œì íŠ¸ ë§Œë“¤ê¸° ëª¨ë‹¬ -->
  <div class="modal-overlay" id="newProjectModal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">ìƒˆ í”„ë¡œì íŠ¸ ë§Œë“¤ê¸°</h2>
        <button type="button" class="modal-close" data-close="newProjectModal">&times;</button>
      </div>
      <p class="modal-desc">í”„ë¡œì íŠ¸ ì´ë¦„ì„ ì…ë ¥í•˜ê³  ì‘ì—…ì„ ì‹œì‘í•˜ì„¸ìš”</p>
      <div class="form-group">
        <label class="form-label">í”„ë¡œì íŠ¸ ì´ë¦„ <span class="required">*</span></label>
        <input type="text" id="newProjectName" class="form-input" placeholder="ì˜ˆ: 12/6 ê³ êµ¬ë ¤ ì‹œë¦¬ì¦ˆ">
      </div>
      <div class="form-group">
        <label class="form-label">í”„ë¡œì íŠ¸ ì„¤ëª…</label>
        <input type="text" id="newProjectDesc" class="form-input" placeholder="ìš°ì£¼">
      </div>
      <div class="modal-actions">
        <button type="button" class="btn-cancel" data-close="newProjectModal">ì·¨ì†Œ</button>
        <button type="button" class="btn-create" id="newProjectSubmit">ìƒì„±</button>
      </div>
    </div>
  </div>

  <!-- ì ê¸ˆ ì˜¤ë²„ë ˆì´ -->
  <div class="locked-overlay" id="lockedOverlay">
    <div style="text-align: center;">
      <div style="font-size: 32px; margin-bottom: 16px;">ğŸ”’</div>
      <div>ë¡œê·¸ì˜¨ì´ í•„ìš”í•©ë‹ˆë‹¤</div>
      <div style="font-size: 16px; margin-top: 8px; opacity: 0.8;">ìŠ¹ì¸ëœ IDì™€ ë¹„ë°€ë²ˆí˜¸ë¡œ ë¡œê·¸ì˜¨í•´ì£¼ì„¸ìš”</div>
    </div>
  </div>

  <script>
    var MAX_NOTICES = 300;
    var noticeList = [
      { type: 'ì—…ë°ì´íŠ¸ ì‚¬í•­', title: 'ë²¤ì¹˜ë§ˆí‚¹ ì¸ë„¤ì¼ ê³ ë„í™”', text: 'ë²¤ì¹˜ë§ˆí‚¹í•œ ì¸ë„¤ì¼ì„ ë„£ìœ¼ë©´ ë¹„ìŠ·í•˜ê²Œ ìƒì„±', dateStr: '2026. 1. 12.' }
    ];

    function formatDateYMD(d) {
      return d.getFullYear() + '. ' + (d.getMonth()+1) + '. ' + d.getDate();
    }
    function formatDateTime(d) {
      var h = d.getHours(), m = d.getMinutes(), s = d.getSeconds();
      var ampm = h < 12 ? 'ì˜¤ì „' : 'ì˜¤í›„';
      h = h % 12 || 12;
      return formatDateYMD(d) + ' ' + ampm + ' ' + String(h).padStart(2,'0') + ':' + String(m).padStart(2,'0') + ':' + String(s).padStart(2,'0');
    }
    function escapeHtml(s) {
      var div = document.createElement('div');
      div.textContent = s;
      return div.innerHTML;
    }

    function renderNoticeList() {
      var listEl = document.getElementById('sidebarUpdateList');
      listEl.innerHTML = '';
      noticeList.forEach(function(n, i) {
        var cardTitle = n.title || (n.type === 'ê³µì§€ê¸€' ? 'ê³µì§€' : 'ì—…ë°ì´íŠ¸') + ': ' + (n.text.length > 30 ? n.text.substring(0, 30) + 'â€¦' : n.text);
        var dateStr = n.dateStr && !n.dateStr.endsWith('.') ? n.dateStr + '.' : (n.dateStr || '');
        var item = document.createElement('div');
        item.className = 'update-entry-card';
        item.innerHTML = '<div class="entry-title">' + escapeHtml(cardTitle) + '</div><p class="entry-desc">' + escapeHtml(n.text) + '</p>' +
          '<div class="entry-footer"><div class="entry-date">' + escapeHtml(dateStr) + '</div><button type="button" class="entry-delete-btn" onclick="deleteNotice(' + i + ')">ì‚­ì œ</button></div>';
        listEl.appendChild(item);
      });
    }
    function deleteNotice(index) {
      if (confirm('ì´ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        noticeList.splice(index, 1);
        renderNoticeList();
      }
    }

    function openListModal(title, items) {
      document.getElementById('listModalTitle').textContent = title;
      var tbody = document.getElementById('listModalTbody');
      tbody.innerHTML = '';
      (items || []).forEach(function(n, i) {
        var row = document.createElement('tr');
        var titleText = n.title || (n.text && n.text.length > 50 ? n.text.substring(0, 50) + 'â€¦' : (n.text || ''));
        row.innerHTML = '<td class="col-no">' + (i + 1) + '</td><td class="col-type">' + escapeHtml(n.type || '') + '</td><td class="col-title">' + escapeHtml(titleText) + '</td><td class="col-content">' + escapeHtml(n.text || '') + '</td><td class="col-date">' + escapeHtml(n.dateStr || '') + '</td>';
        tbody.appendChild(row);
      });
      document.getElementById('listModal').classList.add('show');
    }
    document.querySelectorAll('[data-close="listModal"]').forEach(function(btn) {
      btn.onclick = function() { document.getElementById('listModal').classList.remove('show'); };
    });
    document.getElementById('btnUpdateList').onclick = function() { openListModal('ì—…ë°ì´íŠ¸ ì‚¬í•­ ëª©ë¡', noticeList); };
    document.getElementById('btnNoticeList').onclick = function() { openListModal('ì•ˆë‚´ì‚¬í•­ ëª©ë¡', noticeList); };

    document.getElementById('btnNotice').onclick = function() {
      if (!isLoggedIn) {
        alert('ë¡œê·¸ì˜¨ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        return;
      }
      document.getElementById('noticeModal').classList.add('show');
    };
    document.querySelectorAll('[data-close="noticeModal"]').forEach(function(btn) {
      btn.onclick = function() { document.getElementById('noticeModal').classList.remove('show'); };
    });
    document.getElementById('noticeSubmit').onclick = function() {
      var type = document.querySelector('input[name="noticeType"]:checked').value;
      var text = document.getElementById('noticeText').value.trim();
      if (!text) return;
      var now = new Date();
      var dateStr = formatDateYMD(now);
      document.getElementById('infoBanner').textContent = 'ì•ˆë‚´ì‚¬í•­: ' + text;
      noticeList.unshift({ type: type, text: text, dateStr: dateStr });
      if (noticeList.length > MAX_NOTICES) noticeList.pop();
      renderNoticeList();
      document.getElementById('noticeText').value = '';
      document.getElementById('noticeModal').classList.remove('show');
    };

    renderNoticeList('');

    document.getElementById('btnNewProject').onclick = function() {
      if (!isLoggedIn) {
        alert('ë¡œê·¸ì˜¨ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        return;
      }
      document.getElementById('newProjectName').value = '';
      document.getElementById('newProjectDesc').value = '';
      document.getElementById('newProjectModal').classList.add('show');
    };
    document.querySelectorAll('[data-close="newProjectModal"]').forEach(function(btn) {
      btn.onclick = function() { document.getElementById('newProjectModal').classList.remove('show'); };
    });
    document.getElementById('newProjectSubmit').onclick = function() {
      var name = document.getElementById('newProjectName').value.trim();
      if (!name) { alert('í”„ë¡œì íŠ¸ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.'); return; }
      var desc = document.getElementById('newProjectDesc').value.trim();
      var now = new Date();
      var dtStr = formatDateTime(now);
      var card = document.createElement('div');
      card.className = 'project-card';
      card.setAttribute('data-name', name);
      card.setAttribute('data-description', desc);
      var now = new Date();
      var month = now.getMonth() + 1;
      var workCount = Math.floor(Math.random() * 10) + 1; // ì„ì‹œë¡œ ëœë¤ ê°’, ì‹¤ì œë¡œëŠ” ì €ì¥ëœ ì‘ì—… ìˆ˜ ì‚¬ìš©
      card.innerHTML = '<input type="checkbox" class="project-checkbox"><span class="trash-icon" onclick="deleteProject(this)">ğŸ—‘ï¸</span><div class="project-title">' + escapeHtml(name) + '</div>' +
        '<div class="project-work-info">' + month + 'ì›” ' + workCount + 'ë²ˆì§¸ ì‘ì—… ì¤‘</div>' +
        '<div class="meta"><span class="meta-modified">ìˆ˜ì •: ' + dtStr + '</span><span class="meta-created">ìƒì„±: ' + dtStr + '</span></div>';
      document.getElementById('projectCardsGrid').insertBefore(card, document.getElementById('projectCardsGrid').firstChild);
      document.getElementById('newProjectModal').classList.remove('show');
      runSearch();
      updateDeleteButton();
    };
    function deleteProject(btn) {
      if (confirm('ì´ í”„ë¡œì íŠ¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        btn.closest('.project-card').remove();
        updateDeleteButton();
      }
    }

    document.getElementById('searchInput').addEventListener('input', runSearch);
    function runSearch() {
      var q = document.getElementById('searchInput').value.trim().toLowerCase();
      document.querySelectorAll('.project-card').forEach(function(card) {
        var name = (card.getAttribute('data-name') || '').toLowerCase();
        var desc = (card.getAttribute('data-description') || '').toLowerCase();
        var match = !q || name.indexOf(q) !== -1 || desc.indexOf(q) !== -1;
        card.classList.toggle('search-match', match && q.length > 0);
      });
    }

    document.getElementById('selectAllProjects').addEventListener('change', function() {
      var checked = this.checked;
      document.querySelectorAll('.project-checkbox').forEach(function(cb) { cb.checked = checked; });
      updateDeleteButton();
    });
    document.addEventListener('change', function(e) {
      if (e.target.classList.contains('project-checkbox')) updateDeleteButton();
    });
    function updateDeleteButton() {
      var selected = document.querySelectorAll('.project-checkbox:checked').length;
      document.getElementById('btnDeleteSelected').disabled = selected === 0;
      document.getElementById('btnDeleteSelected').textContent = selected > 0 ? 'ì„ íƒ ì‚­ì œ (' + selected + ')' : 'ì„ íƒ ì‚­ì œ';
    }
    document.getElementById('btnDeleteSelected').onclick = function() {
      var selected = document.querySelectorAll('.project-checkbox:checked');
      if (selected.length === 0) return;
      if (confirm(selected.length + 'ê°œì˜ í”„ë¡œì íŠ¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        selected.forEach(function(cb) { cb.closest('.project-card').remove(); });
        document.getElementById('selectAllProjects').checked = false;
        updateDeleteButton();
      }
    };

    // ìŠ¹ì¸ëœ ì‚¬ìš©ì ê´€ë¦¬
    function getApprovedUsers() {
      var users = localStorage.getItem('approvedUsers');
      return users ? JSON.parse(users) : [];
    }
    function saveApprovedUsers(users) {
      localStorage.setItem('approvedUsers', JSON.stringify(users));
    }
    function renderApprovedUsersTable() {
      var users = getApprovedUsers();
      var tbody = document.getElementById('approvedUsersTable');
      tbody.innerHTML = '';
      users.forEach(function(user, index) {
        var row = document.createElement('tr');
        row.innerHTML = '<td>' + (index + 1) + '</td>' +
          '<td>' + escapeHtml(user.id) + '</td>' +
          '<td><input type="text" class="user-pw-input" id="pw_' + index + '" value="' + escapeHtml(user.password) + '" style="width: 100%; padding: 4px 8px; border: 1px solid #cbd5e0; border-radius: 4px; font-size: 12px;"></td>' +
          '<td>' + escapeHtml(user.approvedDate) + '</td>' +
          '<td><button type="button" class="btn-save" onclick="updateUserPassword(' + index + ')" style="padding: 4px 12px; font-size: 11px;">ìˆ˜ì •</button></td>' +
          '<td><button type="button" class="entry-delete-btn" onclick="deleteApprovedUser(' + index + ')">ì‚­ì œ</button></td>';
        tbody.appendChild(row);
      });
    }
    function updateUserPassword(index) {
      var newPw = document.getElementById('pw_' + index).value.trim();
      if (!newPw) {
        alert('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
        return;
      }
      var users = getApprovedUsers();
      if (users[index]) {
        users[index].password = newPw;
        saveApprovedUsers(users);
        alert('ë¹„ë°€ë²ˆí˜¸ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
        renderApprovedUsersTable();
      }
    }
    function approveUser() {
      var id = document.getElementById('newUserId').value.trim();
      var pw = document.getElementById('newUserPw').value.trim();
      if (!id || !pw) {
        alert('IDì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.');
        return;
      }
      var users = getApprovedUsers();
      // ì¤‘ë³µ í™•ì¸
      if (users.some(function(u) { return u.id === id; })) {
        alert('ì´ë¯¸ ìŠ¹ì¸ëœ ì‚¬ìš©ìì…ë‹ˆë‹¤.');
        return;
      }
      var now = new Date();
      var dateStr = formatDateTime(now);
      users.push({ id: id, password: pw, approvedDate: dateStr });
      saveApprovedUsers(users);
      document.getElementById('newUserId').value = '';
      document.getElementById('newUserPw').value = '';
      renderApprovedUsersTable();
      alert('ì‚¬ìš©ìê°€ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }
    function deleteApprovedUser(index) {
      if (confirm('ì´ ì‚¬ìš©ìë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        var users = getApprovedUsers();
        users.splice(index, 1);
        saveApprovedUsers(users);
        renderApprovedUsersTable();
      }
    }

    // ë¡œê·¸ì˜¨ ìƒíƒœ ê´€ë¦¬
    var isLoggedIn = false;
    function checkLoginStatus() {
      var loginStatus = localStorage.getItem('isLoggedIn');
      var loginTime = localStorage.getItem('loginTime');
      if (loginStatus === 'true' && loginTime) {
        var loginDate = new Date(loginTime);
        var now = new Date();
        var hoursDiff = (now - loginDate) / (1000 * 60 * 60);
        // 24ì‹œê°„ í›„ ìë™ ë¡œê·¸ì•„ì›ƒ
        if (hoursDiff < 24) {
          isLoggedIn = true;
          updateUIForLogin();
          return true;
        } else {
          logout();
        }
      }
      isLoggedIn = false;
      updateUIForLogout();
      return false;
    }
    function login() {
      var id = document.getElementById('loginId').value.trim();
      var pw = document.getElementById('loginPw').value.trim();
      if (!id || !pw) {
        alert('IDì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
        return;
      }
      var users = getApprovedUsers();
      var user = users.find(function(u) { return u.id === id && u.password === pw; });
      if (user) {
        isLoggedIn = true;
        localStorage.setItem('isLoggedIn', 'true');
        localStorage.setItem('loginTime', new Date().toISOString());
        localStorage.setItem('currentUserId', id);
        updateUIForLogin();
        alert('ë¡œê·¸ì˜¨ë˜ì—ˆìŠµë‹ˆë‹¤.');
        document.getElementById('loginId').value = '';
        document.getElementById('loginPw').value = '';
      } else {
        alert('ìŠ¹ì¸ëœ IDì™€ ë¹„ë°€ë²ˆí˜¸ê°€ ì•„ë‹™ë‹ˆë‹¤.');
      }
    }
    function logout() {
      isLoggedIn = false;
      localStorage.removeItem('isLoggedIn');
      localStorage.removeItem('loginTime');
      localStorage.removeItem('currentUserId');
      updateUIForLogout();
    }
    function updateUIForLogin() {
      document.getElementById('lockedOverlay').classList.remove('show');
      document.getElementById('btnLogin').textContent = 'ë¡œê·¸ì•„ì›ƒ';
      document.getElementById('btnLogin').onclick = function() {
        if (confirm('ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          logout();
          alert('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
      };
      // ID/PW ì…ë ¥ í•„ë“œ ë¹„í™œì„±í™”
      document.getElementById('loginId').disabled = true;
      document.getElementById('loginPw').disabled = true;
      lockAllFeatures();
    }
    function updateUIForLogout() {
      document.getElementById('lockedOverlay').classList.add('show');
      document.getElementById('btnLogin').textContent = 'ë¡œê·¸ì˜¨';
      document.getElementById('btnLogin').onclick = login;
      // ID/PW ì…ë ¥ í•„ë“œ í™œì„±í™”
      document.getElementById('loginId').disabled = false;
      document.getElementById('loginPw').disabled = false;
      lockAllFeatures();
    }
    function lockAllFeatures() {
      if (!isLoggedIn) {
        // ëª¨ë“  ë²„íŠ¼ê³¼ ì…ë ¥ í•„ë“œ ë¹„í™œì„±í™”
        document.querySelectorAll('button:not(#btnAdmin):not(#btnLogin)').forEach(function(btn) {
          btn.disabled = true;
          btn.style.pointerEvents = 'none';
          btn.style.opacity = '0.5';
        });
        document.querySelectorAll('input:not(#loginId):not(#loginPw), textarea').forEach(function(input) {
          input.disabled = true;
          input.style.pointerEvents = 'none';
          input.style.opacity = '0.5';
        });
        document.querySelectorAll('a').forEach(function(link) {
          link.style.pointerEvents = 'none';
          link.style.opacity = '0.5';
        });
      } else {
        document.querySelectorAll('button').forEach(function(btn) {
          btn.disabled = false;
          btn.style.pointerEvents = 'auto';
          btn.style.opacity = '1';
        });
        document.querySelectorAll('input, textarea').forEach(function(input) {
          input.disabled = false;
          input.style.pointerEvents = 'auto';
          input.style.opacity = '1';
        });
        document.querySelectorAll('a').forEach(function(link) {
          link.style.pointerEvents = 'auto';
          link.style.opacity = '1';
        });
      }
    }

    // ì´ˆê¸°í™” - ê¸°ë³¸ ê´€ë¦¬ì ê³„ì • ì¶”ê°€
    (function() {
      var users = getApprovedUsers();
      var adminExists = users.some(function(u) { return u.id === 'chaesira'; });
      if (!adminExists) {
        var now = new Date();
        var dateStr = formatDateTime(now);
        users.push({ 
          id: 'chaesira', 
          password: '690614330515', 
          approvedDate: dateStr 
        });
        saveApprovedUsers(users);
      }
    })();

    // ì´ˆê¸°í™”
    checkLoginStatus();
    lockAllFeatures();

    // í”„ë¡œì íŠ¸ ë²„íŠ¼ ê¶Œí•œ ì²´í¬ ë° ì´ë²¤íŠ¸
    (function() {
      function checkAdminPermission() {
        var loginStatus = localStorage.getItem('isLoggedIn');
        var loginTime = localStorage.getItem('loginTime');
        if (loginStatus === 'true' && loginTime) {
          var loginDate = new Date(loginTime);
          var now = new Date();
          var hoursDiff = (now - loginDate) / (1000 * 60 * 60);
          if (hoursDiff < 24) {
            var currentUserId = localStorage.getItem('currentUserId');
            var users = JSON.parse(localStorage.getItem('approvedUsers') || '[]');
            var user = users.find(function(u) { return u.id === currentUserId; });
            return user && user.isAdmin === true;
          }
        }
        return false;
      }
      
      function updateProjectButtonsVisibility() {
        var hasPermission = checkAdminPermission();
        var btnCreate = document.getElementById('btnCreateProject');
        var btnList = document.getElementById('btnProjectList');
        if (btnCreate) {
          btnCreate.style.display = hasPermission ? 'block' : 'none';
          btnCreate.disabled = !hasPermission;
        }
        if (btnList) {
          btnList.style.display = hasPermission ? 'block' : 'none';
          btnList.disabled = !hasPermission;
        }
      }
      
      var btnCreate = document.getElementById('btnCreateProject');
      var btnList = document.getElementById('btnProjectList');
      
      if (btnCreate) {
        btnCreate.onclick = function() {
          if (!checkAdminPermission()) {
            alert('ê´€ë¦¬ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í›„ ê´€ë¦¬ ê¶Œí•œì„ ë°›ì•„ì£¼ì„¸ìš”.');
            return;
          }
          alert('í”„ë¡œì íŠ¸ ìƒì„± ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
        };
      }
      
      if (btnList) {
        btnList.onclick = function() {
          if (!checkAdminPermission()) {
            alert('ê´€ë¦¬ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í›„ ê´€ë¦¬ ê¶Œí•œì„ ë°›ì•„ì£¼ì„¸ìš”.');
            return;
          }
          window.location.href = '/';
        };
      }
      
      updateProjectButtonsVisibility();
      setInterval(updateProjectButtonsVisibility, 5000);
    })();

    var ENCRYPTION_KEY = '690614330505';
    document.getElementById('btnAdmin').onclick = function() {
      var key = prompt('ì•”í˜¸í™” í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
      if (key === ENCRYPTION_KEY) {
        loadAdminData();
        renderApprovedUsersTable();
        document.getElementById('adminModal').classList.add('show');
      } else if (key !== null) {
        alert('ì•”í˜¸í™” í‚¤ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
      }
    };
    document.getElementById('btnLogin').onclick = login;
    document.querySelectorAll('[data-close="adminModal"]').forEach(function(btn) {
      btn.onclick = function() { document.getElementById('adminModal').classList.remove('show'); };
    });
    function loadAdminData() {
      document.getElementById('adminId').value = localStorage.getItem('adminId') || '';
      document.getElementById('adminPw').value = localStorage.getItem('adminPw') || '';
      document.getElementById('apiOpenAI').value = localStorage.getItem('apiOpenAI') || '';
      document.getElementById('apiGoogle').value = localStorage.getItem('apiGoogle') || '';
      document.getElementById('apiOther1').value = localStorage.getItem('apiOther1') || '';
      document.getElementById('apiOther2').value = localStorage.getItem('apiOther2') || '';
    }
    function saveAdminLogin() {
      localStorage.setItem('adminId', document.getElementById('adminId').value);
      localStorage.setItem('adminPw', document.getElementById('adminPw').value);
      alert('ë¡œê·¸ì¸ ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }
    // ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ
    window.deleteApprovedUser = deleteApprovedUser;
    window.updateUserPassword = updateUserPassword;
    function saveAdminAPIs() {
      localStorage.setItem('apiOpenAI', document.getElementById('apiOpenAI').value);
      localStorage.setItem('apiGoogle', document.getElementById('apiGoogle').value);
      localStorage.setItem('apiOther1', document.getElementById('apiOther1').value);
      localStorage.setItem('apiOther2', document.getElementById('apiOther2').value);
      alert('API ì¸ì¦ ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }

    // ìºë¦­í„° ì•„ì…‹ ë§¤ë‹ˆì € í•¨ìˆ˜ë“¤
    function openCharacterManager() {
      document.getElementById('characterManagerModal').style.display = 'flex';
      loadCharacters();
      setupCharacterUploads();
    }

    function closeCharacterManager() {
      document.getElementById('characterManagerModal').style.display = 'none';
    }

    function loadCharacters() {
      var characters = getCharacters();
      characters.forEach(function(char) {
        var slot = document.querySelector('[data-role="' + char.role + '"][data-index="' + char.index + '"]');
        if (slot) {
          var placeholder = slot.querySelector('.character-slot-placeholder');
          var image = slot.querySelector('.character-slot-image');
          var info = slot.querySelector('.character-slot-info');
          var name = slot.querySelector('.character-slot-name');
          
          if (char.imageUrl) {
            placeholder.style.display = 'none';
            image.src = char.imageUrl;
            image.style.display = 'block';
            info.style.display = 'block';
            name.textContent = char.name || (char.role === 'narrator' ? 'Narrator' : (char.role === 'main' ? 'Main ' + String.fromCharCode(65 + char.index) : 'Sub ' + String.fromCharCode(65 + char.index)));
          }

          // ë¦½ì‹±í¬ í† ê¸€ ìƒíƒœ ë³µì› (ì„±ìš°ë§Œ)
          if (char.role === 'narrator') {
            loadLipsyncToggleState(char.role, char.index);
          }
        }
      });

      // ì„±ìš° ìŠ¬ë¡¯ì˜ ë¦½ì‹±í¬ í† ê¸€ ìƒíƒœ ë³µì› (ìºë¦­í„°ê°€ ì—†ì–´ë„)
      loadLipsyncToggleState('narrator', 0);
    }

    function setupCharacterUploads() {
      document.querySelectorAll('.character-upload-input').forEach(function(input) {
        input.onchange = function(e) {
          var file = e.target.files[0];
          if (!file) return;
          
          var role = this.dataset.role;
          var index = parseInt(this.dataset.index);
          
          uploadCharacterImage(file, role, index);
        };
      });

      document.querySelectorAll('.character-slot-upload').forEach(function(upload) {
        upload.onclick = function(e) {
          if (e.target.classList.contains('character-slot-delete')) return;
          var input = this.querySelector('.character-upload-input');
          if (input) input.click();
        };
      });
    }

    async function uploadCharacterImage(file, role, index) {
      try {
        var formData = new FormData();
        formData.append('image', file);
        formData.append('role', role);
        formData.append('index', index);

        var response = await fetch((window.__API_BASE__ || 'http://localhost:4000') + '/api/characters/upload', {
          method: 'POST',
          body: formData
        });

        if (!response.ok) {
          throw new Error('ì—…ë¡œë“œ ì‹¤íŒ¨');
        }

        var data = await response.json();
        
        // ìºë¦­í„° ì •ë³´ ì €ì¥
        var character = {
          role: role,
          index: index,
          name: data.name || '',
          imageUrl: data.image_url,
          characterId: data.character_id,
          embeddingData: data.embedding_data,
          createdAt: new Date().toISOString()
        };

        saveCharacter(character);
        loadCharacters();
        alert('ìºë¦­í„°ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤. ì–¼êµ´ íŠ¹ì§•ì´ ì¶”ì¶œë˜ì–´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
      } catch (e) {
        console.error('ìºë¦­í„° ì—…ë¡œë“œ ì‹¤íŒ¨:', e);
        alert('ìºë¦­í„° ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.');
      }
    }

    function deleteCharacter(role, index) {
      if (!confirm('ì´ ìºë¦­í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

      var characters = getCharacters();
      characters = characters.filter(function(char) {
        return !(char.role === role && char.index === index);
      });
      saveCharacters(characters);

      // UI ì—…ë°ì´íŠ¸
      var slot = document.querySelector('[data-role="' + role + '"][data-index="' + index + '"]');
      if (slot) {
        var placeholder = slot.querySelector('.character-slot-placeholder');
        var image = slot.querySelector('.character-slot-image');
        var info = slot.querySelector('.character-slot-info');
        
        placeholder.style.display = 'flex';
        image.style.display = 'none';
        info.style.display = 'none';
      }

      // ë°±ì—”ë“œì— ì‚­ì œ ìš”ì²­
      fetch((window.__API_BASE__ || 'http://localhost:4000') + '/api/characters/delete', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ role: role, index: index })
      }).catch(function(e) {
        console.error('ìºë¦­í„° ì‚­ì œ API í˜¸ì¶œ ì‹¤íŒ¨:', e);
      });
    }

    function getCharacters() {
      var chars = localStorage.getItem('characters');
      return chars ? JSON.parse(chars) : [];
    }

    function saveCharacter(character) {
      var characters = getCharacters();
      var existingIndex = characters.findIndex(function(c) {
        return c.role === character.role && c.index === character.index;
      });
      
      if (existingIndex !== -1) {
        characters[existingIndex] = character;
      } else {
        characters.push(character);
      }
      
      saveCharacters(characters);
    }

    function saveCharacters(characters) {
      localStorage.setItem('characters', JSON.stringify(characters));
    }

    // AI ë¦½ì‹±í¬ í† ê¸€ í•¨ìˆ˜
    function toggleLipsync(role, index) {
      if (role !== 'narrator') {
        console.warn('AI ë¦½ì‹±í¬ëŠ” ì„±ìš° ì „ìš© ê¸°ëŠ¥ì…ë‹ˆë‹¤.');
        return;
      }

      var toggle = document.getElementById('lipsyncToggle' + role.charAt(0).toUpperCase() + role.slice(1) + index);
      if (!toggle) return;

      var isActive = toggle.classList.contains('active');
      var newState = !isActive;

      // UI ì—…ë°ì´íŠ¸
      if (newState) {
        toggle.classList.add('active');
      } else {
        toggle.classList.remove('active');
      }

      // ìºë¦­í„° ë°ì´í„° ì—…ë°ì´íŠ¸
      var characters = getCharacters();
      var charIndex = characters.findIndex(function(c) {
        return c.role === role && c.index === index;
      });

      if (charIndex !== -1) {
        characters[charIndex].enable_lipsync_video = newState;
        saveCharacters(characters);

        // ë°±ì—”ë“œì— ìƒíƒœ ì €ì¥
        saveLipsyncSetting(role, index, newState);
      } else {
        // ìºë¦­í„°ê°€ ì•„ì§ ë“±ë¡ë˜ì§€ ì•Šì€ ê²½ìš°, ì„ì‹œë¡œ ì„¤ì • ì €ì¥
        var tempSetting = JSON.parse(localStorage.getItem('lipsyncSettings') || '{}');
        tempSetting[role + '-' + index] = newState;
        localStorage.setItem('lipsyncSettings', JSON.stringify(tempSetting));
      }
    }

    // ë¦½ì‹±í¬ ì„¤ì • ë°±ì—”ë“œ ì €ì¥
    async function saveLipsyncSetting(role, index, enabled) {
      try {
        var response = await fetch((window.__API_BASE__ || 'http://localhost:4000') + '/api/characters/lipsync', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            role: role,
            index: index,
            enable_lipsync_video: enabled
          })
        });

        if (!response.ok) {
          console.error('ë¦½ì‹±í¬ ì„¤ì • ì €ì¥ ì‹¤íŒ¨');
        }
      } catch (e) {
        console.error('ë¦½ì‹±í¬ ì„¤ì • ì €ì¥ ì¤‘ ì˜¤ë¥˜:', e);
      }
    }

    // ìºë¦­í„° ë¡œë“œ ì‹œ ë¦½ì‹±í¬ í† ê¸€ ìƒíƒœ ë³µì›
    function loadLipsyncToggleState(role, index) {
      if (role !== 'narrator') return;

      var characters = getCharacters();
      var char = characters.find(function(c) {
        return c.role === role && c.index === index;
      });

      var toggle = document.getElementById('lipsyncToggle' + role.charAt(0).toUpperCase() + role.slice(1) + index);
      if (!toggle) return;

      var enabled = false;
      if (char && char.enable_lipsync_video !== undefined) {
        enabled = char.enable_lipsync_video;
      } else {
        // ìºë¦­í„°ê°€ ì—†ìœ¼ë©´ ì„ì‹œ ì„¤ì • í™•ì¸
        var tempSetting = JSON.parse(localStorage.getItem('lipsyncSettings') || '{}');
        enabled = tempSetting[role + '-' + index] || false;
      }

      if (enabled) {
        toggle.classList.add('active');
      } else {
        toggle.classList.remove('active');
      }
    }
