<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2. AI ëŒ€ë³¸ ìƒì„±</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Malgun Gothic", sans-serif;
      background: #f5f5f5;
      color: #333;
      min-height: 100vh;
    }
    .layout { display: flex; min-height: 100vh; padding-top: 0; }
    .sidebar {
      width: 300px;
      background: linear-gradient(180deg, #fafbff 0%, #f2f4f8 100%);
      border-right: 1px solid #e8ecf4;
      padding: 20px 16px 24px;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      gap: 20px;
      height: 100vh;
      overflow-y: auto;
    }
    .sidebar-logo {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      font-weight: 700;
      font-size: 1.5rem;
      letter-spacing: 0.05em;
      color: #2d3748;
      margin-top: 8px;
      margin-bottom: 0;
      padding-left: 4px;
      text-align: left;
      cursor: pointer;
      transition: color 0.2s;
    }
    .sidebar-logo:hover {
      color: #9333ea;
    }
    .sidebar-card {
      background: #fff;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.06);
      border: 1px solid rgba(0,0,0,0.04);
    }
    /* í˜„ì¬ í”„ë¡œì íŠ¸ */
    .project-label {
      font-size: 12px;
      color: #718096;
      margin-bottom: 6px;
    }
    .project-name-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 14px;
    }
    .project-name {
      font-size: 16px;
      font-weight: 700;
      color: #1a202c;
    }
    .project-name-edit {
      color: #718096;
      cursor: pointer;
      font-size: 14px;
    }
    .project-name-edit:hover {
      color: #3182ce;
    }
    /* í”„ë¡œì íŠ¸ ì•¡ì…˜ í•œ ì¤„ ë°°ì¹˜ */
    .project-actions-row {
      display: flex;
      gap: 6px;
      margin-top: 8px;
    }
    .sidebar-btn-inline {
      flex: 1;
      padding: 8px 12px;
      border: none;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }
    .sidebar-btn-inline-primary {
      background: linear-gradient(135deg, #805ad5 0%, #6b46c1 100%);
      color: #fff;
    }
    .sidebar-btn-inline-primary:hover {
      background: linear-gradient(135deg, #6b46c1 0%, #553c9a 100%);
    }
    .sidebar-btn-inline-secondary {
      background: #fff;
      color: #2d3748;
      border: 1px solid #e2e8f0;
    }
    .sidebar-btn-inline-secondary:hover {
      background: #f7fafc;
      border-color: #cbd5e0;
    }
    .workflow-title {
      font-size: 13px;
      font-weight: 700;
      color: #4a5568;
      margin-bottom: 12px;
      padding: 0 4px;
    }
    .workflow-list { list-style: none; padding-right: 4px; }
    .workflow-item {
      display: block;
      padding: 12px 14px;
      margin-bottom: 6px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 500;
      color: #4a5568;
      background: #fff;
      border: 1px solid #e2e8f0;
      text-decoration: none;
      transition: background 0.2s, color 0.2s, border-color 0.2s;
    }
    .workflow-item:hover { background: #f7fafc; border-color: #cbd5e0; color: #2d3748; }
    .workflow-item.active {
      background: linear-gradient(135deg, #e9d8fd 0%, #e2e8f0 100%);
      border-color: #b794f4;
      color: #553c9a;
      font-weight: 600;
    }
    /* 1~2ë‹¨ê³„(AI ì°½ì‘)ì™€ 3ë‹¨ê³„(ì‚¬ìš©ì ì œì–´) ì‹œê°ì  êµ¬ë¶„ */
    .workflow-list li:nth-child(3) .workflow-item {
      margin-top: 10px;
      border-top: 1px dashed #e2e8f0;
      padding-top: 14px;
    }

    .main {
      flex: 1;
      padding: 24px 32px 40px;
      overflow-y: auto;
    }
    .header-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 16px;
      margin-top: 0;
      padding-top: 0;
    }
    .title-area { flex: 1; }
    .title-area h1 {
      font-size: 24px;
      font-weight: 700;
      color: #222;
      margin-bottom: 4px;
      margin-top: 0;
      line-height: 1.3;
    }
    .title-area .subtitle {
      font-size: 14px;
      color: #666;
      margin: 0;
      line-height: 1.4;
    }
    .header-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 8px;
    }
    .login-inline-row {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .login-input {
      height: 32px;
      padding: 0 10px;
      border: 1px solid #cbd5e0;
      border-radius: 4px;
      font-size: 13px;
      box-sizing: border-box;
      transition: background-color 0.2s, border-color 0.2s;
      width: 140px;
    }
    .login-input::placeholder { color: #a0aec0; }
    .login-input:disabled {
      background-color: #E0E0E0;
      border-color: #999;
      color: #666;
      cursor: not-allowed;
      pointer-events: none;
    }
    .btn-admin, .btn-login {
      padding: 0 12px;
      height: 32px;
      background: #e0e0e0;
      color: #333;
      border: 1px solid #c0c0c0;
      border-radius: 4px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
    }
    .btn-admin:hover, .btn-login:hover { background: #d5d5d5; }

    .content-card {
      background: #fff;
      border: 1px solid #e8e8e8;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.06);
      margin-bottom: 20px;
    }
    .field-label {
      font-size: 14px;
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 8px;
    }
    .section-desc {
      font-size: 13px;
      color: #666;
      margin-bottom: 12px;
      line-height: 1.5;
    }
    textarea {
      width: 100%;
      min-height: 160px;
      padding: 12px;
      border: 1px solid #cbd5e0;
      border-radius: 8px;
      font-size: 14px;
      font-family: inherit;
      resize: vertical;
      box-sizing: border-box;
      overflow-y: auto;
      overflow-x: hidden;
    }
    /* Selection Summary */
    .summary-card {
      background: #fff7fb;
      border-color: #fed7e2;
    }
    .summary-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
    }
    .summary-item {
      padding: 8px 10px;
      border-radius: 8px;
      background: rgba(255,255,255,0.8);
      border: 1px solid #fed7e2;
    }
    .summary-label {
      font-size: 12px;
      font-weight: 700;
      color: #d53f8c;
      margin-bottom: 2px;
    }
    .summary-value {
      font-size: 13px;
      color: #333;
      line-height: 1.5;
      white-space: pre-line;
    }
    /* Blueprint form */
    .blueprint-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    .blueprint-item {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .blueprint-item.full {
      grid-column: 1 / -1;
    }
    .blueprint-label {
      font-size: 13px;
      font-weight: 600;
      color: #2d3748;
    }
    .blueprint-input {
      height: 36px;
      padding: 0 10px;
      border-radius: 8px;
      border: 1px solid #cbd5e0;
      font-size: 14px;
      box-sizing: border-box;
      overflow-x: auto;
      overflow-y: hidden;
    }
    .blueprint-textarea {
      min-height: 160px;
      overflow-y: auto;
      overflow-x: hidden;
    }
    .blueprint-textarea-small {
      min-height: 53px; /* 160pxì˜ ì•½ 1/3 */
      max-height: 80px;
      overflow-y: auto;
      overflow-x: hidden;
    }
    .btn-primary {
      margin-top: 12px;
      padding: 10px 16px;
      background: #e53935;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
    }
    .btn-primary:hover { background: #c62828; }
    .format-toggle-btn {
      padding: 6px 12px;
      border: none;
      background: transparent !important;
      border-radius: 4px;
      font-size: 13px;
      font-weight: 600;
      color: #4a5568 !important;
      cursor: pointer;
      transition: all 0.2s;
    }
    .format-toggle-btn:hover {
      background: rgba(229, 57, 53, 0.1) !important;
    }
    .format-toggle-btn.active {
      background: #e53935 !important;
      color: #fff !important;
    }
  </style>
</head>
  <body>
  <div class="layout">
    <aside class="sidebar">
      <div class="sidebar-logo" onclick="window.location.href='ai-automation-project.html'" title="í™ˆìœ¼ë¡œ ì´ë™">HANRA STUDIO</div>

      <!-- í˜„ì¬ í”„ë¡œì íŠ¸ -->
      <div class="sidebar-card">
        <div class="project-label">í˜„ì¬ í”„ë¡œì íŠ¸</div>
        <div class="project-name-row">
          <span class="project-name">ìƒˆë¡œìš´ í”„ë¡œì íŠ¸</span>
          <span class="project-name-edit" title="ì´ë¦„ ìˆ˜ì •">âœ</span>
        </div>
        <div class="project-actions-row">
          <button type="button" class="sidebar-btn-inline sidebar-btn-inline-primary" id="btnCreateProject">
            Pìƒì„±
          </button>
          <button type="button" class="sidebar-btn-inline sidebar-btn-inline-secondary" id="btnProjectList">
            Pëª©ë¡
          </button>
        </div>
      </div>

      <div class="sidebar-card">
        <div class="workflow-title">ì§„í–‰ ë‹¨ê³„</div>
        <ul class="workflow-list">
          <li><a href="ai-automation-project.html" class="workflow-item">1. ì£¼ì œ ì¶”ì²œ</a></li>
          <li><a href="step-2.html" class="workflow-item active">2. AI ëŒ€ë³¸ ìƒì„±</a></li>
          <li><a href="step-3.html" class="workflow-item">3. ëŒ€ë³¸ ì§ì ‘ ì…ë ¥</a></li>
          <li><a href="step-4-1.html" class="workflow-item">4-1. JSON ìƒì„±</a></li>
          <li><a href="step-4-2.html" class="workflow-item">4-2. ì´ë¯¸ì§€ ìƒì„±</a></li>
          <li><a href="step-6.html" class="workflow-item">5. TTS ìƒì„±</a></li>
          <li><a href="step-5-2.html" class="workflow-item">5-2. BGM ì‚½ì…</a></li>
          <li><a href="step-7.html" class="workflow-item">6. ì˜ìƒ ë Œë”ë§</a></li>
          <li><a href="step-8.html" class="workflow-item">7. ì œëª©/ì„¤ëª… ì‘ì„±</a></li>
          <li><a href="step-9.html" class="workflow-item">8. ì¸ë„¤ì¼ ìƒì„±ê¸°</a></li>
          <li><a href="step-10.html" class="workflow-item">9. ìµœì¢… ì œì‘</a></li>
          <li><a href="step-11.html" class="workflow-item">10. ì‡¼ì¸  ìë™ ë³€í™˜</a></li>
          <li><a href="step-12.html" class="workflow-item">11. ì±„ë„ ë§¤ë‹ˆì €</a></li>
          <li><a href="step-13.html" class="workflow-item">12. ì‘ì—… ë³´ê´€í•¨</a></li>
        </ul>
      </div>
    </aside>

    <main class="main">
      <div class="header-row">
        <div class="title-area">
          <h1>2. AI ëŒ€ë³¸ ìƒì„±</h1>
          <p class="subtitle">ì£¼ì œ ì¶”ì²œ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ëŒ€ë³¸ ê¸°íšì„ ì •ë¦¬í•©ë‹ˆë‹¤</p>
        </div>
        <div class="header-right">
          <div class="login-inline-row">
            <input type="text" class="login-input" id="loginId" placeholder="ID" />
            <input type="password" class="login-input" id="loginPw" placeholder="Password" />
            <button type="button" class="btn-admin" id="btnAdmin">ê´€ë¦¬</button>
            <button type="button" class="btn-login" id="btnLogin">ë¡œê·¸ì˜¨</button>
          </div>
        </div>
      </div>

      <!-- ìƒë‹¨: ì„ íƒ ë°ì´í„° ìš”ì•½ -->
      <section class="content-card summary-card">
        <div class="field-label">ì„ íƒ ë°ì´í„° ìš”ì•½ (Selection Summary)</div>
        <p class="section-desc">1ë‹¨ê³„ì—ì„œ ì„ íƒí•œ ì£¼ì œÂ·í‚¤ì›Œë“œÂ·ì „ë¬¸ê°€ ë¶„ì„ ë‚´ìš©ì„ í•œëˆˆì— í™•ì¸í•©ë‹ˆë‹¤.</p>
        <div id="selectionSummary" class="summary-grid"></div>
      </section>

      <!-- ëŒ€ë³¸ ê¸°íšì•ˆ í™•ì • -->
      <section class="content-card">
        <div class="field-label">ëŒ€ë³¸ ê¸°íšì•ˆ í™•ì • (Final Blueprint)</div>
        <div class="blueprint-grid">
          <div class="blueprint-item">
            <label for="bpTitle" class="blueprint-label">ì œëª©</label>
            <input id="bpTitle" class="blueprint-input" type="text" placeholder="ì˜ìƒ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”.">
          </div>
          <div class="blueprint-item">
            <label for="bpTarget" class="blueprint-label">íƒ€ê²Ÿ ì‹œì²­ì</label>
            <input id="bpTarget" class="blueprint-input" type="text" placeholder="ì˜ˆ: 30-40ëŒ€ ì¬í…Œí¬ ê´€ì‹¬ ì§ì¥ì¸">
          </div>
          <div class="blueprint-item full">
            <label for="bpHook" class="blueprint-label">í›…(Hook) ë¬¸êµ¬</label>
            <textarea id="bpHook" class="blueprint-textarea blueprint-textarea-small" placeholder="ì˜¤í”„ë‹ 3ì´ˆ ì•ˆì— ì‹œì²­ìì˜ ì‹œì„ ì„ ì¡ëŠ” í•œ ë¬¸ì¥ ë˜ëŠ” ì§§ì€ ë‹¨ë½ì„ ì‘ì„±í•˜ì„¸ìš”."></textarea>
          </div>
          <div class="blueprint-item full">
            <label for="bpStoryline" class="blueprint-label">ì˜ìƒ ë¼ˆëŒ€ (Storyline)</label>
            <textarea id="bpStoryline" class="blueprint-textarea" placeholder="ì¸íŠ¸ë¡œ â†’ ë¬¸ì œ ì œê¸° â†’ ì¸ì‚¬ì´íŠ¸/ê°€ì´ë“œ â†’ ë§ˆë¬´ë¦¬ ì½œíˆ¬ì•¡ì…˜ ìˆœìœ¼ë¡œ í° íë¦„ì„ ì •ë¦¬í•˜ì„¸ìš”."></textarea>
          </div>
        </div>
      </section>

      <!-- ë²¤ì¹˜ë§ˆí‚¹ êµ¬ì¡° ë¶„ì„ (ëŒ€ë³¸ ê¸°íšì•ˆ í™•ì • ì•„ë˜ë¡œ ì´ë™) -->
      <section class="content-card">
        <div class="field-label">ë²¤ì¹˜ë§ˆí‚¹ ëŒ€ë³¸ êµ¬ì¡° ë½‘ê¸°</div>
        <p class="section-desc">ë²¤ì¹˜ë§ˆí‚¹í•  ëŒ€ë³¸ì„ ì…ë ¥í•˜ë©´ íŒ¨í„´ì„ ë¶„ì„í•´ ìœ„ ê¸°íšì•ˆì— ë°˜ì˜í•©ë‹ˆë‹¤.</p>
        <textarea id="benchmarkInput" placeholder="ì°¸ê³ í•  ëŒ€ë³¸ì„ ì…ë ¥í•˜ê±°ë‚˜ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”."></textarea>
        <button class="btn-primary" type="button" id="btnAnalyzeStructure">ëŒ€ë³¸ êµ¬ì¡° ë¶„ì„í•˜ê¸°</button>
      </section>

      <!-- AI ëŒ€ë³¸ ìƒì„± (3ë‹¨ê³„ì—ì„œ ì´ë™) -->
      <section class="content-card">
        <div class="field-label">AI ëŒ€ë³¸ ìƒì„±</div>
        <p class="section-desc">ì˜ìƒ ë¼ˆëŒ€(Storyline), í†¤ì•¤ë§¤ë„ˆë¥¼ ë°”íƒ•ìœ¼ë¡œ êµ¬ì–´ì²´ ëŒ€ë³¸ì„ ìƒì„±í•©ë‹ˆë‹¤.</p>
        
        <!-- ì˜ìƒ í˜•ì‹ ì„ íƒ -->
        <div style="margin-top: 16px; margin-bottom: 16px;">
          <div style="font-size: 13px; font-weight: 600; color: #2d3748; margin-bottom: 8px;">ì˜ìƒ í˜•ì‹</div>
          <div style="display: flex; gap: 4px; background: #f7fafc; border: 1px solid #cbd5e0; border-radius: 6px; padding: 2px; width: fit-content;">
            <button type="button" class="format-toggle-btn active" id="formatShorts" data-format="shorts">
              ğŸ“± ì‡¼ì¸ 
            </button>
            <button type="button" class="format-toggle-btn" id="formatLongform" data-format="longform">
              ğŸ“º ë¡±í¼
            </button>
          </div>
        </div>

        <!-- ì˜ˆìƒ ì˜ìƒ ê¸¸ì´ ì„ íƒ -->
        <div style="margin-bottom: 16px;">
          <div style="font-size: 13px; font-weight: 600; color: #2d3748; margin-bottom: 8px;">ì˜ˆìƒ ì˜ìƒ ê¸¸ì´</div>
          <select id="videoDuration" class="blueprint-input" style="width: 200px;">
            <!-- ì˜µì…˜ì€ JavaScriptì—ì„œ ë™ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë¨ -->
            <option value="30s">30ì´ˆ</option>
            <option value="1m">1ë¶„</option>
            <option value="1.5m">1.5ë¶„</option>
            <option value="2m">2ë¶„</option>
            <option value="2.5m">2.5ë¶„</option>
          </select>
        </div>

        <div style="margin-top: 16px;">
          <button class="btn-primary" type="button" id="btnGenerateAIScript" style="width: 100%;">
            AI ëŒ€ë³¸ ìƒì„±í•˜ê¸°
          </button>
          <p class="section-desc" style="margin-top: 12px; font-size: 12px; color: #999;">
            ìƒì„±ëœ ëŒ€ë³¸ì€ 3ë‹¨ê³„(ëŒ€ë³¸ ì§ì ‘ ì…ë ¥)ì—ì„œ í™•ì¸í•˜ê³  ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          </p>
        </div>
      </section>
    </main>
  </div>

  <script>
    // Selection Summary & Blueprint Helper
    function renderSelectionSummary(payload) {
      var container = document.getElementById('selectionSummary');
      if (!container || !payload) return;

      var rows = [];
      if (payload.keyword) rows.push({ label: 'í‚¤ì›Œë“œ', value: payload.keyword });
      if (payload.keywordTopic) rows.push({ label: 'í‚¤ì›Œë“œ ì„ ì • ì£¼ì œ', value: payload.keywordTopic });
      if (payload.trendTopics && payload.trendTopics.length) {
        rows.push({ label: 'ì„ íƒëœ í•«ì´ìŠˆ', value: payload.trendTopics.join(', ') });
      }
      if (payload.chosenAiTopic) rows.push({ label: 'ì„ íƒëœ ì¶”ì²œ ì£¼ì œ', value: payload.chosenAiTopic });
      if (payload.expertSummary) rows.push({ label: 'AI ì „ë¬¸ê°€ ë¶„ì„ ìš”ì•½', value: payload.expertSummary });
      if (payload.analysis && payload.analysis.summary) {
        rows.push({ label: 'AI ìë™ ìš”ì•½', value: payload.analysis.summary });
      }

      if (payload.scriptText) {
        rows.push({ label: 'ì›ë¬¸(ëŒ€ë³¸/URL/íŒŒì¼)', value: payload.scriptText });
      }

      if (!rows.length) {
        container.innerHTML = '<div class="summary-item"><div class="summary-value">1ë‹¨ê³„ì—ì„œ ì „ë‹¬ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ì£¼ì œ ì¶”ì²œ í˜ì´ì§€ì—ì„œ ë‹¤ì‹œ ì‹œì‘í•´ ì£¼ì„¸ìš”.</div></div>';
        return;
      }

      container.innerHTML = rows
        .map(function(row) {
          return (
            '<div class="summary-item">' +
            '<div class="summary-label">' +
            row.label +
            '</div>' +
            '<div class="summary-value">' +
            String(row.value) +
            '</div>' +
            '</div>'
          );
        })
        .join('');
    }

    function prefillBlueprint(payload) {
      var titleEl = document.getElementById('bpTitle');
      var targetEl = document.getElementById('bpTarget');
      var hookEl = document.getElementById('bpHook');
      var storyEl = document.getElementById('bpStoryline');
      if (!titleEl || !targetEl || !hookEl || !storyEl || !payload) return;

      var baseTitle =
        payload.chosenAiTopic ||
        (payload.trendTopics && payload.trendTopics[0]) ||
        payload.keywordTopic ||
        payload.keyword ||
        '';

      if (baseTitle && !titleEl.value) titleEl.value = baseTitle;

      if (!targetEl.value) {
        var kw = (payload.keywordTopic || payload.keyword || '').toLowerCase();
        var target = 'ì´ ì£¼ì œì— ê´€ì‹¬ ìˆëŠ” ì¼ë°˜ ì‹œì²­ì';
        if (/ì¬í…Œí¬|ì£¼ì‹|ë¶€ë™ì‚°|ê²½ë§¤/.test(kw)) target = 'ì•ˆì •ì ì¸ ìì‚° ì¦ì‹ì„ ê³ ë¯¼í•˜ëŠ” 30-50ëŒ€ ì¬í…Œí¬ ê´€ì‹¬ ì‹œì²­ì';
        else if (/ì‹œë‹ˆì–´|ì€í‡´/.test(kw)) target = 'ê±´ê°•Â·ë…¸í›„ ì¤€ë¹„ì— ê´€ì‹¬ì´ ë§ì€ 50-70ëŒ€ ì‹œë‹ˆì–´ ì‹œì²­ì';
        else if (/ai|í…Œí¬|it|ê¸°ìˆ /.test(kw)) target = 'ìµœì‹  ê¸°ìˆ ê³¼ AI í™œìš©ë²•ì— ê´€ì‹¬ ìˆëŠ” 20-40ëŒ€ ì§ì¥ì¸';
        targetEl.value = target;
      }

      if (!hookEl.value) {
        var hookBase = payload.expertSummary || (payload.analysis && payload.analysis.summary) || baseTitle;
        if (hookBase) {
          hookEl.value = hookBase;
        }
      }

      // ë²¤ì¹˜ë§ˆí‚¹ ëŒ€ë³¸ êµ¬ì¡° ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì˜ìƒ ë¼ˆëŒ€ì— ìë™ ì…ë ¥
      if (!storyEl.value) {
        // 1ë‹¨ê³„ì—ì„œ ë²¤ì¹˜ë§ˆí‚¹ ëŒ€ë³¸ êµ¬ì¡° ë¶„ì„ ê²°ê³¼ê°€ ìˆëŠ”ì§€ í™•ì¸
        var benchmarkStructure = payload.benchmarkStructure || payload.benchmarkAnalysis;
        if (benchmarkStructure) {
          storyEl.value = benchmarkStructure;
        } else {
          var lines = [];
          lines.push('1) ì¸íŠ¸ë¡œ: ì‹œì²­ìì˜ í˜„ì¬ ìƒí™©ê³¼ ê³ ë¯¼ ê³µê° â†’ ' + (baseTitle || 'ì£¼ì œ') + ' í•œ ì¤„ ì†Œê°œ');
          lines.push('2) ë¬¸ì œ ì œê¸°: ì™œ ì§€ê¸ˆ ì´ ì£¼ì œë¥¼ ì•Œì•„ì•¼ í•˜ëŠ”ì§€ ë°ì´í„°Â·ì‚¬ë¡€ë¡œ ì„¤ë“');
          lines.push('3) í•µì‹¬ ì¸ì‚¬ì´íŠ¸: AI ì „ë¬¸ê°€ ë¶„ì„ ìš”ì•½ì„ ë°”íƒ•ìœ¼ë¡œ 3~4ê°œ í•µì‹¬ í¬ì¸íŠ¸ ì œì‹œ');
          lines.push('4) ì‹¤ì „ ê°€ì´ë“œ: ì‹œì²­ìê°€ ë°”ë¡œ ë”°ë¼ í•  ìˆ˜ ìˆëŠ” ì²´í¬ë¦¬ìŠ¤íŠ¸Â·ë£¨í‹´ ì œì•ˆ');
          lines.push('5) ë§ˆë¬´ë¦¬ & ì½œíˆ¬ì•¡ì…˜: ë‹¤ìŒ ë‹¨ê³„(êµ¬ë…/ë‹¤ë¥¸ ì˜ìƒ/ë‹¤ìš´ë¡œë“œ)ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ìœ ë„');
          storyEl.value = lines.join('\n');
        }
      }
    }

    function analyzeBenchmarkStructure() {
      var srcEl = document.getElementById('benchmarkInput');
      var titleEl = document.getElementById('bpTitle');
      var hookEl = document.getElementById('bpHook');
      var storyEl = document.getElementById('bpStoryline');
      if (!srcEl || !titleEl || !hookEl || !storyEl) return;

      var text = srcEl.value.trim();
      if (!text) {
        alert('ë¶„ì„í•  ëŒ€ë³¸ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
        return;
      }

      var lines = text.split(/\r?\n/).filter(function(l) { return l.trim().length > 0; });
      if (lines.length && !titleEl.value) {
        titleEl.value = lines[0].substring(0, 80);
      }
      if (lines.length > 1 && !hookEl.value) {
        hookEl.value = lines[1].substring(0, 140);
      }

      var bullets = text.match(/(^|\n)\s*([0-9]+\.|-)[^\n]+/g);
      var outline = [];
      if (bullets && bullets.length) {
        outline.push('ë²¤ì¹˜ë§ˆí‚¹í•œ ëŒ€ë³¸ì˜ ì£¼ìš” ì„¹ì…˜:');
        bullets.slice(0, 6).forEach(function(b, idx) {
          var cleaned = b.replace(/(^|\n)\s*([0-9]+\.|-)/, '').trim();
          outline.push((idx + 1) + '. ' + cleaned);
        });
      } else if (lines.length > 3) {
        outline.push('ëŒ€ë³¸ì„ 3~5ê°œì˜ ì˜ë¯¸ ìˆëŠ” ë©ì–´ë¦¬ë¡œ ë‚˜ëˆˆ ê°œìš”:');
        var chunkSize = Math.ceil(lines.length / 4);
        for (var i = 0; i < 4; i++) {
          var slice = lines.slice(i * chunkSize, (i + 1) * chunkSize);
          if (!slice.length) continue;
          outline.push((i + 1) + '. ' + slice[0].substring(0, 80));
        }
      }

      if (outline.length) {
        // ì˜ìƒ ë¼ˆëŒ€ì— ì§ì ‘ ì…ë ¥ (ê¸°ì¡´ ë‚´ìš©ì´ ìˆìœ¼ë©´ ë®ì–´ì“°ê¸°)
        storyEl.value = outline.join('\n');
        // localStorageì— ì €ì¥í•˜ì—¬ ë‹¤ìŒ í˜ì´ì§€ ë¡œë“œ ì‹œì—ë„ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡
        var payload = lastStep2Payload || {};
        payload.benchmarkStructure = outline.join('\n');
        localStorage.setItem('step2Payload', JSON.stringify(payload));
      }

      alert('ë²¤ì¹˜ë§ˆí‚¹ ëŒ€ë³¸ êµ¬ì¡°ë¥¼ ì˜ìƒ ë¼ˆëŒ€ì— ë°˜ì˜í–ˆìŠµë‹ˆë‹¤.');
    }

    // Step1 -> Step2 ì „ë‹¬ ë°ì´í„° ë¡œë“œ
    var lastStep2Payload = null;
    (function() {
      try {
        var payloadRaw = localStorage.getItem('step2Payload');
        if (!payloadRaw) return;
        var payload = JSON.parse(payloadRaw);
        lastStep2Payload = payload;
        renderSelectionSummary(payload);
        prefillBlueprint(payload);
      } catch (e) {}
    })();

    // ëŒ€ë³¸ ì§ì ‘ ë„£ê¸° â†’ ì¬êµ¬ì„± í›„ 2ë‹¨ê³„ ìë™ ì‚½ì…
    (function() {
      try {
        var raw = localStorage.getItem('step2PreFillBlueprint');
        if (!raw) return;
        var pre = JSON.parse(raw);
        var titleEl = document.getElementById('bpTitle');
        var targetEl = document.getElementById('bpTarget');
        var hookEl = document.getElementById('bpHook');
        var storyEl = document.getElementById('bpStoryline');
        if (titleEl && pre.title != null) titleEl.value = String(pre.title);
        if (targetEl && pre.target != null) targetEl.value = String(pre.target);
        if (hookEl && pre.hook != null) hookEl.value = String(pre.hook);
        if (storyEl && pre.storyline != null) storyEl.value = String(pre.storyline);
        localStorage.removeItem('step2PreFillBlueprint');
      } catch (e) {}
    })();

    // ë²¤ì¹˜ë§ˆí‚¹ êµ¬ì¡° ë¶„ì„ ë²„íŠ¼
    (function() {
      var btn = document.getElementById('btnAnalyzeStructure');
      if (btn) {
        btn.addEventListener('click', analyzeBenchmarkStructure);
      }
    })();

    // ëŒ€ë³¸ ìƒì„± ë‹¨ê³„ë¡œ ì´ë™ ë²„íŠ¼ ì‚­ì œë¨ (AI ëŒ€ë³¸ ìƒì„± ë²„íŠ¼ìœ¼ë¡œ ëŒ€ì²´)

    // ì˜ìƒ í˜•ì‹ ì„ íƒ (ë¡±í¼/ìˆí¼)
    (function() {
      var currentFormat = 'shorts';
      var formatShorts = document.getElementById('formatShorts');
      var formatLongform = document.getElementById('formatLongform');
      var durationSelect = document.getElementById('videoDuration');
      
      var shortsOptions = [
        { value: '30s', label: '30ì´ˆ' },
        { value: '1m', label: '1ë¶„' },
        { value: '1.5m', label: '1.5ë¶„' },
        { value: '2m', label: '2ë¶„' },
        { value: '2.5m', label: '2.5ë¶„' }
      ];
      var longformOptions = [
        { value: '10m', label: '10ë¶„' },
        { value: '20m', label: '20ë¶„' },
        { value: '30m', label: '30ë¶„' },
        { value: '40m', label: '40ë¶„' },
        { value: '50m', label: '50ë¶„' },
        { value: '60m', label: '60ë¶„' }
      ];
      
      function updateFormatButtons(format) {
        if (format === 'shorts') {
          formatShorts.classList.add('active');
          formatLongform.classList.remove('active');
        } else {
          formatShorts.classList.remove('active');
          formatLongform.classList.add('active');
        }
      }
      
      function updateDurationOptions(format) {
        durationSelect.innerHTML = '';
        var options = format === 'shorts' ? shortsOptions : longformOptions;
        options.forEach(function(opt) {
          var option = document.createElement('option');
          option.value = opt.value;
          option.textContent = opt.label;
          durationSelect.appendChild(option);
        });
      }
      
      if (formatShorts && formatLongform) {
        formatShorts.onclick = function(e) {
          e.preventDefault();
          e.stopPropagation();
          if (currentFormat === 'shorts') return;
          currentFormat = 'shorts';
          updateFormatButtons('shorts');
          updateDurationOptions('shorts');
        };
        
        formatLongform.onclick = function(e) {
          e.preventDefault();
          e.stopPropagation();
          if (currentFormat === 'longform') return;
          currentFormat = 'longform';
          updateFormatButtons('longform');
          updateDurationOptions('longform');
        };
        
        updateFormatButtons('shorts'); // ê¸°ë³¸ê°’
      }
      
      // AI ëŒ€ë³¸ ìƒì„± ë²„íŠ¼: 3ë‹¨ê³„ë¡œ ì´ë™í•˜ë©´ì„œ AI ìƒì„± í”Œë˜ê·¸ ì„¤ì •
      var btnGenerate = document.getElementById('btnGenerateAIScript');
      if (btnGenerate) {
        btnGenerate.addEventListener('click', function() {
          var payload = lastStep2Payload || {};
          var blueprint = {
            title: document.getElementById('bpTitle').value.trim(),
            target: document.getElementById('bpTarget').value.trim(),
            hook: document.getElementById('bpHook').value.trim(),
            storyline: document.getElementById('bpStoryline').value.trim()
          };
          if (!blueprint.title && !blueprint.storyline) {
            alert('ì œëª© ë˜ëŠ” ì˜ìƒ ë¼ˆëŒ€ë¥¼ ì…ë ¥í•œ í›„ AI ëŒ€ë³¸ ìƒì„±ì„ ì§„í–‰í•´ ì£¼ì„¸ìš”.');
            return;
          }
          var selectedDuration = durationSelect ? durationSelect.value : '1m';
          localStorage.setItem('step3Blueprint', JSON.stringify({ fromStep2: payload, blueprint: blueprint }));
          localStorage.setItem('currentFormat', currentFormat);
          localStorage.setItem('currentDuration', selectedDuration);
          localStorage.setItem('autoGenerateScript', 'true'); // 3ë‹¨ê³„ì—ì„œ ìë™ ìƒì„± í”Œë˜ê·¸
          window.location.href = 'step-3.html';
        });
      }
    })();

    // ë¡œê·¸ì˜¨(ì£¼ì œ ì¶”ì²œê³¼ ë™ì¼)
    var isLoggedIn = false;
    function checkLoginStatus() {
      var loginStatus = localStorage.getItem('isLoggedIn');
      var loginTime = localStorage.getItem('loginTime');
      if (loginStatus === 'true' && loginTime) {
        var loginDate = new Date(loginTime);
        var now = new Date();
        var hoursDiff = (now - loginDate) / (1000 * 60 * 60);
        if (hoursDiff < 24) {
          isLoggedIn = true;
          updateUIForLogin();
          return true;
        }
      }
      isLoggedIn = false;
      updateUIForLogout();
      return false;
    }
    function login() {
      var id = document.getElementById('loginId').value.trim();
      var pw = document.getElementById('loginPw').value.trim();
      if (!id || !pw) { alert('IDì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.'); return; }
      var users = JSON.parse(localStorage.getItem('approvedUsers') || '[]');
      var user = users.find(function(u) { return u.id === id && u.password === pw; });
      if (user) {
        isLoggedIn = true;
        localStorage.setItem('isLoggedIn', 'true');
        localStorage.setItem('loginTime', new Date().toISOString());
        localStorage.setItem('currentUserId', id);
        updateUIForLogin();
        alert('ë¡œê·¸ì˜¨ë˜ì—ˆìŠµë‹ˆë‹¤.');
        document.getElementById('loginId').value = '';
        document.getElementById('loginPw').value = '';
      } else {
        alert('ìŠ¹ì¸ëœ IDì™€ ë¹„ë°€ë²ˆí˜¸ê°€ ì•„ë‹™ë‹ˆë‹¤.');
      }
    }
    function logout() {
      isLoggedIn = false;
      localStorage.removeItem('isLoggedIn');
      localStorage.removeItem('loginTime');
      localStorage.removeItem('currentUserId');
      updateUIForLogout();
    }
    function updateUIForLogin() {
      document.getElementById('btnLogin').textContent = 'ë¡œê·¸ì•„ì›ƒ';
      document.getElementById('btnLogin').onclick = function() {
        if (confirm('ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) { logout(); alert('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.'); }
      };
      document.getElementById('loginId').disabled = true;
      document.getElementById('loginPw').disabled = true;
    }
    function updateUIForLogout() {
      document.getElementById('btnLogin').textContent = 'ë¡œê·¸ì˜¨';
      document.getElementById('btnLogin').onclick = login;
      document.getElementById('loginId').disabled = false;
      document.getElementById('loginPw').disabled = false;
    }
    document.getElementById('btnAdmin').onclick = function() {
      alert('ê´€ë¦¬ í˜ì´ì§€ëŠ” ë©”ì¸(index.html)ì—ì„œ ì´ìš©í•˜ì„¸ìš”.');
    };
    document.getElementById('btnLogin').onclick = login;
    checkLoginStatus();

    // í”„ë¡œì íŠ¸ ë²„íŠ¼ ê¶Œí•œ ì²´í¬ ë° ì´ë²¤íŠ¸
    (function() {
      function checkAdminPermission() {
        var loginStatus = localStorage.getItem('isLoggedIn');
        var loginTime = localStorage.getItem('loginTime');
        if (loginStatus === 'true' && loginTime) {
          var loginDate = new Date(loginTime);
          var now = new Date();
          var hoursDiff = (now - loginDate) / (1000 * 60 * 60);
          if (hoursDiff < 24) {
            var currentUserId = localStorage.getItem('currentUserId');
            var users = JSON.parse(localStorage.getItem('approvedUsers') || '[]');
            var user = users.find(function(u) { return u.id === currentUserId; });
            return user && user.isAdmin === true;
          }
        }
        return false;
      }
      
      function updateProjectButtonsVisibility() {
        var hasPermission = checkAdminPermission();
        var btnCreate = document.getElementById('btnCreateProject');
        var btnList = document.getElementById('btnProjectList');
        if (btnCreate) {
          btnCreate.style.display = hasPermission ? 'block' : 'none';
          btnCreate.disabled = !hasPermission;
        }
        if (btnList) {
          btnList.style.display = hasPermission ? 'block' : 'none';
          btnList.disabled = !hasPermission;
        }
      }
      
      var btnCreate = document.getElementById('btnCreateProject');
      var btnList = document.getElementById('btnProjectList');
      
      if (btnCreate) {
        btnCreate.onclick = function() {
          if (!checkAdminPermission()) {
            alert('ê´€ë¦¬ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í›„ ê´€ë¦¬ ê¶Œí•œì„ ë°›ì•„ì£¼ì„¸ìš”.');
            return;
          }
          alert('í”„ë¡œì íŠ¸ ìƒì„± ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
        };
      }
      
      if (btnList) {
        btnList.onclick = function() {
          if (!checkAdminPermission()) {
            alert('ê´€ë¦¬ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í›„ ê´€ë¦¬ ê¶Œí•œì„ ë°›ì•„ì£¼ì„¸ìš”.');
            return;
          }
          window.location.href = '/';
        };
      }
      
      updateProjectButtonsVisibility();
      setInterval(updateProjectButtonsVisibility, 5000);
    })();
  </script>
</body>
</html>

